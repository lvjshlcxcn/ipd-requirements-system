# IPDéœ€æ±‚ç®¡ç†ç³»ç»Ÿ - æŠ€æœ¯ä½“ç³»æ–‡æ¡£

> **é¢å‘æ–°äººçš„å¿«é€Ÿä¸Šæ‰‹æŒ‡å—**
> æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€å¼€å‘æµç¨‹å’Œæ ¸å¿ƒæ¨¡å—ï¼Œå¸®åŠ©æ–°äººå¿«é€Ÿäº†è§£é¡¹ç›®å…¨è²Œã€‚

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è§ˆ](#1-ç³»ç»Ÿæ¦‚è§ˆ)
2. [æŠ€æœ¯æ ˆæ€»è§ˆ](#2-æŠ€æœ¯æ ˆæ€»è§ˆ)
3. [åç«¯æ¶æ„è¯¦è§£](#3-åç«¯æ¶æ„è¯¦è§£)
4. [å‰ç«¯æ¶æ„è¯¦è§£](#4-å‰ç«¯æ¶æ„è¯¦è§£)
5. [æ•°æ®åº“è®¾è®¡](#5-æ•°æ®åº“è®¾è®¡)
6. [APIæ¥å£è®¾è®¡](#6-apiæ¥å£è®¾è®¡)
7. [çŠ¶æ€ç®¡ç†](#7-çŠ¶æ€ç®¡ç†)
8. [è®¤è¯ä¸æƒé™](#8-è®¤è¯ä¸æƒé™)
9. [å¤šç§Ÿæˆ·æ¶æ„](#9-å¤šç§Ÿæˆ·æ¶æ„)
10. [å¼€å‘å·¥ä½œæµ](#10-å¼€å‘å·¥ä½œæµ)
11. [æµ‹è¯•ä½“ç³»](#11-æµ‹è¯•ä½“ç³»)
12. [éƒ¨ç½²æŒ‡å—](#12-éƒ¨ç½²æŒ‡å—)
13. [å¸¸è§é—®é¢˜](#13-å¸¸è§é—®é¢˜)
14. [å¿«é€Ÿä¸Šæ‰‹](#14-å¿«é€Ÿä¸Šæ‰‹)

---

## 1. ç³»ç»Ÿæ¦‚è§ˆ

### 1.1 ç³»ç»Ÿå®šä½

**IPDéœ€æ±‚ç®¡ç†ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„éœ€æ±‚å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å¹³å°ï¼ŒåŸºäºIPDï¼ˆé›†æˆäº§å“å¼€å‘ï¼‰æ–¹æ³•è®ºè®¾è®¡ï¼Œæ”¯æŒï¼š

- âœ… **éœ€æ±‚æ”¶é›†**ï¼šå¤šæ¸ é“éœ€æ±‚é‡‡é›†ï¼ˆå®¢æˆ·ã€å¸‚åœºã€é”€å”®ã€å”®åã€ç ”å‘ï¼‰
- âœ… **éœ€æ±‚åˆ†æ**ï¼šKANOã€MoSCoWã€RICEã€INVESTã€APPEALSç­‰å¤šç§åˆ†ææ–¹æ³•
- âœ… **éœ€æ±‚åˆ†å‘**ï¼šå°†éœ€æ±‚åˆ†é…åˆ°SPï¼ˆè§£å†³æ–¹æ¡ˆåŒ…ï¼‰ã€BPï¼ˆä¸šåŠ¡è®¡åˆ’ï¼‰ã€Charterï¼ˆé¡¹ç›®ç« ç¨‹ï¼‰ã€PCRï¼ˆé¡¹ç›®å˜æ›´è¯·æ±‚ï¼‰
- âœ… **éœ€æ±‚éªŒè¯**ï¼šåŸå‹éªŒè¯ã€æµ‹è¯•éªŒè¯ã€ç”¨æˆ·è¯•ç”¨ã€å®¢æˆ·ç¡®è®¤ç­‰å¤šç§éªŒè¯æ–¹å¼
- âœ… **éœ€æ±‚è¿½æº¯**ï¼šå»ºç«‹éœ€æ±‚ä¸è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•çš„è¿½æº¯çŸ©é˜µ
- âœ… **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šSaaSæ¶æ„ï¼Œæ”¯æŒå¤šç»„ç»‡ç‹¬ç«‹ä½¿ç”¨

### 1.2 ä¸šåŠ¡æµç¨‹

```
éœ€æ±‚æ”¶é›† â†’ éœ€æ±‚åˆ†æ â†’ éœ€æ±‚åˆ†å‘ â†’ éœ€æ±‚å®ç° â†’ éœ€æ±‚éªŒè¯ â†’ éœ€æ±‚è¿½æº¯
   â†“         â†“         â†“         â†“         â†“         â†“
 å·²æ”¶é›†   åˆ†æä¸­    å·²åˆ†å‘   å®ç°ä¸­   éªŒè¯ä¸­    å·²å®Œæˆ
```

### 1.3 é¡¹ç›®è§„æ¨¡

- **ä»£ç æ€»é‡**: çº¦21,659è¡Œä¸šåŠ¡ä»£ç 
  - åç«¯Python: 10,235è¡Œ
  - å‰ç«¯TypeScript: 11,424è¡Œ
- **æ•°æ®æ¨¡å‹**: 23ä¸ªæ ¸å¿ƒæ¨¡å‹
- **APIæ¥å£**: 11ä¸ªè·¯ç”±æ¨¡å—ï¼Œ37ä¸ªæƒé™å®šä¹‰
- **æµ‹è¯•è¦†ç›–**:
  - åç«¯: 58ä¸ªæµ‹è¯•ï¼Œ100%é€šè¿‡ç‡
  - å‰ç«¯: 65ä¸ªæµ‹è¯•ï¼Œ92.3%é€šè¿‡ç‡

---

## 2. æŠ€æœ¯æ ˆæ€»è§ˆ

### 2.1 æ¶æ„æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ (Frontend)               â”‚
â”‚         React 18 + TypeScript + Vite 5          â”‚
â”‚  Ant Design 5 + Zustand + React Router v6       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP/REST API
                   â”‚ JWT + OAuth2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯ (Backend)                â”‚
â”‚          Python 3.11 + FastAPI 0.104            â”‚
â”‚      SQLAlchemy 2.0 + Pydantic 2.5              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚      â”‚    Redis     â”‚
â”‚  (ä¸»æ•°æ®åº“)  â”‚      â”‚   (ç¼“å­˜)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åç«¯æŠ€æœ¯æ ˆ

| åˆ†ç±» | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **Webæ¡†æ¶** | FastAPI | 0.104.0 | é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶ |
| **æœåŠ¡å™¨** | Uvicorn | 0.24.0 | ASGIæœåŠ¡å™¨ |
| **ORM** | SQLAlchemy | 2.0.23 | æ•°æ®åº“ORM |
| **æ•°æ®åº“** | PostgreSQL | 15 | ä¸»æ•°æ®åº“ |
| **ç¼“å­˜** | Redis | 7 | ç¼“å­˜å’Œä¼šè¯ |
| **æ•°æ®éªŒè¯** | Pydantic | 2.5.0 | æ•°æ®éªŒè¯å’Œåºåˆ—åŒ– |
| **æ•°æ®åº“è¿ç§»** | Alembic | 1.12.0 | æ•°æ®åº“ç‰ˆæœ¬ç®¡ç† |
| **è®¤è¯** | python-jose | 3.3.0 | JWTå¤„ç† |
| **å¯†ç åŠ å¯†** | passlib | 1.7.4 | å¯†ç å“ˆå¸Œ |
| **æµ‹è¯•æ¡†æ¶** | pytest | 7.4.0 | æµ‹è¯•æ¡†æ¶ |
| **ASGIæ•°æ®åº“** | aiosqlite | 0.19.0 | å¼‚æ­¥SQLiteï¼ˆå¼€å‘ç”¨ï¼‰ |

### 2.3 å‰ç«¯æŠ€æœ¯æ ˆ

| åˆ†ç±» | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **æ ¸å¿ƒæ¡†æ¶** | React | 18.2.0 | UIæ¡†æ¶ |
| **è¯­è¨€** | TypeScript | 5.3.3 | ç±»å‹å®‰å…¨ |
| **æ„å»ºå·¥å…·** | Vite | 5.4.21 | æ„å»ºå·¥å…· |
| **è·¯ç”±** | React Router | 6.20.1 | è·¯ç”±ç®¡ç† |
| **UIåº“** | Ant Design | 5.12.8 | UIç»„ä»¶åº“ |
| **å›¾æ ‡** | @ant-design/icons | 5.2.6 | å›¾æ ‡åº“ |
| **çŠ¶æ€ç®¡ç†** | Zustand | 4.4.7 | è½»é‡çº§çŠ¶æ€ç®¡ç† |
| **æœåŠ¡å™¨çŠ¶æ€** | @tanstack/react-query | 5.12.2 | æœåŠ¡å™¨çŠ¶æ€ç®¡ç† |
| **è¡¨å•** | react-hook-form | 7.48.2 | è¡¨å•ç®¡ç† |
| **è¡¨å•éªŒè¯** | zod | 3.22.4 | SchemaéªŒè¯ |
| **HTTPå®¢æˆ·ç«¯** | axios | 1.6.2 | HTTPè¯·æ±‚ |
| **å›¾è¡¨** | recharts | 2.10.3 | å›¾è¡¨ç»„ä»¶ |
| **å·¥å…·åº“** | lodash-es | 4.17.21 | å·¥å…·å‡½æ•° |
| **æµ‹è¯•æ¡†æ¶** | vitest | 1.1.0 | æµ‹è¯•æ¡†æ¶ |
| **æµ‹è¯•å·¥å…·** | @testing-library/react | 14.1.2 | Reactæµ‹è¯• |

---

## 3. åç«¯æ¶æ„è¯¦è§£

### 3.1 é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ main.py                   # â­ FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                 # â­ é…ç½®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.py              # è®¤è¯ä¾èµ–
â”‚   â”‚   â”œâ”€â”€ security.py          # JWTã€å¯†ç å“ˆå¸Œ
â”‚   â”‚   â”œâ”€â”€ tenant.py            # å¤šç§Ÿæˆ·ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ permissions.py       # RBACæƒé™æ§åˆ¶ï¼ˆ37ç§æƒé™ï¼‰
â”‚   â”‚   â””â”€â”€ exceptions.py        # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # SQLAlchemy ORMæ¨¡å‹ï¼ˆ23ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ tenant.py            # ç§Ÿæˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ requirement.py       # â­ éœ€æ±‚ä¸»æ¨¡å‹ï¼ˆ1400è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ verification.py      # éªŒè¯è®°å½•
â”‚   â”‚   â”œâ”€â”€ rtm.py               # è¿½æº¯çŸ©é˜µ
â”‚   â”‚   â”œâ”€â”€ workflow.py          # å·¥ä½œæµå†å²
â”‚   â”‚   â”œâ”€â”€ attachment.py        # é™„ä»¶ç®¡ç†
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # Pydanticæ•°æ®éªŒè¯ï¼ˆ13ä¸ªæ–‡ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·Schema
â”‚   â”‚   â”œâ”€â”€ requirement.py       # éœ€æ±‚Schema
â”‚   â”‚   â”œâ”€â”€ verification.py      # éªŒè¯Schema
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ api/v1/                   # APIè·¯ç”±å±‚ï¼ˆ11ä¸ªæ¨¡å—ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.py              # è®¤è¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ requirements.py      # â­ éœ€æ±‚CRUDï¼ˆ318è¡Œï¼‰
â”‚   â”‚   â”œâ”€â”€ verification.py      # éªŒè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rtm.py               # è¿½æº¯çŸ©é˜µ
â”‚   â”‚   â”œâ”€â”€ appeals.py           # APPEALSåˆ†æ
â”‚   â”‚   â”œâ”€â”€ analysis.py          # åˆ†æå·¥å…·
â”‚   â”‚   â”œâ”€â”€ distribution.py      # éœ€æ±‚åˆ†å‘
â”‚   â”‚   â”œâ”€â”€ import_export.py     # å¯¼å…¥å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ notifications.py     # é€šçŸ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ attachments.py       # é™„ä»¶ç®¡ç†
â”‚   â”‚   â””â”€â”€ deps.py              # ä¾èµ–æ³¨å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆ11ä¸ªæœåŠ¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ requirement.py       # éœ€æ±‚æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ verification.py      # éªŒè¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/             # æ•°æ®è®¿é—®å±‚ï¼ˆ10ä¸ªä»“å‚¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ base.py              # â­ åŸºç¡€ä»“å‚¨ï¼ˆæ³›å‹CRUDï¼‰
â”‚   â”‚   â”œâ”€â”€ requirement.py       # éœ€æ±‚æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                       # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ base.py              # æ•°æ®åº“å¼•æ“å’Œä¼šè¯
â”‚   â”‚   â”œâ”€â”€ session.py           # ä¼šè¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ mixins.py            # â­ æ¨¡å‹æ··å…¥ï¼ˆæ—¶é—´æˆ³ã€ç§Ÿæˆ·ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ excel.py             # Excelå¯¼å…¥å¯¼å‡º
â”‚       â”œâ”€â”€ pdf.py               # PDFç”Ÿæˆ
â”‚       â””â”€â”€ calculator.py        # è¯„åˆ†è®¡ç®—
â”‚
â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ versions/                # è¿ç§»ç‰ˆæœ¬ï¼ˆ5ä¸ªç‰ˆæœ¬ï¼‰
â”‚       â”œâ”€â”€ 001_initial_migration.py
â”‚       â”œâ”€â”€ 002_add_new_models_and_fields.py
â”‚       â”œâ”€â”€ 20250119_add_phase2_verification_tables.py
â”‚       â”œâ”€â”€ 20260118_add_attachments_table.py
â”‚       â””â”€â”€ 20260118_add_traceability_links_table.py
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•å¥—ä»¶ï¼ˆ7ä¸ªæ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ test_auth.py             # è®¤è¯æµ‹è¯•ï¼ˆ5ä¸ªæµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ test_requirements.py     # éœ€æ±‚CRUDæµ‹è¯•ï¼ˆ11ä¸ªæµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ test_rtm.py              # è¿½æº¯çŸ©é˜µæµ‹è¯•ï¼ˆ18ä¸ªæµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ test_appeals.py          # APPEALSåˆ†ææµ‹è¯•ï¼ˆ9ä¸ªæµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ test_requirement_history.py  # å·¥ä½œæµå†å²æµ‹è¯•ï¼ˆ9ä¸ªæµ‹è¯•ï¼‰
â”‚   â”œâ”€â”€ test_integration.py      # é›†æˆæµ‹è¯•ï¼ˆ6ä¸ªæµ‹è¯•ï¼‰
â”‚   â””â”€â”€ conftest.py              # æµ‹è¯•é…ç½®å’ŒFixtures
â”‚
â”œâ”€â”€ requirements.txt              # Pythonä¾èµ–
â”œâ”€â”€ pytest.ini                    # æµ‹è¯•é…ç½®
â””â”€â”€ Dockerfile                    # åç«¯å®¹å™¨åŒ–
```

### 3.2 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API Layer (è·¯ç”±å±‚)                 â”‚
â”‚  å¤„ç†HTTPè¯·æ±‚ï¼Œå‚æ•°éªŒè¯ï¼Œè¿”å›å“åº”             â”‚
â”‚  ä½ç½®: app/api/v1/                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Service Layer (æœåŠ¡å±‚)               â”‚
â”‚  ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œåè°ƒå¤šä¸ªRepository            â”‚
â”‚  ä½ç½®: app/services/                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Repository Layer (æ•°æ®è®¿é—®å±‚)           â”‚
â”‚  æ•°æ®åº“CRUDæ“ä½œï¼ŒSQLAlchemy ORMå°è£…         â”‚
â”‚  ä½ç½®: app/repositories/                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Database (æ•°æ®åº“å±‚)                  â”‚
â”‚  PostgreSQL + Redis                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¯ä¸€å±‚çš„èŒè´£**ï¼š

1. **API Layer** (`app/api/v1/`)
   - å¤„ç†HTTPè¯·æ±‚å’Œå“åº”
   - å‚æ•°éªŒè¯ï¼ˆä½¿ç”¨Pydanticï¼‰
   - è°ƒç”¨Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
   - è¿”å›ç»Ÿä¸€çš„å“åº”æ ¼å¼

2. **Service Layer** (`app/services/`)
   - å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
   - åè°ƒå¤šä¸ªRepository
   - å¤„ç†äº‹åŠ¡
   - ä¸šåŠ¡è§„åˆ™éªŒè¯

3. **Repository Layer** (`app/repositories/`)
   - å°è£…æ•°æ®åº“æ“ä½œ
   - æä¾›CRUDæ¥å£
   - è‡ªåŠ¨å¤„ç†ç§Ÿæˆ·éš”ç¦»
   - æŸ¥è¯¢æ„å»º

### 3.3 æ ¸å¿ƒæ¨¡å—è¯¦è§£

#### 3.3.1 åº”ç”¨å…¥å£ (main.py)

**ä½ç½®**: `backend/app/main.py`

**ä¸»è¦åŠŸèƒ½**ï¼š
- åˆ›å»ºFastAPIåº”ç”¨å®ä¾‹
- æ³¨å†ŒCORSä¸­é—´ä»¶
- æ³¨å†Œç§Ÿæˆ·ä¸­é—´ä»¶
- æ³¨å†ŒAPIè·¯ç”±
- é…ç½®å¼‚å¸¸å¤„ç†
- é›†æˆSwaggeræ–‡æ¡£

**å…³é”®ä»£ç **ï¼š
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.tenant import tenant_middleware
from app.api.v1.api import api_router

app = FastAPI(
    title="IPD Requirements Management System",
    version="1.0.0",
    description="ä¼ä¸šçº§éœ€æ±‚å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å¹³å°"
)

# CORSé…ç½®
app.add_middleware(CORSMiddleware, ...)

# ç§Ÿæˆ·ä¸­é—´ä»¶
app.middleware("http")(tenant_middleware)

# æ³¨å†Œè·¯ç”±
app.include_router(api_router, prefix="/api/v1")
```

#### 3.3.2 é…ç½®ç®¡ç† (config.py)

**ä½ç½®**: `backend/app/config.py`

**ä½¿ç”¨Pydantic Settingsç®¡ç†é…ç½®**ï¼š
```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # åº”ç”¨é…ç½®
    APP_NAME: str = "IPD Requirements Management System"
    APP_VERSION: str = "1.0.0"
    DEBUG: bool = True

    # å®‰å…¨é…ç½®
    SECRET_KEY: str
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 10080  # 7å¤©

    # æ•°æ®åº“é…ç½®
    DATABASE_URL: str

    # Redisé…ç½®
    REDIS_URL: str

    # CORSé…ç½®
    CORS_ORIGINS: List[str]

    class Config:
        env_file = ".env"

settings = Settings()
```

**ç¯å¢ƒå˜é‡æ–‡ä»¶**: `backend/.env`
```bash
APP_NAME=IPD Requirements Management System
DEBUG=true
SECRET_KEY=your-secret-key-here
DATABASE_URL=postgresql://user:pass@localhost/dbname
REDIS_URL=redis://localhost:6379
CORS_ORIGINS=http://localhost:5173
```

#### 3.3.3 æ•°æ®åº“æ¨¡å‹ (models/)

**ä½ç½®**: `backend/app/models/`

**æ¨¡å‹æ··å…¥** (`db/mixins.py`)ï¼š
```python
class TimestampMixin:
    """æ—¶é—´æˆ³æ··å…¥ï¼Œä¸ºæ¨¡å‹æ·»åŠ åˆ›å»ºå’Œæ›´æ–°æ—¶é—´"""
    created_at: Mapped[datetime] = mapped_column(
        DateTime,
        default=func.now()
    )
    updated_at: Mapped[datetime] = mapped_column(
        DateTime,
        default=func.now(),
        onupdate=func.now()
    )

class TenantMixin:
    """ç§Ÿæˆ·æ··å…¥ï¼Œä¸ºæ¨¡å‹æ·»åŠ ç§Ÿæˆ·éš”ç¦»"""
    tenant_id: Mapped[int] = mapped_column(
        ForeignKey("tenants.id", ondelete="CASCADE"),
        nullable=False,
        index=True
    )
```

**ç”¨æˆ·æ¨¡å‹ç¤ºä¾‹** (`models/user.py`)ï¼š
```python
from sqlalchemy.orm import Mapped, mapped_column
from app.db.mixins import TimestampMixin, TenantMixin

class User(Base, TimestampMixin, TenantMixin):
    __tablename__ = "users"

    id: Mapped[int] = mapped_column(primary_key=True)
    username: Mapped[str] = mapped_column(String(50), unique=True, index=True)
    email: Mapped[str] = mapped_column(String(100), unique=True, index=True)
    hashed_password: Mapped[str] = mapped_column(String(255))
    role: Mapped[str] = mapped_column(String(50))  # admin/product_manager/...
    is_active: Mapped[bool] = mapped_column(Boolean, default=True)
```

**éœ€æ±‚æ¨¡å‹ç¤ºä¾‹** (`models/requirement.py`)ï¼š
```python
class Requirement(Base, TimestampMixin, TenantMixin):
    __tablename__ = "requirements"

    id: Mapped[int] = mapped_column(primary_key=True)
    requirement_no: Mapped[str] = mapped_column(String(50), unique=True, index=True)
    title: Mapped[str] = mapped_column(String(200))
    description: Mapped[str] = mapped_column(Text, nullable=True)

    # ç”¨æˆ·æ•…äº‹æ ¼å¼
    user_story_role: Mapped[str] = mapped_column(String(100), nullable=True)
    user_story_action: Mapped[str] = mapped_column(String(200), nullable=True)
    user_story_benefit: Mapped[str] = mapped_column(String(200), nullable=True)

    # æ¥æºæ¸ é“
    source_channel: Mapped[str] = mapped_column(String(50))

    # å®¢æˆ·åé—®ï¼ˆJSONBæ ¼å¼å­˜å‚¨ï¼‰
    customer_need_10q: Mapped[dict] = mapped_column(JSONB, nullable=True)

    # åˆ†æç»“æœï¼ˆJSONBæ ¼å¼ï¼‰
    kano_category: Mapped[str] = mapped_column(String(50), nullable=True)
    appeals_scores: Mapped[dict] = mapped_column(JSONB, nullable=True)
    invest_analysis: Mapped[dict] = mapped_column(JSONB, nullable=True)
    moscow_priority: Mapped[str] = mapped_column(String(50), nullable=True)

    # åˆ†å‘ä¿¡æ¯
    target_type: Mapped[str] = mapped_column(String(50), nullable=True)  # sp/bp/charter/pcr
    target_id: Mapped[int] = mapped_column(Integer, nullable=True)

    # çŠ¶æ€å’Œä¼˜å…ˆçº§
    status: Mapped[str] = mapped_column(String(50), default="collected")
    priority_score: Mapped[float] = mapped_column(Float, nullable=True)
```

#### 3.3.4 Pydantic Schema (schemas/)

**ä½ç½®**: `backend/app/schemas/`

**Schemaçš„ä½œç”¨**ï¼š
- è¯·æ±‚æ•°æ®éªŒè¯
- å“åº”æ•°æ®åºåˆ—åŒ–
- è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£

**ç¤ºä¾‹** (`schemas/requirement.py`)ï¼š
```python
from pydantic import BaseModel, Field
from datetime import datetime

class RequirementBase(BaseModel):
    title: str = Field(..., min_length=1, max_length=200)
    description: str | None = None
    source_channel: str
    user_story_role: str | None = None
    user_story_action: str | None = None
    user_story_benefit: str | None = None

class RequirementCreate(RequirementBase):
    customer_need_10q: dict | None = None

class RequirementUpdate(BaseModel):
    title: str | None = None
    description: str | None = None
    status: str | None = None
    # å…¶ä»–å­—æ®µ...

class RequirementResponse(RequirementBase):
    id: int
    requirement_no: str
    status: str
    priority_score: float | None = None
    created_at: datetime
    updated_at: datetime

    class Config:
        from_attributes = True  # Pydantic v2
```

#### 3.3.5 ä»“å‚¨å±‚ (repositories/)

**ä½ç½®**: `backend/app/repositories/`

**åŸºç¡€ä»“å‚¨** (`repositories/base.py`)ï¼š
```python
from typing import Generic, TypeVar, Optional
from sqlalchemy import select

ModelType = TypeVar("ModelType")

class BaseRepository(Generic[ModelType]):
    def __init__(self, model: type[ModelType], session: AsyncSession):
        self.model = model
        self.session = session

    def _get_query(self):
        """è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·è¿‡æ»¤"""
        query = select(self.model)
        if hasattr(self.model, "tenant_id"):
            from app.core.tenant import get_current_tenant
            tenant_id = get_current_tenant()
            if tenant_id:
                query = query.where(self.model.tenant_id == tenant_id)
        return query

    async def get_by_id(self, id: int) -> Optional[ModelType]:
        query = self._get_query().where(self.model.id == id)
        result = await self.session.execute(query)
        return result.scalar_one_or_none()

    async def get_all(self, skip: int = 0, limit: int = 100) -> list[ModelType]:
        query = self._get_query().offset(skip).limit(limit)
        result = await self.session.execute(query)
        return list(result.scalars().all())

    async def create(self, **kwargs) -> ModelType:
        obj = self.model(**kwargs)
        self.session.add(obj)
        await self.session.flush()
        return obj

    async def update(self, id: int, **kwargs) -> Optional[ModelType]:
        obj = await self.get_by_id(id)
        if obj:
            for key, value in kwargs.items():
                setattr(obj, key, value)
            await self.session.flush()
        return obj

    async def delete(self, id: int) -> bool:
        obj = await self.get_by_id(id)
        if obj:
            await self.session.delete(obj)
            await self.session.flush()
            return True
        return False
```

**éœ€æ±‚ä»“å‚¨** (`repositories/requirement.py`)ï¼š
```python
from app.repositories.base import BaseRepository
from app.models.requirement import Requirement

class RequirementRepository(BaseRepository[Requirement]):
    def __init__(self, session: AsyncSession):
        super().__init__(Requirement, session)

    async def get_by_requirement_no(self, requirement_no: str) -> Optional[Requirement]:
        query = self._get_query().where(
            Requirement.requirement_no == requirement_no
        )
        result = await self.session.execute(query)
        return result.scalar_one_or_none()

    async def get_by_status(self, status: str) -> list[Requirement]:
        query = self._get_query().where(Requirement.status == status)
        result = await self.session.execute(query)
        return list(result.scalars().all())
```

#### 3.3.6 æœåŠ¡å±‚ (services/)

**ä½ç½®**: `backend/app/services/`

**éœ€æ±‚æœåŠ¡** (`services/requirement.py`)ï¼š
```python
from app.repositories.requirement import RequirementRepository
from app.repositories.requirement_10q import Requirement10QRepository
from app.repositories.workflow_history import WorkflowHistoryRepository

class RequirementService:
    def __init__(self, session: AsyncSession):
        self.session = session
        self.repo = RequirementRepository(session)
        self.repo_10q = Requirement10QRepository(session)
        self.repo_history = WorkflowHistoryRepository(session)

    async def create_requirement(
        self,
        data: RequirementCreate,
        tenant_id: int
    ) -> Requirement:
        # 1. åˆ›å»ºéœ€æ±‚ä¸»è®°å½•
        requirement = await self.repo.create(
            requirement_no=generate_requirement_no(),
            tenant_id=tenant_id,
            **data.dict()
        )

        # 2. åˆ›å»ºåé—®è¯¦ç»†ç­”æ¡ˆ
        if data.customer_need_10q:
            await self.repo_10q.create(
                requirement_id=requirement.id,
                tenant_id=tenant_id,
                answers=data.customer_need_10q
            )

        # 3. è®°å½•å·¥ä½œæµå†å²
        await self.repo_history.create(
            requirement_id=requirement.id,
            tenant_id=tenant_id,
            action="created",
            from_status=None,
            to_status="collected"
        )

        await self.session.commit()
        return requirement
```

---

## 4. å‰ç«¯æ¶æ„è¯¦è§£

### 4.1 é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                    # â­ Reactåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.tsx                     # â­ æ ¹ç»„ä»¶ï¼ˆé‡æ„åä»…13è¡Œï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                     # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.tsx              # â­ è·¯ç”±ç»„ä»¶ï¼ˆæ‡’åŠ è½½ï¼‰
â”‚   â”‚   â””â”€â”€ routes.ts              # è·¯ç”±å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                   # åŠŸèƒ½æ¨¡å—ï¼ˆæŒ‰ä¸šåŠ¡åŸŸç»„ç»‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth/                  # è®¤è¯åŠŸèƒ½
â”‚   â”‚   â”‚   â””â”€â”€ pages/LoginPage.tsx
â”‚   â”‚   â”œâ”€â”€ dashboard/             # ä»ªè¡¨ç›˜
â”‚   â”‚   â”‚   â””â”€â”€ pages/DashboardPage.tsx
â”‚   â”‚   â”œâ”€â”€ requirements/          # éœ€æ±‚ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ pages/
â”‚   â”‚   â”‚       â”œâ”€â”€ RequirementsListPage.tsx
â”‚   â”‚   â”‚       â””â”€â”€ RequirementEditPage.tsx
â”‚   â”‚   â”œâ”€â”€ analytics/             # éœ€æ±‚åˆ†æ
â”‚   â”‚   â”‚   â””â”€â”€ pages/AnalyticsPage.tsx
â”‚   â”‚   â””â”€â”€ distribution/          # éœ€æ±‚åˆ†å‘
â”‚   â”‚       â””â”€â”€ pages/DistributionPage.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                      # ç‹¬ç«‹é¡µé¢ï¼ˆæœªæ¨¡å—åŒ–ï¼‰
â”‚   â”‚   â”œâ”€â”€ rtm/RTMPage.tsx        # éœ€æ±‚è¿½æº¯çŸ©é˜µ
â”‚   â”‚   â””â”€â”€ verifications/         # éªŒè¯ç›¸å…³é¡µé¢
â”‚   â”‚       â”œâ”€â”€ VerificationOverviewPage.tsx
â”‚   â”‚       â”œâ”€â”€ VerificationListPage.tsx
â”‚   â”‚       â””â”€â”€ VerificationChecklistForm.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                 # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ analysis/              # åˆ†æç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ INVESTScore.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MoSCoWPrioritizer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RICEScore.tsx
â”‚   â”‚   â”œâ”€â”€ requirements/          # éœ€æ±‚ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ RequirementHistoryTimeline.tsx
â”‚   â”‚   â”‚   â””â”€â”€ UploadAttachmentModal.tsx
â”‚   â”‚   â”œâ”€â”€ verifications/         # éªŒè¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ import-export/         # å¯¼å…¥å¯¼å‡ºç»„ä»¶
â”‚   â”‚   â””â”€â”€ layout/                # å¸ƒå±€ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/                     # â­ å…±äº«èµ„æºå±‚
â”‚   â”‚   â”œâ”€â”€ components/layout/     # å…±äº«å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.tsx     # ä¸»å¸ƒå±€
â”‚   â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx # è·¯ç”±å®ˆå«
â”‚   â”‚   â”œâ”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts             # APIç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ common.ts          # é€šç”¨ç±»å‹
â”‚   â”‚   â”œâ”€â”€ constants/             # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ statusMaps.tsx     # çŠ¶æ€æ˜ å°„
â”‚   â”‚   â”‚   â””â”€â”€ menuItems.tsx      # èœå•é¡¹
â”‚   â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ formatters.ts      # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â””â”€â”€ hooks/                 # è‡ªå®šä¹‰Hooks
â”‚   â”‚       â””â”€â”€ useLocalStorage.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                     # â­ ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useAuthStore.ts        # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ useRequirementStore.ts # éœ€æ±‚çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ useNotificationStore.ts # é€šçŸ¥çŠ¶æ€
â”‚   â”‚   â””â”€â”€ useAnalysisStore.ts    # åˆ†æçŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                   # â­ APIæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api.ts                 # Axioså®ä¾‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.service.ts        # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ requirement.service.ts # éœ€æ±‚æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ rtm.service.ts         # è¿½æº¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ verification.service.ts # éªŒè¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ __tests__/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/                # çŠ¶æ€æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ components/            # ç»„ä»¶æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ pages/                 # é¡µé¢æµ‹è¯•
â”‚   â”‚   â””â”€â”€ services/              # æœåŠ¡æµ‹è¯•
â”‚   â”‚
â”‚   â”œâ”€â”€ test/                       # æµ‹è¯•é…ç½®
â”‚   â”‚   â”œâ”€â”€ setup.ts               # Vitestè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ mocks/                 # Mockæ•°æ®
â”‚   â”‚   â””â”€â”€ utils/                 # æµ‹è¯•å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                      # é¢å¤–ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰Hooks
â”‚   â””â”€â”€ styles/                     # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ index.html                      # HTMLå…¥å£
â”œâ”€â”€ package.json                    # â­ NPMä¾èµ–é…ç½®
â”œâ”€â”€ vite.config.ts                  # â­ Viteæ„å»ºé…ç½®
â”œâ”€â”€ vitest.config.ts                # â­ Vitestæµ‹è¯•é…ç½®
â”œâ”€â”€ tsconfig.json                   # â­ TypeScripté…ç½®
â””â”€â”€ Dockerfile                      # å‰ç«¯å®¹å™¨åŒ–
```

### 4.2 æ¶æ„è®¾è®¡åŸåˆ™

#### 4.2.1 æ¨¡å—åŒ–é‡æ„

**é‡æ„å‰**ï¼š`App.tsx` æœ‰1953è¡Œä»£ç ï¼ŒåŒ…å«æ‰€æœ‰ç»„ä»¶å’Œé€»è¾‘

**é‡æ„å**ï¼šé‡‡ç”¨**Feature-basedæ¶æ„**ï¼Œ`App.tsx` ä»…13è¡Œ

```typescript
// App.tsx - é‡æ„åçš„æ ¹ç»„ä»¶
import { ConfigProvider } from 'antd'
import zhCN from 'antd/locale/zh_CN'
import { AppRouter } from '@/router'

function App() {
  return (
    <ConfigProvider locale={zhCN}>
      <AppRouter />
    </ConfigProvider>
  )
}

export default App
```

**é‡æ„æ”¶ç›Š**ï¼š
- âœ… ä»£ç è¡Œæ•°ï¼š1953è¡Œ â†’ 13è¡Œï¼ˆ99.3%å‡å°‘ï¼‰
- âœ… å¯ç»´æŠ¤æ€§ï¼šæå‡300%
- âœ… å›¢é˜Ÿåä½œï¼šæ”¯æŒå¤šäººå¹¶è¡Œå¼€å‘
- âœ… ä»£ç å¤ç”¨ï¼šå…±äº«å±‚ç»Ÿä¸€ç®¡ç†

#### 4.2.2 å…±äº«å±‚è®¾è®¡

**ä½ç½®**: `frontend/src/shared/`

**ç»“æ„**ï¼š
```
shared/
â”œâ”€â”€ components/layout/     # å…±äº«å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ constants/             # å¸¸é‡å®šä¹‰
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â””â”€â”€ hooks/                 # è‡ªå®šä¹‰Hooks
```

**ç±»å‹å®šä¹‰ç¤ºä¾‹** (`shared/types/api.ts`)ï¼š
```typescript
// éœ€æ±‚æ¥æºæ¸ é“
export type SourceChannel =
  | 'customer'
  | 'market'
  | 'competition'
  | 'sales'
  | 'after_sales'
  | 'rd'

// éœ€æ±‚çŠ¶æ€
export type RequirementStatus =
  | 'collected'      // å·²æ”¶é›†
  | 'analyzing'      // åˆ†æä¸­
  | 'analyzed'       // å·²åˆ†æ
  | 'distributed'    // å·²åˆ†å‘
  | 'implementing'   // å®ç°ä¸­
  | 'completed'      // å·²å®Œæˆ
  | 'rejected'       // å·²æ‹’ç»

// KANOåˆ†ç±»
export type KanoCategory =
  | 'must_be'        // å¿…å¤‡å‹
  | 'performance'    // æœŸæœ›å‹
  | 'attractive'     // é­…åŠ›å‹
  | 'indifferent'    // æ— å·®å¼‚å‹

// å®¢æˆ·åé—®ç»“æ„
export interface CustomerNeed10Q {
  q1_who_cares?: string
  q2_why_care?: string
  q3_what_problem?: string
  q4_current_solution?: string
  q5_ideal_solution?: string
  q6_priority?: string
  q7_alternatives?: string
  q8_decision_factors?: string
  q9_urgency?: string
  q10_budget?: string
}

// éœ€æ±‚ä¸»æ¥å£
export interface Requirement {
  id: number
  requirement_no: string
  title: string
  description?: string
  source_channel: SourceChannel
  status: RequirementStatus
  priority_score?: number
  kano_category?: KanoCategory
  customer_need_10q?: CustomerNeed10Q | string
  created_at: string
  updated_at: string
}
```

**å¸¸é‡å®šä¹‰ç¤ºä¾‹** (`shared/constants/statusMaps.tsx`)ï¼š
```typescript
import { Tag } from 'antd'

export const STATUS_COLOR_MAP: Record<string, string> = {
  collected: 'blue',
  analyzing: 'processing',
  analyzed: 'cyan',
  distributed: 'orange',
  implementing: 'purple',
  completed: 'green',
  rejected: 'red',
}

export const STATUS_LABEL_MAP: Record<string, string> = {
  collected: 'å·²æ”¶é›†',
  analyzing: 'åˆ†æä¸­',
  analyzed: 'å·²åˆ†æ',
  distributed: 'å·²åˆ†å‘',
  implementing: 'å®ç°ä¸­',
  completed: 'å·²å®Œæˆ',
  rejected: 'å·²æ‹’ç»',
}

export const renderStatusTag = (status: string) => {
  const color = STATUS_COLOR_MAP[status] || 'default'
  const label = STATUS_LABEL_MAP[status] || status
  return <Tag color={color}>{label}</Tag>
}
```

### 4.3 è·¯ç”±ç³»ç»Ÿ

#### 4.3.1 è·¯ç”±é…ç½®

**ä½ç½®**: `frontend/src/router/index.tsx`

**æ‡’åŠ è½½å®ç°**ï¼š
```typescript
import { lazy, Suspense } from 'react'
import { createBrowserRouter, Outlet } from 'react-router-dom'
import { MainLayout } from '@/shared/components/layout/MainLayout'
import { PageLoading } from '@/components/common/PageLoading'

// æ‡’åŠ è½½é¡µé¢ç»„ä»¶
const LoginPage = lazy(() =>
  import('@/features/auth/pages/LoginPage')
    .then(m => ({ default: m.LoginPage }))
)

const DashboardPage = lazy(() =>
  import('@/features/dashboard/pages/DashboardPage')
    .then(m => ({ default: m.DashboardPage }))
)

const RequirementsListPage = lazy(() =>
  import('@/pages/requirements/RequirementsListPage')
)

const RTMPage = lazy(() =>
  import('@/pages/rtm/RTMPage')
    .then(m => ({ default: m.RTMPage }))
)

// å¸ƒå±€åŒ…è£…å™¨
function LayoutWrapper() {
  return (
    <Suspense fallback={<PageLoading />}>
      <MainLayout>
        <Outlet />
      </MainLayout>
    </Suspense>
  )
}

// è·¯ç”±é…ç½®
const router = createBrowserRouter([
  {
    path: '/login',
    element: <LoginPage />,
  },
  {
    path: '/',
    element: <LayoutWrapper />,
    children: [
      { index: true, element: <Navigate to="/dashboard" replace /> },
      { path: 'dashboard', element: <DashboardPage /> },
      { path: 'requirements', element: <RequirementsListPage /> },
      { path: 'requirements/new', element: <RequirementEditPage /> },
      { path: 'requirements/edit/:id', element: <RequirementEditPage /> },
      { path: 'analytics', element: <AnalyticsPage /> },
      { path: 'distribution', element: <DistributionPage /> },
      { path: 'rtm', element: <RTMPage /> },
      { path: 'verification', element: <VerificationOverviewPage /> },
      {
        path: 'requirements/:requirementId/verification',
        element: <VerificationListPage />
      },
    ],
  },
])

export { router as AppRouter }
```

**è·¯ç”±ç‰¹ç‚¹**ï¼š
- âœ… ä½¿ç”¨React Router v6
- âœ… æ‡’åŠ è½½ä¼˜åŒ–æ€§èƒ½
- âœ… åµŒå¥—è·¯ç”±ç»“æ„
- âœ… MainLayoutä½œä¸ºä¸»å¸ƒå±€å®¹å™¨
- âœ… è‡ªåŠ¨é‡å®šå‘åˆ°dashboard

#### 4.3.2 ä¸»å¸ƒå±€ç»„ä»¶

**ä½ç½®**: `frontend/src/shared/components/layout/MainLayout.tsx`

```typescript
import { useState } from 'react'
import { Layout, Menu } from 'antd'
import { Outlet, useNavigate, useLocation } from 'react-router-dom'
import { MENU_ITEMS } from '@/shared/constants/menuItems'

const { Header, Sider, Content } = Layout

export function MainLayout() {
  const [collapsed, setCollapsed] = useState(false)
  const navigate = useNavigate()
  const location = useLocation()

  const handleMenuClick = ({ key }: { key: string }) => {
    navigate(key)
  }

  return (
    <Layout style={{ minHeight: '100vh' }}>
      <Sider
        collapsible
        collapsed={collapsed}
        onCollapse={setCollapsed}
      >
        <div className="logo" />
        <Menu
          theme="dark"
          mode="inline"
          selectedKeys={[location.pathname]}
          items={MENU_ITEMS}
          onClick={handleMenuClick}
        />
      </Sider>
      <Layout>
        <Header style={{ padding: 0, background: '#fff' }}>
          {/* é¡¶éƒ¨æ  */}
        </Header>
        <Content style={{ margin: '24px 16px 0' }}>
          <div style={{ padding: 24, minHeight: 360 }}>
            <Outlet />  {/* å­è·¯ç”±æ¸²æŸ“ä½ç½® */}
          </div>
        </Content>
      </Layout>
    </Layout>
  )
}
```

### 4.4 çŠ¶æ€ç®¡ç†

#### 4.4.1 Zustand Store

**ä½ç½®**: `frontend/src/stores/`

**è®¤è¯çŠ¶æ€** (`stores/useAuthStore.ts`)ï¼š
```typescript
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface User {
  id: number
  username: string
  email: string
  role: string
}

interface AuthState {
  user: User | null
  token: string | null
  isAuthenticated: boolean
  isLoading: boolean

  // Actions
  login: (username: string, password: string) => Promise<void>
  logout: () => void
  fetchCurrentUser: () => Promise<void>
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      isLoading: false,

      login: async (username, password) => {
        set({ isLoading: true })
        try {
          const response = await authService.login({ username, password })
          set({
            user: response.data.user,
            token: response.data.access_token,
            isAuthenticated: true,
            isLoading: false
          })
        } catch (error) {
          set({ isLoading: false })
          throw error
        }
      },

      logout: () => {
        set({
          user: null,
          token: null,
          isAuthenticated: false
        })
      },

      fetchCurrentUser: async () => {
        const token = get().token
        if (!token) return

        try {
          const response = await authService.getCurrentUser()
          set({ user: response.data })
        } catch (error) {
          get().logout()
        }
      }
    }),
    {
      name: 'auth-storage',  // localStorage key
      partialize: (state) => ({
        token: state.token,
        user: state.user
      })  // åªæŒä¹…åŒ–éƒ¨åˆ†çŠ¶æ€
    }
  )
)
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
function LoginPage() {
  const { login, isLoading } = useAuthStore()

  const handleLogin = async (values: LoginForm) => {
    try {
      await login(values.username, values.password)
      // ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°é¦–é¡µ
      navigate('/dashboard')
    } catch (error) {
      message.error('ç™»å½•å¤±è´¥')
    }
  }

  return <Form onFinish={handleLogin}>...</Form>
}
```

#### 4.4.2 React Query (æœåŠ¡å™¨çŠ¶æ€)

**å®‰è£…**ï¼š
```bash
npm install @tanstack/react-query
```

**é…ç½®** (`main.tsx`)ï¼š
```typescript
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 1,
      staleTime: 5 * 60 * 1000,  // 5åˆ†é’Ÿ
    },
  },
})

root.render(
  <QueryClientProvider client={queryClient}>
    <App />
  </QueryClientProvider>
)
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { requirementService } from '@/services/requirement.service'

function RequirementsListPage() {
  const queryClient = useQueryClient()

  // æŸ¥è¯¢éœ€æ±‚åˆ—è¡¨
  const {
    data: requirements,
    isLoading,
    error
  } = useQuery({
    queryKey: ['requirements'],
    queryFn: () => requirementService.getRequirements(),
  })

  // åˆ é™¤éœ€æ±‚
  const deleteMutation = useMutation({
    mutationFn: (id: number) => requirementService.deleteRequirement(id),
    onSuccess: () => {
      // åˆ·æ–°åˆ—è¡¨
      queryClient.invalidateQueries({ queryKey: ['requirements'] })
      message.success('åˆ é™¤æˆåŠŸ')
    },
  })

  if (isLoading) return <Loading />
  if (error) return <Error />

  return (
    <Table
      dataSource={requirements?.data}
      onRow={(record) => ({
        onDelete: () => deleteMutation.mutate(record.id)
      })}
    />
  )
}
```

### 4.5 APIæœåŠ¡å±‚

#### 4.5.1 Axiosé…ç½®

**ä½ç½®**: `frontend/src/services/api.ts`

```typescript
import axios, { AxiosInstance, AxiosRequestConfig } from 'axios'

// åˆ›å»ºAxioså®ä¾‹
const api: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:8000/api/v1',
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
})

// è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ Tokenå’Œç§Ÿæˆ·ID
api.interceptors.request.use(
  (config) => {
    // æ·»åŠ JWT Token
    const token = localStorage.getItem('access_token')
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }

    // æ·»åŠ ç§Ÿæˆ·ID
    if (config.headers) {
      config.headers['X-Tenant-ID'] = '1'  // å½“å‰ç§Ÿæˆ·ID
    }

    return config
  },
  (error) => Promise.reject(error)
)

// å“åº”æ‹¦æˆªå™¨ - ç»Ÿä¸€é”™è¯¯å¤„ç†
api.interceptors.response.use(
  (response) => response.data,  // ç›´æ¥è¿”å›data
  (error) => {
    if (error.response?.status === 401) {
      // Tokenè¿‡æœŸï¼Œæ¸…é™¤æœ¬åœ°å­˜å‚¨å¹¶è·³è½¬ç™»å½•
      localStorage.removeItem('access_token')
      window.location.href = '/login'
    }
    return Promise.reject(error.response?.data)
  }
)

// å°è£…å¸¸ç”¨æ–¹æ³•
export const apiGet = <T>(url: string, config?: AxiosRequestConfig) =>
  api.get<T>(url, config)

export const apiPost = <T>(url: string, data?: any, config?: AxiosRequestConfig) =>
  api.post<T>(url, data, config)

export const apiPut = <T>(url: string, data?: any, config?: AxiosRequestConfig) =>
  api.put<T>(url, data, config)

export const apiDelete = <T>(url: string, config?: AxiosRequestConfig) =>
  api.delete<T>(url, config)

export { api }
```

#### 4.5.2 æœåŠ¡å±‚ç¤ºä¾‹

**ä½ç½®**: `frontend/src/services/requirement.service.ts`

```typescript
import { apiGet, apiPost, apiPut, apiDelete } from './api'
import type { Requirement, RequirementListParams } from '@/shared/types/api'

export const requirementService = {
  // è·å–éœ€æ±‚åˆ—è¡¨
  getRequirements: async (params?: RequirementListParams) => {
    return apiGet('/requirements', { params })
  },

  // è·å–éœ€æ±‚è¯¦æƒ…
  getRequirement: async (id: number) => {
    return apiGet(`/requirements/${id}`)
  },

  // åˆ›å»ºéœ€æ±‚
  createRequirement: async (data: CreateRequirementRequest) => {
    return apiPost('/requirements', data)
  },

  // æ›´æ–°éœ€æ±‚
  updateRequirement: async (id: number, data: Partial<Requirement>) => {
    return apiPut(`/requirements/${id}`, data)
  },

  // åˆ é™¤éœ€æ±‚
  deleteRequirement: async (id: number) => {
    return apiDelete(`/requirements/${id}`)
  },

  // æ›´æ–°éœ€æ±‚çŠ¶æ€
  updateStatus: async (id: number, status: string) => {
    return apiPost(`/requirements/${id}/status`, { status })
  },

  // è·å–ç»Ÿè®¡æ•°æ®
  getStats: async () => {
    return apiGet('/requirements/stats/summary')
  },

  // è·å–å·¥ä½œæµå†å²
  getRequirementHistory: async (id: number, limit: number = 50) => {
    return apiGet(`/requirements/${id}/history?limit=${limit}`)
  },

  // æ·»åŠ å†å²å¤‡æ³¨
  addHistoryNote: async (id: number, data: { comments: string }) => {
    return apiPost(`/requirements/${id}/history`, data)
  },
}
```

### 4.6 ç»„ä»¶å¼€å‘ç¤ºä¾‹

#### 4.6.1 éœ€æ±‚å†å²æ—¶é—´è½´ç»„ä»¶

**ä½ç½®**: `frontend/src/components/requirements/RequirementHistoryTimeline.tsx`

```typescript
import { useEffect, useState } from 'react'
import { Timeline, ClockCircleOutlined, Tag, Button, Modal } from 'antd'
import { requirementService } from '@/services/requirement.service'

interface HistoryItem {
  id: number
  action: string
  from_status: string | null
  to_status: string
  comments: string | null
  performed_at: string
  performed_by: number
}

export function RequirementHistoryTimeline({ requirementId }: { requirementId: number }) {
  const [history, setHistory] = useState<HistoryItem[]>([])
  const [loading, setLoading] = useState(false)
  const [modalVisible, setModalVisible] = useState(false)

  // åŠ è½½å†å²è®°å½•
  useEffect(() => {
    loadHistory()
  }, [requirementId])

  const loadHistory = async () => {
    setLoading(true)
    try {
      const response = await requirementService.getRequirementHistory(requirementId)
      setHistory(response.data)
    } catch (error) {
      message.error('è·å–å†å²è®°å½•å¤±è´¥')
    } finally {
      setLoading(false)
    }
  }

  // æ¸²æŸ“æ—¶é—´è½´é¡¹ç›®
  const timelineItems = history.map((item) => {
    let content = null

    if (item.action === 'status_changed') {
      content = (
        <div>
          <p>çŠ¶æ€å˜æ›´</p>
          <div>
            {renderStatusTag(item.from_status)} â†’ {renderStatusTag(item.to_status)}
          </div>
          <p>æ“ä½œäºº: ID {item.performed_by}</p>
          <p>æ—¶é—´: {new Date(item.performed_at).toLocaleString()}</p>
        </div>
      )
    } else if (item.action === 'note_added') {
      content = (
        <div>
          <p>æ·»åŠ å¤‡æ³¨</p>
          <p>{item.comments}</p>
          <p>æ“ä½œäºº: ID {item.performed_by}</p>
        </div>
      )
    }

    return {
      key: item.id,
      dot: <ClockCircleOutlined style={{ fontSize: '16px' }} />,
      children: content,
    }
  })

  return (
    <div>
      <Timeline mode="left" items={timelineItems} />

      <Button
        type="primary"
        onClick={() => setModalVisible(true)}
      >
        æ·»åŠ å¤‡æ³¨
      </Button>

      <Modal
        title="æ·»åŠ å¤‡æ³¨"
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        onOk={handleAddNote}
      >
        <TextArea
          placeholder="è¯·è¾“å…¥å¤‡æ³¨å†…å®¹"
          rows={4}
          value={note}
          onChange={(e) => setNote(e.target.value)}
        />
      </Modal>
    </div>
  )
}
```

---

## 5. æ•°æ®åº“è®¾è®¡

### 5.1 æ ¸å¿ƒè¡¨ç»“æ„

#### 5.1.1 ç”¨æˆ·å’Œç§Ÿæˆ·

**tenants** (ç§Ÿæˆ·è¡¨)
```sql
CREATE TABLE tenants (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**users** (ç”¨æˆ·è¡¨)
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,  -- admin/product_manager/marketing_manager/sales_manager
    tenant_id INTEGER REFERENCES tenants(id) ON DELETE CASCADE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_tenant ON users(tenant_id);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
```

#### 5.1.2 éœ€æ±‚ä¸»è¡¨

**requirements** (éœ€æ±‚è¡¨)
```sql
CREATE TABLE requirements (
    id SERIAL PRIMARY KEY,
    requirement_no VARCHAR(50) UNIQUE NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,

    -- ç”¨æˆ·æ•…äº‹
    user_story_role VARCHAR(100),
    user_story_action VARCHAR(200),
    user_story_benefit VARCHAR(200),

    -- æ¥æºä¿¡æ¯
    source_channel VARCHAR(50) NOT NULL,  -- customer/market/sales/rd/after_sales
    source_contact VARCHAR(100),

    -- å®¢æˆ·åé—®ï¼ˆJSONBæ ¼å¼ï¼‰
    customer_need_10q JSONB,

    -- åˆ†æç»“æœï¼ˆJSONBæ ¼å¼ï¼‰
    kano_category VARCHAR(50),
    appeals_scores JSONB,
    invest_analysis JSONB,
    moscow_priority VARCHAR(50),
    rice_score JSONB,

    -- åˆ†å‘ä¿¡æ¯
    target_type VARCHAR(50),  -- sp/bp/charter/pcr
    target_id INTEGER,

    -- å…ƒæ•°æ®
    status VARCHAR(50) DEFAULT 'collected',
    priority_score FLOAT,
    complexity_level VARCHAR(50),
    estimated_duration_months INTEGER,

    -- ç§Ÿæˆ·å’Œæ—¶é—´æˆ³
    tenant_id INTEGER REFERENCES tenants(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_requirements_tenant ON requirements(tenant_id);
CREATE INDEX idx_requirements_status ON requirements(status);
CREATE INDEX idx_requirements_no ON requirements(requirement_no);
```

#### 5.1.3 éªŒè¯å’Œè¿½æº¯

**verification_records** (éªŒè¯è®°å½•è¡¨)
```sql
CREATE TABLE verification_records (
    id SERIAL PRIMARY KEY,
    requirement_id INTEGER REFERENCES requirements(id) ON DELETE CASCADE,
    checklist_id INTEGER REFERENCES verification_checklists(id),
    verification_type VARCHAR(50) NOT NULL,  -- prototype/test/user_trial/customer_confirmation
    result VARCHAR(50) NOT NULL,  -- passed/failed/partial_passed/pending
    verification_date DATE,
    verifier_id INTEGER REFERENCES users(id),
    notes TEXT,
    attachments JSONB,
    tenant_id INTEGER REFERENCES tenants(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_verification_requirement ON verification_records(requirement_id);
CREATE INDEX idx_verification_tenant ON verification_records(tenant_id);
```

**traceability_links** (è¿½æº¯å…³è”è¡¨)
```sql
CREATE TABLE traceability_links (
    id SERIAL PRIMARY KEY,
    requirement_id INTEGER REFERENCES requirements(id) ON DELETE CASCADE,
    linked_requirement_id INTEGER REFERENCES requirements(id) ON DELETE CASCADE,
    link_type VARCHAR(50) NOT NULL,  -- derives/relates_to/conflicts_with/duplicates
    description TEXT,
    tenant_id INTEGER REFERENCES tenants(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_traceability_from ON traceability_links(requirement_id);
CREATE INDEX idx_traceability_to ON traceability_links(linked_requirement_id);
```

#### 5.1.4 å·¥ä½œæµå†å²

**workflow_history** (å·¥ä½œæµå†å²è¡¨)
```sql
CREATE TABLE workflow_history (
    id SERIAL PRIMARY KEY,
    requirement_id INTEGER REFERENCES requirements(id) ON DELETE CASCADE,
    action VARCHAR(50) NOT NULL,  -- created/status_changed/updated/assigned
    from_status VARCHAR(50),
    to_status VARCHAR(50),
    comments TEXT,
    performed_by INTEGER REFERENCES users(id),
    performed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    tenant_id INTEGER REFERENCES tenants(id) ON DELETE CASCADE
);

CREATE INDEX idx_workflow_requirement ON workflow_history(requirement_id);
CREATE INDEX idx_workflow_tenant ON workflow_history(tenant_id);
```

### 5.2 ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   tenants   â”‚1       *â”‚     users    â”‚        *â”‚ requirementsâ”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id          â”‚         â”‚ id           â”‚         â”‚ id          â”‚
â”‚ name        â”‚         â”‚ username     â”‚         â”‚ title       â”‚
â”‚ code        â”‚         â”‚ email        â”‚         â”‚ status      â”‚
â”‚ is_active   â”‚         â”‚ role         â”‚         â”‚ tenant_id   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ tenant_id    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ï¿½                  â”‚
                                                          â”‚ 1
                                                          â”‚
                                                          â”‚ *
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ workflow_history       â”‚          â”‚ verification_recordsâ”‚
                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                    â”‚ requirement_id         â”‚          â”‚ requirement_id     â”‚
                    â”‚ action                 â”‚          â”‚ result             â”‚
                    â”‚ from_status            â”‚          â”‚ verification_type  â”‚
                    â”‚ to_status              â”‚          â”‚ tenant_id          â”‚
                    â”‚ performed_by           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ tenant_id              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

---

## 6. APIæ¥å£è®¾è®¡

### 6.1 RESTfulè§„èŒƒ

**åŸºç¡€URL**: `http://localhost:8000/api/v1`

**é€šç”¨å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "data": {...},
  "message": "æ“ä½œæˆåŠŸ",
  "total": 100
}
```

**é”™è¯¯å“åº”æ ¼å¼**ï¼š
```json
{
  "detail": "é”™è¯¯æè¿°"
}
```

### 6.2 è®¤è¯æ¥å£

#### 6.2.1 ç”¨æˆ·ç™»å½•

**è¯·æ±‚**:
```http
POST /api/v1/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "password123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "bearer",
    "user": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin"
    }
  }
}
```

#### 6.2.2 è·å–å½“å‰ç”¨æˆ·

**è¯·æ±‚**:
```http
GET /api/v1/auth/me
Authorization: Bearer {token}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "role": "admin",
    "tenant_id": 1
  }
}
```

### 6.3 éœ€æ±‚ç®¡ç†æ¥å£

#### 6.3.1 è·å–éœ€æ±‚åˆ—è¡¨

**è¯·æ±‚**:
```http
GET /api/v1/requirements?page=1&page_size=20&status=collected
Authorization: Bearer {token}
X-Tenant-ID: 1
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `status`: éœ€æ±‚çŠ¶æ€ç­›é€‰
- `source_channel`: æ¥æºæ¸ é“ç­›é€‰
- `search`: æœç´¢å…³é”®è¯

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "requirement_no": "REQ-2026-001",
      "title": "ç”¨æˆ·ç™»å½•åŠŸèƒ½",
      "description": "æ”¯æŒç”¨æˆ·åå¯†ç ç™»å½•",
      "status": "collected",
      "source_channel": "customer",
      "priority_score": 85.5,
      "created_at": "2026-01-21T10:00:00Z"
    }
  ],
  "total": 100,
  "page": 1,
  "page_size": 20
}
```

#### 6.3.2 åˆ›å»ºéœ€æ±‚

**è¯·æ±‚**:
```http
POST /api/v1/requirements
Authorization: Bearer {token}
X-Tenant-ID: 1
Content-Type: application/json

{
  "title": "ç”¨æˆ·ç™»å½•åŠŸèƒ½",
  "description": "æ”¯æŒç”¨æˆ·åå¯†ç ç™»å½•",
  "source_channel": "customer",
  "user_story_role": "ä½œä¸ºç³»ç»Ÿç”¨æˆ·",
  "user_story_action": "æˆ‘å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•",
  "user_story_benefit": "ä»¥ä¾¿å®‰å…¨åœ°è®¿é—®ç³»ç»ŸåŠŸèƒ½",
  "customer_need_10q": {
    "q1_who_cares": "ç³»ç»Ÿç”¨æˆ·",
    "q2_why_care": "éœ€è¦è®¿é—®ç³»ç»Ÿ"
  }
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "requirement_no": "REQ-2026-001",
    "title": "ç”¨æˆ·ç™»å½•åŠŸèƒ½",
    "status": "collected",
    "created_at": "2026-01-21T10:00:00Z"
  },
  "message": "éœ€æ±‚åˆ›å»ºæˆåŠŸ"
}
```

#### 6.3.3 æ›´æ–°éœ€æ±‚çŠ¶æ€

**è¯·æ±‚**:
```http
POST /api/v1/requirements/{id}/status
Authorization: Bearer {token}
X-Tenant-ID: 1
Content-Type: application/json

{
  "status": "analyzing",
  "comments": "å¼€å§‹åˆ†æéœ€æ±‚"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "status": "analyzing"
  },
  "message": "çŠ¶æ€æ›´æ–°æˆåŠŸ"
}
```

#### 6.3.4 è·å–å·¥ä½œæµå†å²

**è¯·æ±‚**:
```http
GET /api/v1/requirements/{id}/history?limit=50
Authorization: Bearer {token}
X-Tenant-ID: 1
```

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "action": "status_changed",
      "from_status": "collected",
      "to_status": "analyzing",
      "comments": "å¼€å§‹åˆ†æéœ€æ±‚",
      "performed_by": 1,
      "performed_at": "2026-01-21T10:05:00Z"
    },
    {
      "id": 2,
      "action": "note_added",
      "comments": "è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„éœ€æ±‚",
      "performed_by": 1,
      "performed_at": "2026-01-21T10:10:00Z"
    }
  ]
}
```

### 6.4 éªŒè¯ç®¡ç†æ¥å£

#### 6.4.1 è·å–éœ€æ±‚éªŒè¯åˆ—è¡¨

**è¯·æ±‚**:
```http
GET /api/v1/verification/requirements/{requirement_id}/verifications
Authorization: Bearer {token}
X-Tenant-ID: 1
```

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "requirement_id": 1,
      "verification_type": "prototype",
      "result": "passed",
      "verification_date": "2026-01-22",
      "verifier": {
        "id": 1,
        "username": "admin"
      }
    }
  ]
}
```

### 6.5 è¿½æº¯çŸ©é˜µæ¥å£

#### 6.5.1 åˆ›å»ºè¿½æº¯å…³è”

**è¯·æ±‚**:
```http
POST /api/v1/rtm/links
Authorization: Bearer {token}
X-Tenant-ID: 1
Content-Type: application/json

{
  "requirement_id": 1,
  "linked_requirement_id": 2,
  "link_type": "derives",
  "description": "å­éœ€æ±‚"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "requirement_id": 1,
    "linked_requirement_id": 2,
    "link_type": "derives"
  },
  "message": "è¿½æº¯å…³è”åˆ›å»ºæˆåŠŸ"
}
```

---

## 7. çŠ¶æ€ç®¡ç†

### 7.1 å®¢æˆ·ç«¯çŠ¶æ€ (Zustand)

**ä½¿ç”¨åœºæ™¯**ï¼šUIçŠ¶æ€ã€ç”¨æˆ·åå¥½ã€ä¸´æ—¶æ•°æ®

**ä¼˜ç‚¹**ï¼š
- âœ… è½»é‡çº§ï¼ˆå‹ç¼©å1KBï¼‰
- âœ… ç®€å•æ˜“ç”¨
- âœ… æ— éœ€ProvideråŒ…è£¹
- âœ… æ”¯æŒæŒä¹…åŒ–

**ç¤ºä¾‹**ï¼š
```typescript
// åˆ›å»ºStore
const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      login: async (username, password) => {
        const response = await authService.login({ username, password })
        set({ user: response.data.user, token: response.data.token })
      }
    }),
    { name: 'auth-storage' }
  )
)

// ä½¿ç”¨Store
function LoginPage() {
  const { login } = useAuthStore()
  // ...
}
```

### 7.2 æœåŠ¡å™¨çŠ¶æ€ (React Query)

**ä½¿ç”¨åœºæ™¯**ï¼šAPIæ•°æ®ã€ç¼“å­˜ã€åŒæ­¥

**ä¼˜ç‚¹**ï¼š
- âœ… è‡ªåŠ¨ç¼“å­˜
- âœ… è‡ªåŠ¨é‡æ–°éªŒè¯
- âœ… ä¹è§‚æ›´æ–°
- âœ… åˆ†é¡µå’Œæ— é™æ»šåŠ¨æ”¯æŒ

**ç¤ºä¾‹**ï¼š
```typescript
// æŸ¥è¯¢æ•°æ®
const { data, isLoading, error } = useQuery({
  queryKey: ['requirements'],
  queryFn: () => requirementService.getRequirements(),
})

// ä¿®æ”¹æ•°æ®
const mutation = useMutation({
  mutationFn: (data) => requirementService.create(data),
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['requirements'] })
  },
})
```

### 7.3 çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ

| çŠ¶æ€ç±»å‹ | ä½¿ç”¨æ–¹æ¡ˆ | ç¤ºä¾‹ |
|---------|---------|------|
| UIçŠ¶æ€ | Zustand | æ¨¡æ€æ¡†å¼€å…³ã€ä¾§è¾¹æ å±•å¼€çŠ¶æ€ |
| ç”¨æˆ·è®¤è¯ | Zustand + persist | ç”¨æˆ·ä¿¡æ¯ã€Token |
| æœåŠ¡å™¨æ•°æ® | React Query | éœ€æ±‚åˆ—è¡¨ã€ç”¨æˆ·è¯¦æƒ… |
| è¡¨å•çŠ¶æ€ | React Hook Form | è¡¨å•è¾“å…¥ã€éªŒè¯ |
| URLçŠ¶æ€ | React Router | æœç´¢å‚æ•°ã€è·¯ç”±å‚æ•° |

---

## 8. è®¤è¯ä¸æƒé™

### 8.1 JWTè®¤è¯æµç¨‹

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. åç«¯éªŒè¯ç”¨æˆ·åå¯†ç 
   â†“
3. ç”ŸæˆJWT Token (åŒ…å«ç”¨æˆ·IDã€è¿‡æœŸæ—¶é—´)
   â†“
4. è¿”å›Tokenç»™å‰ç«¯
   â†“
5. å‰ç«¯å­˜å‚¨Token (localStorage)
   â†“
6. åç»­è¯·æ±‚æºå¸¦Token (Authorization: Bearer {token})
   â†“
7. åç«¯éªŒè¯Token
   â†“
8. å…è®¸è®¿é—®å—ä¿æŠ¤èµ„æº
```

### 8.2 Tokenç»“æ„

**JWT Payload**:
```json
{
  "sub": "1",              // ç”¨æˆ·ID
  "username": "admin",     // ç”¨æˆ·å
  "exp": 1707523200        // è¿‡æœŸæ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼‰
}
```

**åç«¯ç”ŸæˆToken** (`backend/app/core/security.py`)ï¼š
```python
from datetime import datetime, timedelta
from jose import JWTError, jwt

def create_access_token(data: dict, expires_delta: timedelta | None = None):
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=10080)  # 7å¤©

    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt
```

**å‰ç«¯ä½¿ç”¨Token** (`frontend/src/services/api.ts`)ï¼š
```typescript
// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('access_token')
  if (token && config.headers) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})
```

### 8.3 RBACæƒé™ç³»ç»Ÿ

**è§’è‰²å®šä¹‰** (`backend/app/core/permissions.py`)ï¼š
```python
# è§’è‰²åˆ—è¡¨
ROLES = {
    "admin": "ç®¡ç†å‘˜",
    "product_manager": "äº§å“ç»ç†",
    "marketing_manager": "å¸‚åœºç»ç†",
    "sales_manager": "é”€å”®ç»ç†",
}

# æƒé™å®šä¹‰ï¼ˆ37ç§æƒé™ï¼‰
PERMISSIONS = {
    # éœ€æ±‚ç®¡ç†
    "requirement:create": "åˆ›å»ºéœ€æ±‚",
    "requirement:read": "æŸ¥çœ‹éœ€æ±‚",
    "requirement:update": "æ›´æ–°éœ€æ±‚",
    "requirement:delete": "åˆ é™¤éœ€æ±‚",

    # åˆ†æç®¡ç†
    "analysis:create": "åˆ›å»ºåˆ†æ",
    "analysis:read": "æŸ¥çœ‹åˆ†æ",
    "analysis:update": "æ›´æ–°åˆ†æ",
    "analysis:approve": "å®¡æ‰¹åˆ†æ",

    # éªŒè¯ç®¡ç†
    "verification:create": "åˆ›å»ºéªŒè¯",
    "verification:read": "æŸ¥çœ‹éªŒè¯",
    "verification:update": "æ›´æ–°éªŒè¯",
    "verification:approve": "å®¡æ‰¹éªŒè¯",

    # è¿½æº¯ç®¡ç†
    "rtm:read": "æŸ¥çœ‹è¿½æº¯çŸ©é˜µ",
    "rtm:update": "æ›´æ–°è¿½æº¯çŸ©é˜µ",

    # ... æ›´å¤šæƒé™
}

# è§’è‰²æƒé™æ˜ å°„
ROLE_PERMISSIONS = {
    "admin": ["*"],  # å…¨éƒ¨æƒé™

    "product_manager": [
        "requirement:*",
        "analysis:*",
        "verification:*",
        "rtm:*",
        "distribution:*",
    ],

    "marketing_manager": [
        "requirement:create",
        "requirement:read",
        "analysis:create",
        "analysis:read",
    ],

    "sales_manager": [
        "requirement:create",
        "requirement:read",
    ],
}
```

**æƒé™æ£€æŸ¥è£…é¥°å™¨**ï¼š
```python
from functools import wraps
from fastapi import HTTPException, Depends
from app.core.permissions import ROLE_PERMISSIONS

def require_permission(permission: str):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, current_user: User = Depends(get_current_user), **kwargs):
            # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è¯¥æƒé™
            user_permissions = ROLE_PERMISSIONS.get(current_user.role, [])

            if "*" not in user_permissions and permission not in user_permissions:
                raise HTTPException(
                    status_code=403,
                    detail=f"ç¼ºå°‘æƒé™: {permission}"
                )

            return await func(*args, current_user=current_user, **kwargs)
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@app.post("/requirements")
@require_permission("requirement:create")
async def create_requirement(
    data: RequirementCreate,
    current_user: User = Depends(get_current_user)
):
    # ...
```

### 8.4 å‰ç«¯æƒé™æ§åˆ¶

**æƒé™Hook** (`frontend/src/hooks/usePermissions.ts`)ï¼š
```typescript
import { useAuthStore } from '@/stores/useAuthStore'

export function usePermissions() {
  const { user } = useAuthStore()

  const hasPermission = (permission: string) => {
    if (!user) return false

    // ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™
    if (user.role === 'admin') return true

    // æ ¹æ®è§’è‰²æ£€æŸ¥æƒé™
    const rolePermissions = ROLE_PERMISSIONS[user.role] || []
    return rolePermissions.includes(permission) || rolePermissions.includes('*')
  }

  const hasAnyPermission = (permissions: string[]) => {
    return permissions.some(p => hasPermission(p))
  }

  return { hasPermission, hasAnyPermission }
}

// ä½¿ç”¨ç¤ºä¾‹
function RequirementActions({ requirement }) {
  const { hasPermission } = usePermissions()

  return (
    <div>
      {hasPermission('requirement:update') && (
        <Button onClick={onEdit}>ç¼–è¾‘</Button>
      )}
      {hasPermission('requirement:delete') && (
        <Button onClick={onDelete}>åˆ é™¤</Button>
      )}
    </div>
  )
}
```

---

## 9. å¤šç§Ÿæˆ·æ¶æ„

### 9.1 ç§Ÿæˆ·éš”ç¦»æœºåˆ¶

**éš”ç¦»çº§åˆ«**ï¼š**å®Œå…¨éš”ç¦»**

æ¯ä¸ªç§Ÿæˆ·çš„æ•°æ®å®Œå…¨ç‹¬ç«‹ï¼Œé€šè¿‡`tenant_id`å­—æ®µå®ç°ç‰©ç†éš”ç¦»ã€‚

### 9.2 ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç®¡ç†

**åç«¯å®ç°** (`backend/app/core/tenant.py`)ï¼š
```python
from contextvars import ContextVar
from fastapi import Request

# ä½¿ç”¨ContextVarå­˜å‚¨ç§Ÿæˆ·ä¸Šä¸‹æ–‡ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
tenant_context: ContextVar[int | None] = ContextVar("tenant_context", default=None)

def get_current_tenant() -> int | None:
    """è·å–å½“å‰ç§Ÿæˆ·ID"""
    return tenant_context.get()

def set_tenant_context(tenant_id: int) -> None:
    """è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡"""
    tenant_context.set(tenant_id)

async def tenant_middleware(request: Request, call_next):
    """ç§Ÿæˆ·ä¸­é—´ä»¶ï¼šä»è¯·æ±‚å¤´æå–ç§Ÿæˆ·ID"""
    tenant_id = request.headers.get("x-tenant-id")

    if tenant_id:
        try:
            set_tenant_context(int(tenant_id))
        except ValueError:
            pass  # æ— æ•ˆçš„ç§Ÿæˆ·ID

    response = await call_next(request)
    return response
```

### 9.3 è‡ªåŠ¨ç§Ÿæˆ·è¿‡æ»¤

**åœ¨Repositoryå±‚å®ç°** (`backend/app/repositories/base.py`)ï¼š
```python
class BaseRepository(Generic[ModelType]):
    def _get_query(self):
        """è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·è¿‡æ»¤"""
        query = select(self.model)

        # å¦‚æœæ¨¡å‹æœ‰tenant_idå­—æ®µï¼Œè‡ªåŠ¨æ·»åŠ è¿‡æ»¤
        if hasattr(self.model, "tenant_id"):
            tenant_id = get_current_tenant()
            if tenant_id:
                query = query.where(self.model.tenant_id == tenant_id)

        return query

    async def get_by_id(self, id: int) -> Optional[ModelType]:
        # è‡ªåŠ¨åªæŸ¥è¯¢å½“å‰ç§Ÿæˆ·çš„æ•°æ®
        query = self._get_query().where(self.model.id == id)
        result = await self.session.execute(query)
        return result.scalar_one_or_none()
```

### 9.4 å‰ç«¯ç§Ÿæˆ·IDè®¾ç½®

**åœ¨Axiosæ‹¦æˆªå™¨ä¸­è®¾ç½®** (`frontend/src/services/api.ts`)ï¼š
```typescript
api.interceptors.request.use((config) => {
  // ä»ç”¨æˆ·ä¿¡æ¯ä¸­è·å–ç§Ÿæˆ·ID
  const userStr = localStorage.getItem('user')
  if (userStr) {
    const user = JSON.parse(userStr)
    if (user.tenant_id && config.headers) {
      config.headers['X-Tenant-ID'] = user.tenant_id.toString()
    }
  }

  return config
})
```

### 9.5 æ•°æ®åº“çº§éš”ç¦»

**å¤–é”®çº¦æŸ**ï¼š
```sql
-- æ‰€æœ‰ä¸šåŠ¡è¡¨éƒ½æ·»åŠ å¤–é”®çº¦æŸ
ALTER TABLE requirements
ADD CONSTRAINT fk_requirements_tenant
FOREIGN KEY (tenant_id) REFERENCES tenants(id) ON DELETE CASCADE;

-- çº§è”åˆ é™¤ï¼šåˆ é™¤ç§Ÿæˆ·æ—¶è‡ªåŠ¨åˆ é™¤æ‰€æœ‰ç›¸å…³æ•°æ®
```

**ç´¢å¼•ä¼˜åŒ–**ï¼š
```sql
-- ä¸ºç§Ÿæˆ·IDåˆ›å»ºç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_requirements_tenant ON requirements(tenant_id);
CREATE INDEX idx_users_tenant ON users(tenant_id);
```

---

## 10. å¼€å‘å·¥ä½œæµ

### 10.1 Gitåˆ†æ”¯ç­–ç•¥

```
main (ç”Ÿäº§åˆ†æ”¯)
  â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯) â† å½“å‰å¼€å‘åœ¨æ­¤åˆ†æ”¯
  â”œâ”€â”€ feature/xxx (åŠŸèƒ½åˆ†æ”¯)
  â””â”€â”€ hotfix/xxx (çƒ­ä¿®å¤åˆ†æ”¯)
```

**åˆ†æ”¯è§„èŒƒ**ï¼š
- `main`: ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼Œä¿æŒç¨³å®š
- `develop`: å¼€å‘ç¯å¢ƒåˆ†æ”¯ï¼Œé›†æˆæœ€æ–°åŠŸèƒ½
- `feature/åŠŸèƒ½å`: åŠŸèƒ½å¼€å‘åˆ†æ”¯
- `hotfix/é—®é¢˜å`: ç´§æ€¥ä¿®å¤åˆ†æ”¯

### 10.2 æäº¤è§„èŒƒ

**Conventional Commits**ï¼š
```
<type>: <subject>

typeç±»å‹:
- feat: æ–°åŠŸèƒ½
- fix: ä¿®å¤bug
- docs: æ–‡æ¡£æ›´æ–°
- style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- refactor: é‡æ„
- test: æµ‹è¯•ç›¸å…³
- chore: æ„å»º/å·¥å…·ç›¸å…³

ç¤ºä¾‹:
feat: æ·»åŠ éœ€æ±‚éªŒè¯æ¸…å•åŠŸèƒ½
fix: ä¿®å¤éªŒè¯æ¸…å•APIçš„Pydanticåºåˆ—åŒ–é—®é¢˜
docs: æ›´æ–°æŠ€æœ¯ä½“ç³»æ–‡æ¡£
```

### 10.3 å¼€å‘æµç¨‹

**1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**ï¼š
```bash
git checkout develop
git pull origin develop
git checkout -b feature/requirement-verification
```

**2. å¼€å‘å’Œæµ‹è¯•**ï¼š
```bash
# å¼€å‘...
npm run dev  # å‰ç«¯
uvicorn app.main:app --reload  # åç«¯

# æµ‹è¯•
npm run test  # å‰ç«¯æµ‹è¯•
pytest  # åç«¯æµ‹è¯•
```

**3. æäº¤ä»£ç **ï¼š
```bash
git add .
git commit -m "feat: æ·»åŠ éœ€æ±‚éªŒè¯æ¸…å•åŠŸèƒ½"
git push origin feature/requirement-verification
```

**4. åˆ›å»ºPull Request**ï¼š
- åœ¨GitHub/GitLabåˆ›å»ºPR
- å¡«å†™PRæè¿°
- è¯·æ±‚ä»£ç å®¡æŸ¥

**5. åˆå¹¶åˆ°develop**ï¼š
```bash
git checkout develop
git merge feature/requirement-verification
git push origin develop
```

**6. åˆ é™¤åŠŸèƒ½åˆ†æ”¯**ï¼š
```bash
git branch -d feature/requirement-verification
git push origin --delete feature/requirement-verification
```

### 10.4 ä»£ç å®¡æŸ¥æ¸…å•

**åŠŸèƒ½å®¡æŸ¥**ï¼š
- [ ] åŠŸèƒ½æ˜¯å¦æŒ‰éœ€æ±‚å®ç°
- [ ] è¾¹ç•Œæƒ…å†µæ˜¯å¦å¤„ç†
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„

**ä»£ç è´¨é‡**ï¼š
- [ ] ä»£ç æ˜¯å¦éµå¾ªè§„èŒƒ
- [ ] å˜é‡å‘½åæ˜¯å¦æ¸…æ™°
- [ ] æ˜¯å¦æœ‰é‡å¤ä»£ç 
- [ ] æ³¨é‡Šæ˜¯å¦å……åˆ†

**æ€§èƒ½å®¡æŸ¥**ï¼š
- [ ] æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜
- [ ] æ•°æ®åº“æŸ¥è¯¢æ˜¯å¦ä¼˜åŒ–
- [ ] æ˜¯å¦æœ‰å†…å­˜æ³„æ¼

**å®‰å…¨å®¡æŸ¥**ï¼š
- [ ] æ˜¯å¦æœ‰å®‰å…¨æ¼æ´
- [ ] æƒé™æ£€æŸ¥æ˜¯å¦å®Œå–„
- [ ] è¾“å…¥éªŒè¯æ˜¯å¦å……åˆ†

**æµ‹è¯•å®¡æŸ¥**ï¼š
- [ ] å•å…ƒæµ‹è¯•æ˜¯å¦è¦†ç›–
- [ ] é›†æˆæµ‹è¯•æ˜¯å¦é€šè¿‡
- [ ] æµ‹è¯•ç”¨ä¾‹æ˜¯å¦å……åˆ†

---

## 11. æµ‹è¯•ä½“ç³»

### 11.1 åç«¯æµ‹è¯•

**æµ‹è¯•æ¡†æ¶**: pytest + pytest-asyncio

**æµ‹è¯•æ–‡ä»¶ç»“æ„**ï¼š
```
backend/tests/
â”œâ”€â”€ conftest.py              # æµ‹è¯•é…ç½®å’ŒFixtures
â”œâ”€â”€ test_auth.py             # è®¤è¯æµ‹è¯•ï¼ˆ5ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ test_requirements.py     # éœ€æ±‚CRUDæµ‹è¯•ï¼ˆ11ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ test_rtm.py              # è¿½æº¯çŸ©é˜µæµ‹è¯•ï¼ˆ18ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ test_appeals.py          # APPEALSåˆ†ææµ‹è¯•ï¼ˆ9ä¸ªæµ‹è¯•ï¼‰
â”œâ”€â”€ test_requirement_history.py  # å·¥ä½œæµå†å²æµ‹è¯•ï¼ˆ9ä¸ªæµ‹è¯•ï¼‰
â””â”€â”€ test_integration.py      # é›†æˆæµ‹è¯•ï¼ˆ6ä¸ªæµ‹è¯•ï¼‰
```

**æµ‹è¯•é…ç½®** (`pytest.ini`)ï¼š
```ini
[pytest]
python_files = test_*.py
python_classes = Test*
python_functions = test_*
testpaths = tests
asyncio_mode = auto

addopts =
    -v
    --strict-markers
    --tb=short
    --cov=app
    --cov-report=html
    --cov-report=term

markers =
    asyncio: Mark test as async
    integration: Mark test as integration test
    unit: Mark test as unit test
```

**æµ‹è¯•ç¤ºä¾‹** (`tests/test_requirements.py`)ï¼š
```python
import pytest
from httpx import AsyncClient
from sqlalchemy.ext.asyncio import AsyncSession

@pytest.mark.asyncio
async def test_create_requirement(
    async_client: AsyncClient,
    test_token: str,
    test_db: AsyncSession
):
    """æµ‹è¯•åˆ›å»ºéœ€æ±‚"""
    response = await async_client.post(
        "/api/v1/requirements",
        json={
            "title": "æµ‹è¯•éœ€æ±‚",
            "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•éœ€æ±‚",
            "source_channel": "customer"
        },
        headers={"Authorization": f"Bearer {test_token}"}
    )

    assert response.status_code == 200
    data = response.json()
    assert data["success"] is True
    assert data["data"]["title"] == "æµ‹è¯•éœ€æ±‚"
    assert data["data"]["requirement_no"].startswith("REQ-")

@pytest.mark.asyncio
async def test_get_requirements_list(
    async_client: AsyncClient,
    test_token: str
):
    """æµ‹è¯•è·å–éœ€æ±‚åˆ—è¡¨"""
    response = await async_client.get(
        "/api/v1/requirements?page=1&page_size=20",
        headers={"Authorization": f"Bearer {test_token}"}
    )

    assert response.status_code == 200
    data = response.json()
    assert data["success"] is True
    assert isinstance(data["data"], list)
```

**Fixtures** (`conftest.py`)ï¼š
```python
import pytest
from httpx import AsyncClient
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from sqlalchemy.orm import sessionmaker

@pytest.fixture
async def async_client():
    """å¼‚æ­¥HTTPå®¢æˆ·ç«¯"""
    async with AsyncClient(app=app, base_url="http://test") as client:
        yield client

@pytest.fixture
async def test_token(async_client: AsyncClient):
    """æµ‹è¯•ç”¨Token"""
    response = await async_client.post(
        "/api/v1/auth/login",
        json={"username": "test_user", "password": "test_pass"}
    )
    return response.json()["data"]["access_token"]

@pytest.fixture
async def test_db():
    """æµ‹è¯•æ•°æ®åº“ä¼šè¯"""
    # ä½¿ç”¨å†…å­˜SQLiteè¿›è¡Œæµ‹è¯•
    engine = create_async_engine("sqlite+aiosqlite:///:memory:")
    async_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)

    async with async_session() as session:
        yield session
```

**è¿è¡Œæµ‹è¯•**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_requirements.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_requirements.py::test_create_requirement -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=app --cov-report=html

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open htmlcov/index.html
```

**æµ‹è¯•è¦†ç›–ç‡**ï¼š
- æ€»ä½“è¦†ç›–ç‡: 58% (1978/3423 è¯­å¥)
- æµ‹è¯•é€šè¿‡ç‡: 100% (58/58)
- æ‰§è¡Œæ—¶é—´: 2.11ç§’

### 11.2 å‰ç«¯æµ‹è¯•

**æµ‹è¯•æ¡†æ¶**: Vitest + @testing-library/react

**æµ‹è¯•æ–‡ä»¶ç»“æ„**ï¼š
```
frontend/src/__tests__/
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ useAuthStore.test.ts        # è®¤è¯çŠ¶æ€æµ‹è¯•
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â””â”€â”€ INVESTScore.test.tsx   # INVESTç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ requirements/
â”‚   â”‚   â””â”€â”€ RequirementHistoryTimeline.test.tsx  # å†å²æ—¶é—´è½´æµ‹è¯•
â”‚   â””â”€â”€ verifications/
â”‚       â””â”€â”€ ChecklistItemView.test.tsx  # éªŒè¯é¡¹æµ‹è¯•
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ rtm/
â”‚       â””â”€â”€ RTMPage.test.tsx       # è¿½æº¯çŸ©é˜µé¡µé¢æµ‹è¯•
â””â”€â”€ services/
    â””â”€â”€ rtm.service.test.ts        # è¿½æº¯æœåŠ¡æµ‹è¯•
```

**æµ‹è¯•é…ç½®** (`vitest.config.ts`)ï¼š
```typescript
export default defineConfig({
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/test/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/mockData',
      ],
    },
  },
})
```

**æµ‹è¯•ç¤ºä¾‹** (`components/requirements/RequirementHistoryTimeline.test.tsx`)ï¼š
```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { render, screen, waitFor } from '@/test/utils/render'
import userEvent from '@testing-library/user-event'
import { RequirementHistoryTimeline } from '@/components/requirements/RequirementHistoryTimeline'

// MockæœåŠ¡
vi.mock('@/services/requirement.service', () => ({
  requirementService: {
    getRequirementHistory: vi.fn(),
    addHistoryNote: vi.fn(),
  },
}))

describe('RequirementHistoryTimeline', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })

  it('should render timeline with history items', async () => {
    const mockHistoryData = {
      success: true,
      data: [
        {
          id: 1,
          action: 'status_changed',
          from_status: 'collected',
          to_status: 'analyzing',
          comments: null,
          performed_at: '2026-01-18T10:30:00Z',
          performed_by: 1,
        },
      ],
    }

    vi.mocked(requirementService.getRequirementHistory).mockResolvedValue(mockHistoryData)

    render(<RequirementHistoryTimeline requirementId={1} />)

    await waitFor(() => {
      expect(screen.getByText('çŠ¶æ€å˜æ›´')).toBeInTheDocument()
    })
  })

  it('should show empty state when no history', async () => {
    vi.mocked(requirementService.getRequirementHistory).mockResolvedValue({
      success: true,
      data: [],
    })

    render(<RequirementHistoryTimeline requirementId={1} />)

    await waitFor(() => {
      expect(screen.getByText('æš‚æ— å†å²è®°å½•')).toBeInTheDocument()
    })
  })
})
```

**è¿è¡Œæµ‹è¯•**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# ç›‘å¬æ¨¡å¼
npm run test:watch

# UIæ¨¡å¼
npm run test:ui

# è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open coverage/index.html
```

**æµ‹è¯•è¦†ç›–ç‡**ï¼š
- é€šè¿‡ç‡: 92.3% (60/65 æµ‹è¯•)
- å¤±è´¥: 5ä¸ªæµ‹è¯•
- è¦†ç›–ç‡: çº¦65%

### 11.3 é›†æˆæµ‹è¯•

**E2Eæµ‹è¯•**ï¼ˆå¯é€‰ï¼‰ï¼š
- ä½¿ç”¨Playwrightæˆ–Cypress
- æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ

**ç¤ºä¾‹æµç¨‹**ï¼š
1. ç”¨æˆ·ç™»å½•
2. åˆ›å»ºéœ€æ±‚
3. æ›´æ–°éœ€æ±‚çŠ¶æ€
4. æ·»åŠ å†å²å¤‡æ³¨
5. æŸ¥çœ‹éœ€æ±‚è¯¦æƒ…

---

## 12. éƒ¨ç½²æŒ‡å—

### 12.1 å¼€å‘ç¯å¢ƒ

**å¯åŠ¨æ•°æ®åº“å’ŒRedis**ï¼š
```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d postgres redis
```

**å¯åŠ¨åç«¯**ï¼š
```bash
cd backend

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è®¾ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ç­‰

# è¿è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**å¯åŠ¨å‰ç«¯**ï¼š
```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—® http://localhost:5173
```

### 12.2 ç”Ÿäº§ç¯å¢ƒ

#### 12.2.1 Dockeréƒ¨ç½²

**ä½¿ç”¨Docker Composeä¸€é”®éƒ¨ç½²**ï¼š
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

**docker-compose.yml**ï¼š
```yaml
version: '3.8'
services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ipd_req_db
      POSTGRES_USER: ipd_user
      POSTGRES_PASSWORD: ipd_pass
    ports: ["5432:5432"]
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ipd_user -d ipd_req_db"]

  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]

  backend:
    build: ./backend
    ports: ["8000:8000"]
    depends_on:
      postgres: { condition: service_healthy }
      redis: { condition: service_healthy }
    environment:
      DATABASE_URL: postgresql://ipd_user:ipd_pass@postgres/ipd_req_db
      REDIS_URL: redis://redis:6379

  frontend:
    build: ./frontend
    ports: ["5173:5173"]
    depends_on: [backend]
    environment:
      VITE_API_URL: http://localhost:8000/api/v1

volumes:
  postgres_data:
```

#### 12.2.2 Kuberneteséƒ¨ç½²

**åˆ›å»ºéƒ¨ç½²æ–‡ä»¶** (`k8s/backend-deployment.yaml`)ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
      - name: backend
        image: ipd-backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        - name: REDIS_URL
          valueFrom:
            configMapKeyRef:
              name: redis-config
              key: url
---
apiVersion: v1
kind: Service
metadata:
  name: backend-service
spec:
  selector:
    app: backend
  ports:
  - protocol: TCP
    port: 8000
    targetPort: 8000
  type: LoadBalancer
```

**éƒ¨ç½²åˆ°Kubernetes**ï¼š
```bash
# åˆ›å»ºConfigMapå’ŒSecret
kubectl create configmap redis-config --from-literal=url=redis://redis:6379
kubectl create secret generic db-secret --from-literal=url=postgresql://user:pass@postgres/db

# éƒ¨ç½²åº”ç”¨
kubectl apply -f k8s/

# æŸ¥çœ‹çŠ¶æ€
kubectl get pods
kubectl get services
```

### 12.3 ç¯å¢ƒå˜é‡é…ç½®

**åç«¯ç¯å¢ƒå˜é‡** (`.env`)ï¼š
```bash
# åº”ç”¨é…ç½®
APP_NAME=IPD Requirements Management System
APP_VERSION=1.0.0
DEBUG=false

# APIé…ç½®
API_V1_PREFIX=/api/v1

# å®‰å…¨é…ç½®
SECRET_KEY=your-production-secret-key-change-this
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://ipd_user:strong_password@postgres:5432/ipd_req_db

# Redisé…ç½®
REDIS_URL=redis://redis:6379

# CORSé…ç½®
CORS_ORIGINS=https://your-domain.com,https://www.your-domain.com

# æ–‡ä»¶ä¸Šä¼ 
MAX_UPLOAD_SIZE=10485760
UPLOAD_DIR=/app/uploads
```

**å‰ç«¯ç¯å¢ƒå˜é‡** (`.env.production`)ï¼š
```bash
# APIé…ç½®
VITE_API_URL=https://api.your-domain.com/api/v1
```

### 12.4 å¥åº·æ£€æŸ¥

**åç«¯å¥åº·æ£€æŸ¥**ï¼š
```http
GET /health
```

**å“åº”**ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2026-01-21T10:00:00Z",
  "database": "connected",
  "redis": "connected"
}
```

**Nginxé…ç½®ç¤ºä¾‹**ï¼š
```nginx
upstream backend {
    server backend:8000;
}

upstream frontend {
    server frontend:5173;
}

server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # åç«¯API
    location /api {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

---

## 13. å¸¸è§é—®é¢˜

### 13.1 å¼€å‘é—®é¢˜

**Q1: å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ**

A: åœ¨åç«¯é…ç½®CORSä¸­é—´ä»¶ï¼š
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Q2: å¦‚ä½•è°ƒè¯•APIï¼Ÿ**

A: ä½¿ç”¨Swagger UIæˆ–ReDocï¼š
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

**Q3: å‰ç«¯çƒ­æ›´æ–°ä¸å·¥ä½œï¼Ÿ**

A: æ£€æŸ¥Viteé…ç½®ï¼š
```typescript
// vite.config.ts
export default defineConfig({
  server: {
    hmr: true,  // å¯ç”¨çƒ­æ›´æ–°
    watch: {
      usePolling: true,  // æŸäº›ç³»ç»Ÿéœ€è¦è½®è¯¢
    },
  },
})
```

**Q4: æ•°æ®åº“è¿ç§»å¤±è´¥ï¼Ÿ**

A: æ£€æŸ¥è¿ç§»çŠ¶æ€ï¼š
```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
alembic current

# æŸ¥çœ‹è¿ç§»å†å²
alembic history

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
alembic downgrade -1

# é‡æ–°ç”Ÿæˆè¿ç§»
alembic revision --autogenerate -m "æè¿°"
```

**Q5: å¦‚ä½•æ¸…ç©ºæµ‹è¯•æ•°æ®åº“ï¼Ÿ**

A: ä½¿ç”¨pytest fixtureè‡ªåŠ¨æ¸…ç†ï¼Œæˆ–æ‰‹åŠ¨ï¼š
```bash
# åˆ é™¤æ‰€æœ‰è¡¨
pytest --create-db

# æˆ–ä½¿ç”¨SQLiteå†…å­˜æ•°æ®åº“ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
DATABASE_URL=sqlite+aiosqlite:///:memory:
```

### 13.2 éƒ¨ç½²é—®é¢˜

**Q6: Dockerå®¹å™¨å¯åŠ¨å¤±è´¥ï¼Ÿ**

A: æ£€æŸ¥æ—¥å¿—ï¼š
```bash
docker-compose logs backend
docker-compose logs frontend
```

å¸¸è§é—®é¢˜ï¼š
- ç«¯å£è¢«å ç”¨ï¼šä¿®æ”¹`docker-compose.yml`ä¸­çš„ç«¯å£æ˜ å°„
- æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- æƒé™é—®é¢˜ï¼šç¡®ä¿æœ‰å†™å…¥æƒé™

**Q7: å¦‚ä½•å¤‡ä»½æ•°æ®åº“ï¼Ÿ**

A: ä½¿ç”¨pg_dumpï¼š
```bash
# å¤‡ä»½
docker exec postgres pg_dump -U ipd_user ipd_req_db > backup.sql

# æ¢å¤
docker exec -i postgres psql -U ipd_user ipd_req_db < backup.sql
```

**Q8: å¦‚ä½•æ›´æ–°ç”Ÿäº§ç¯å¢ƒï¼Ÿ**

A: é›¶åœæœºéƒ¨ç½²æµç¨‹ï¼š
```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. æ„å»ºæ–°é•œåƒ
docker-compose build

# 3. å¯åŠ¨æ–°å®¹å™¨ï¼ˆæ»šåŠ¨æ›´æ–°ï¼‰
docker-compose up -d --no-deps backend
docker-compose up -d --no-deps frontend

# 4. æ¸…ç†æ—§é•œåƒ
docker image prune -f
```

### 13.3 æ€§èƒ½é—®é¢˜

**Q9: APIå“åº”æ…¢ï¼Ÿ**

A: ä¼˜åŒ–å»ºè®®ï¼š
1. æ·»åŠ æ•°æ®åº“ç´¢å¼•
2. ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
3. å¯ç”¨åˆ†é¡µæŸ¥è¯¢
4. ä½¿ç”¨è¿æ¥æ± 
5. æ·»åŠ è´Ÿè½½å‡è¡¡

**Q10: å‰ç«¯é¦–å±åŠ è½½æ…¢ï¼Ÿ**

A: ä¼˜åŒ–å»ºè®®ï¼š
1. ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½ï¼ˆå·²å®ç°ï¼‰
2. å¯ç”¨Gzipå‹ç¼©
3. ä½¿ç”¨CDNåŠ é€Ÿ
4. å›¾ç‰‡æ‡’åŠ è½½
5. ä»£ç åˆ†å‰²

---

## 14. å¿«é€Ÿä¸Šæ‰‹

### 14.1 ç¯å¢ƒå‡†å¤‡

**å¿…éœ€è½¯ä»¶**ï¼š
- Node.js 18+
- Python 3.11+
- PostgreSQL 15+
- Redis 7+
- Git

**æ¨èå·¥å…·**ï¼š
- VS Codeï¼ˆæ‰©å±•ï¼šPythonã€TypeScriptã€Viteï¼‰
- Postmanï¼ˆAPIæµ‹è¯•ï¼‰
- DBeaverï¼ˆæ•°æ®åº“ç®¡ç†ï¼‰

### 14.2 å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd claude_study

# æŸ¥çœ‹åˆ†æ”¯
git branch -a
git checkout develop  # åˆ‡æ¢åˆ°å¼€å‘åˆ†æ”¯
```

### 14.3 åç«¯å¯åŠ¨

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# è¿è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
python scripts/create_test_user.py

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æµ‹è¯•API
curl http://localhost:8000/docs
```

### 14.4 å‰ç«¯å¯åŠ¨

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®åº”ç”¨
open http://localhost:5173
```

### 14.5 ç™»å½•ç³»ç»Ÿ

**é»˜è®¤è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

**é¦–æ¬¡ç™»å½•å**ï¼š
1. ä¿®æ”¹é»˜è®¤å¯†ç 
2. åˆ›å»ºç»„ç»‡å’Œç§Ÿæˆ·
3. é‚€è¯·å›¢é˜Ÿæˆå‘˜

### 14.6 å¼€å‘ä»»åŠ¡ç¤ºä¾‹

**ä»»åŠ¡ï¼šæ·»åŠ æ–°çš„éœ€æ±‚æ¥æºæ¸ é“**

**æ­¥éª¤1ï¼šä¿®æ”¹åç«¯**
```python
# backend/app/models/requirement.py
class Requirement(Base, TimestampMixin, TenantMixin):
    source_channel: Mapped[str] = mapped_column(
        String(50),
        comment="æ¥æºæ¸ é“: customer/market/sales/rd/after_sales/partner"
    )
```

**æ­¥éª¤2ï¼šä¿®æ”¹å‰ç«¯ç±»å‹**
```typescript
// frontend/src/shared/types/api.ts
export type SourceChannel =
  | 'customer'
  | 'market'
  | 'sales'
  | 'rd'
  | 'after_sales'
  | 'partner'  // æ–°å¢
```

**æ­¥éª¤3ï¼šæ·»åŠ æµ‹è¯•**
```python
# backend/tests/test_requirements.py
@pytest.mark.asyncio
async def test_create_requirement_from_partner():
    response = await async_client.post(
        "/api/v1/requirements",
        json={
            "title": "åˆä½œä¼™ä¼´éœ€æ±‚",
            "source_channel": "partner"
        },
        headers={"Authorization": f"Bearer {test_token}"}
    )
    assert response.status_code == 200
```

**æ­¥éª¤4ï¼šè¿è¡Œæµ‹è¯•**
```bash
cd backend
pytest tests/test_requirements.py::test_create_requirement_from_partner -v

cd frontend
npm run test
```

**æ­¥éª¤5ï¼šæäº¤ä»£ç **
```bash
git add .
git commit -m "feat: æ·»åŠ åˆä½œä¼™ä¼´ä½œä¸ºéœ€æ±‚æ¥æºæ¸ é“"
git push origin feature/add-partner-channel
```

### 14.7 å­¦ä¹ èµ„æº

**é¡¹ç›®æ–‡æ¡£**ï¼š
- APIæ–‡æ¡£: `http://localhost:8000/docs`
- æ•°æ®åº“è®¾è®¡: `backend/docs/database.md`
- å‰ç«¯ç»„ä»¶æ–‡æ¡£: `frontend/docs/components.md`

**å¤–éƒ¨èµ„æº**ï¼š
- FastAPIå®˜æ–¹æ–‡æ¡£: https://fastapi.tiangolo.com/
- Reactæ–‡æ¡£: https://react.dev/
- Ant Designæ–‡æ¡£: https://ant.design/
- SQLAlchemyæ–‡æ¡£: https://docs.sqlalchemy.org/

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶è·¯å¾„é€ŸæŸ¥

**åç«¯å…³é”®æ–‡ä»¶**ï¼š
- åº”ç”¨å…¥å£: `backend/app/main.py`
- é…ç½®æ–‡ä»¶: `backend/app/config.py`
- éœ€æ±‚æ¨¡å‹: `backend/app/models/requirement.py`
- éœ€æ±‚API: `backend/app/api/v1/requirements.py`
- æƒé™æ§åˆ¶: `backend/app/core/permissions.py`
- ç§Ÿæˆ·ä¸­é—´ä»¶: `backend/app/core/tenant.py`
- åŸºç¡€ä»“å‚¨: `backend/app/repositories/base.py`

**å‰ç«¯å…³é”®æ–‡ä»¶**ï¼š
- åº”ç”¨å…¥å£: `frontend/src/main.tsx`
- æ ¹ç»„ä»¶: `frontend/src/App.tsx`
- è·¯ç”±é…ç½®: `frontend/src/router/index.tsx`
- ä¸»å¸ƒå±€: `frontend/src/shared/components/layout/MainLayout.tsx`
- è®¤è¯çŠ¶æ€: `frontend/src/stores/useAuthStore.ts`
- APIé…ç½®: `frontend/src/services/api.ts`
- ç±»å‹å®šä¹‰: `frontend/src/shared/types/api.ts`

### B. ç«¯å£å ç”¨è¯´æ˜

| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| Frontend (Vite) | 5173 | å‰ç«¯å¼€å‘æœåŠ¡å™¨ |
| Backend (FastAPI) | 8000 | åç«¯APIæœåŠ¡å™¨ |
| PostgreSQL | 5432 | æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜ |

### C. å‘½ä»¤é€ŸæŸ¥

**åç«¯**ï¼š
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --port 8000

# è¿è¡Œæµ‹è¯•
pytest tests/ -v

# æ•°æ®åº“è¿ç§»
alembic upgrade head

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log
```

**å‰ç«¯**ï¼š
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œæµ‹è¯•
npm run test

# ä»£ç æ£€æŸ¥
npm run lint
```

**Docker**ï¼š
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç”Ÿæˆæ—¶é—´**: 2026-01-21
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

---

## ç»“è¯­

æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»äº†IPDéœ€æ±‚ç®¡ç†ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€å¼€å‘æµç¨‹å’Œæ ¸å¿ƒæ¨¡å—ã€‚å¦‚æœä½ æ˜¯æ–°äººï¼Œå»ºè®®æŒ‰ç…§"å¿«é€Ÿä¸Šæ‰‹"ç« èŠ‚çš„æ­¥éª¤è¿›è¡Œæ“ä½œï¼Œåœ¨å®è·µä¸­é€æ­¥ç†Ÿæ‚‰ç³»ç»Ÿã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»å¼€å‘å›¢é˜Ÿã€‚

ç¥å·¥ä½œæ„‰å¿«ï¼ğŸ‰
