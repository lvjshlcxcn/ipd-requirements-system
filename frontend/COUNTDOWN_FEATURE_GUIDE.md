# 需求开发倒计时功能 - 使用指南

## 📋 功能概述

需求开发倒计时功能在"需求列表"页面新增了两列：
- **预估工期**：显示需求的预估开发周期（月）
- **开发倒计时**：实时显示剩余时间或超期状态

---

## 🎯 如何使用

### 步骤 1：创建或编辑需求，设置预估工期

#### 方式 A：创建新需求时设置
1. 点击"新建需求"按钮
2. 填写需求信息
3. 在表单中找到 **"预计周期(月)"** 字段
4. 输入预估的月数（例如：1、2、3）
5. 点击"提交"

#### 方式 B：编辑现有需求
1. 在需求列表中找到需要编辑的需求
2. 点击"✏️ 编辑"按钮
3. 在表单中找到 **"预计周期(月)"** 字段
4. 输入预估的月数
5. 点击"提交"

### 步骤 2：查看倒计时

设置预估工期后，返回需求列表页面：

- 如果需求状态为 **"实现中"**：
  - 🟢 **绿色**：显示剩余时间（例如：`剩余 25天 3小时`）
  - 🟠 **橙色**：临期警告，剩余时间 < 3天（例如：`剩余 2天 5小时`）
  - 🔴 **红色**：已超期（例如：`已延期 5天`）

- 如果需求状态为其他状态：
  - ⚫ **灰色**：显示 `-`

---

## 🧪 测试场景示例

### 场景 1：正常倒计时
```
需求状态：实现中
创建时间：2025-01-15
预估工期：1 个月
当前时间：2025-02-01

显示结果：
- 预估工期列：1 个月
- 开发倒计时列：🟢 剩余 14天 5小时
```

### 场景 2：临期警告
```
需求状态：实现中
创建时间：2025-01-15
预估工期：1 个月
当前时间：2025-02-13

显示结果：
- 预估工期列：1 个月
- 开发倒计时列：🟠 剩余 2天 10小时
```

### 场景 3：已超期
```
需求状态：实现中
创建时间：2024-12-01
预估工期：1 个月
当前时间：2025-02-01

显示结果：
- 预估工期列：1 个月
- 开发倒计时列：🔴 已延期 31天
```

### 场景 4：非实现中状态
```
需求状态：已收集 / 分析中 / 已完成 等
预估工期：1 个月

显示结果：
- 预估工期列：1 个月
- 开发倒计时列：⚫ -
```

---

## 🔧 故障排除

### 问题 1：看不到倒计时列

**原因**：可能需要刷新页面或清除缓存

**解决方法**：
1. 硬刷新页面：`Ctrl + Shift + R` (Windows) 或 `Cmd + Shift + R` (Mac)
2. 或者重启开发服务器：
   ```bash
   # 停止当前服务器（Ctrl + C）
   # 重新启动
   npm run dev
   ```

### 问题 2：倒计时列显示 `-`

**原因**：
- 需求没有设置预估工期（`estimated_duration_months` 为 null）
- 需求状态不是"实现中"

**解决方法**：
1. 编辑需求，设置"预计周期(月)"
2. 将需求状态改为"实现中"

### 问题 3：倒计时没有实时更新

**原因**：定时器没有正常启动

**解决方法**：
1. 打开浏览器控制台（F12）
2. 查看是否有错误信息
3. 刷新页面重试

---

## 📊 技术实现

### 核心文件

1. **Hook**
   - `src/shared/hooks/useCountdownTimer.ts`
   - 计算倒计时逻辑，每秒更新

2. **组件**
   - `src/shared/components/countdown/CountdownDisplay.tsx`
   - `src/shared/components/countdown/RowCountdown.tsx`
   - 倒计时显示组件

3. **页面**
   - `src/pages/requirements/RequirementListPage.tsx`
   - 需求列表页面，集成倒计时功能

### 倒计时计算规则

```
截止时间 = 创建时间 + 预估工期(月) × 30.44天
```

注意：使用 30.44 天作为一个月的平均天数（365.25 ÷ 12）

### 颜色规则

| 状态 | 颜色 | 条件 |
|------|------|------|
| 正常 | 🟢 绿色 (#52c41a) | 剩余时间 ≥ 3天 |
| 临期 | 🟠 橙色 (#faad14) | 剩余时间 < 3天 |
| 超期 | 🔴 红色 (#ff4d4f) | 已超期 |
| 禁用 | ⚫ 灰色 (#999) | 非实现中状态 |

---

## 🧪 如何测试

### 测试步骤

1. **创建测试需求**
   ```
   导航到：需求列表 → 新建需求
   填写：
   - 标题：测试倒计时功能
   - 描述：用于测试倒计时显示
   - 预计周期(月)：1
   - 提交
   ```

2. **编辑需求状态**
   ```
   找到刚创建的需求 → 点击"编辑"
   修改状态为：实现中
   提交
   ```

3. **验证倒计时**
   ```
   返回需求列表页面
   检查：
   - "预估工期"列是否显示 "1 个月"
   - "开发倒计时"列是否显示倒计时（绿色）
   ```

4. **测试不同状态**
   ```
   编辑需求，将状态改为：
   - 已收集 → 倒计时应显示 "-"
   - 实现中 → 倒计时应显示实际时间
   - 已完成 → 倒计时应显示 "-"
   ```

---

## 💡 使用建议

1. **合理设置预估工期**
   - 根据历史经验设置合理的月数
   - 可以是小数，例如：0.5（半个月）、1.5（一个半月）

2. **及时更新状态**
   - 开发完成后，及时将状态改为"验证中"或"已完成"
   - 这样倒计时会停止显示

3. **关注临期和超期需求**
   - 橙色和红色的需求需要重点关注
   - 及时调整资源或重新评估工期

---

## 📝 注意事项

1. **只在"实现中"状态显示倒计时**
   - 其他状态（已收集、分析中、已完成等）不会显示倒计时

2. **倒计时每秒更新**
   - 倒计时会实时更新，不需要手动刷新页面

3. **超期后降低更新频率**
   - 为了性能优化，超期后每分钟更新一次

4. **时区处理**
   - 使用浏览器本地时区显示时间
   - 数据库存储 UTC 时间

---

## 🎉 总结

需求开发倒计时功能帮助团队：
- ✅ 实时了解需求开发进度
- ✅ 及时发现临期和超期需求
- ✅ 合理规划开发资源
- ✅ 提高项目管理效率

如有问题，请查看控制台错误信息或联系开发团队。
