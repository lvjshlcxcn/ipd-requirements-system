# 需求管理页面测试用例设计

## 页面概述

需求管理模块包含 3 个主要页面：

1. **RequirementListPage** - 需求列表页
2. **RequirementCreatePage** - 新建需求页  
3. **RequirementDetailPage** - 需求详情页

---

## 1️⃣ RequirementListPage 测试用例

### 测试套件：页面渲染和数据加载

#### TC-RL-001: 初始渲染
```
描述: 页面初始加载时正确渲染
类型: 渲染测试
前置条件: 用户已登录
测试步骤:
  1. 访问 /requirements 路由
  2. 等待页面加载
  3. 检查页面元素存在

预期结果:
  ✅ 页面标题 "需求列表" 显示
  ✅ "新建需求" 按钮显示
  ✅ 搜索输入框显示
  ✅ 状态筛选下拉框显示
  ✅ 来源筛选下拉框显示
  ✅ 刷新按钮显示
  ✅ 数据表格显示

测试数据: Mock 需求列表（2-3条）
```

#### TC-RL-002: 数据加载
```
描述: 页面加载时正确获取并显示需求数据
类型: 数据加载测试
前置条件: API 返回需求列表
Mock 数据:
  - 3条需求记录
  - 不同的状态、来源、优先级

测试步骤:
  1. Mock requirementService.getRequirements()
  2. 渲染页面
  3. 等待数据加载完成
  4. 检查表格行数

预期结果:
  ✅ loading 状态正确显示
  ✅ 加载完成后显示 3 行数据
  ✅ 每行数据正确映射（编号、标题、状态等）
  ✅ 状态标签颜色正确
  ✅ 优先级分数正确显示颜色
```

---

### 测试套件：搜索功能

#### TC-RL-003: 文本搜索
```
描述: 按需求编号或标题搜索
类型: 功能测试
测试数据:
  - 搜索词: "登录"
  - 匹配项: REQ-2026-0001, "用户登录功能"

测试步骤:
  1. 在搜索框输入 "登录"
  2. 触发搜索（回车或自动）
  3. 等待搜索结果

预期结果:
  ✅ API 被调用，参数包含 search="登录"
  ✅ 显示匹配的需求
  ✅ 表格只显示搜索结果
```

#### TC-RL-004: 搜索无结果
```
描述: 搜索不存在的需求
类型: 边界测试
测试步骤:
  1. 在搜索框输入 "不存在的需求XYZ"
  2. 触发搜索
  3. 等待响应

预期结果:
  ✅ API 被调用
  ✅ 表格显示空状态或 "暂无数据"
```

#### TC-RL-005: 清除搜索
```
描述: 清除搜索条件显示全部数据
类型: 功能测试
测试步骤:
   1. 先执行搜索
  2. 点击搜索框的清除按钮
  3. 或手动清空并触发搜索

预期结果:
  ✅ search 参数变为空字符串
  ✅ 显示全部需求数据
  ✅ 表格刷新
```

---

### 测试套件：状态筛选

#### TC-RL-006: 按状态筛选
```
描述: 选择不同状态进行筛选
类型: 功能测试
测试数据:
  - 状态选项: collected, analyzing, analyzed, completed 等

测试步骤:
  1. 在状态下拉框选择 "已分析"
  2. 等待筛选结果

预期结果:
  ✅ API 被调用，参数 status="analyzed"
  ✅ 只显示状态为"已分析"的需求
  ✅ 状态标签颜色正确
```

#### TC-RL-007: 切换状态筛选
```
描述: 在不同状态筛选间切换
类型: 交互测试
测试步骤:
  1. 先选择 "已收集"
  2. 再切换到 "已完成"
  3. 观察数据变化

预期结果:
  ✅ 筛选条件正确更新
  ✅ 表格数据刷新
  ✅ 分页信息更新
```

---

### 测试套件：来源筛选

#### TC-RL-008: 按来源筛选
```
描述: 选择不同来源进行筛选
类型: 功能测试
测试数据:
  - 来源选项: customer, market, rd 等

测试步骤:
  1. 在来源下拉框选择 "客户"
  2. 等待筛选结果

预期结果:
  ✅ API 被调用，参数 source_channel="customer"
  ✅ 只显示来源为"客户"的需求
```

#### TCRL-009: 组合筛选
```
描述: 同时使用状态和来源筛选
类型: 功能测试
测试步骤:
  1. 状态选择 "已完成"
  2. 来源选择 "客户"
  3. 观察结果

预期结果:
  ✅ 两个筛选条件都生效
  ✅ 只显示同时满足两个条件的需求
```

---

### 测试套件：分页功能

#### TC-RL-010: 翻页
```
描述: 翻页查看不同页的数据
类型: 功能测试
Mock 数据: 25条需求，pageSize=10

测试步骤:
  1. 初始加载第1页（1-10条）
  2. 点击第2页
  3. 验证第2页显示11-20条
  4. 点击第3页
  5. 验证第3页显示21-25条

预期结果:
  ✅ 正确调用API（page参数正确）
  ✅ 每页显示正确的数据
  ✅ 分页组件状态正确
  ✅ 总数统计正确
```

#### TC-RL-011: 改变每页条数
```
描述: 修改每页显示条数
类型: 功能测试
测试步骤:
  1. 在分页组件选择 20条/页
  2. 等待数据刷新

预期结果:
  ✅ API 被调用，page_size=20
  ✅ 表格显示20条数据
  ✅ 分页信息更新
```

#### TC-RL-012: 分页总数计算
```
描述: 验证分页总数计算正确
类型: 数据验证测试
Mock 数据: 总共25条数据

测试步骤:
  1. pageSize=10时，验证显示3页
  2. pageSize=20时，验证显示2页
  3. pageSize=50时，验证显示1页

预期结果:
  ✅ total_pages 计算正确
  ✅ 分页组件正确显示
```

---

### 测试套件：表格交互

#### TC-RL-013: 查看详情
```
描述: 点击"查看"按钮跳转到详情页
类型: 导航测试
测试步骤:
  1. 点击某行数据的"查看"按钮
  2. 验证路由跳转

预期结果:
  ✅ 调用 navigate(`/requirements/{id}`)
  ✅ 跳转到需求详情页
```

#### TC-RL-014: 编辑需求
```
描述: 点击"编辑"按钮跳转到编辑页
类型: 导航测试
测试步骤:
  1. 点击某行数据的"编辑"按钮
  2. 验证路由跳转

预期结果:
  ✅ 调用 navigate(`/requirements/{id}/edit`)
  ✅ 跳转到需求编辑页
```

#### TC-RL-015: 刷新数据
```
描述: 点击刷新按钮重新加载数据
类型: 功能测试
测试步骤:
  1. 修改当前筛选或搜索
  2. 点击"刷新"按钮
  3. 等待数据刷新

预期结果:
  ✅ 筛选条件被重置
  ✅ 调用 fetchRequirements(第1页)
  ✅ 数据重新加载
```

---

### 测试套件：错误处理

#### TC-RL-016: API 错误处理
```
描述: API 调用失败时显示错误信息
类型: 错误处理测试
Mock 行为: API 返回 500 错误

测试步骤:
  1. Mock requirementService.getRequirements 抛出错误
  2. 渲染页面
  3. 等待错误处理

预期结果:
  ✅ 显示错误消息
  ✅ loading 状态正确
  ✅ 页面不崩溃
```

#### TC-RL-017: 空数据处理
```
描述: API 返回空列表时的显示
类型: 边界测试
Mock 行为: API 返回空数组

测试步骤:
  1. Mock 返回 { success: true, data: { items: [], total: 0 } }
  2. 渲染页面

预期结果:
  ✅ 表格显示"暂无数据"
  ✅ 不显示分页组件
  ✅ 不报错
```

---

## 2️⃣ RequirementCreatePage 测试用例

### 测试套件：页面渲染

#### TC-RC-001: 初始渲染
```
描述: 新建需求页面初始渲染
类型: 渲染测试
前置条件: 用户已登录

测试步骤:
  1. 访问 /requirements/new 路由
  2. 检查页面元素

预期结果:
  ✅ 页面标题 "新建需求" 显示
  ✅ 返回按钮显示
  ✅ 步骤条显示（4步）
  ✅ 当前步骤为第1步（基本信息）
  ✅ 表单字段显示正确
```

---

### 测试套件：多步骤表单

#### TC-RC-002: 基本信息步骤验证
```
描述: 基本信息步骤的必填字段验证
类型: 表单验证测试

测试步骤:
  1. 直接点击"下一步"跳过填写
  2. 验证表单验证

预期结果:
  ✅ 显示验证错误："请输入需求标题"
  ✅ 显示验证错误："请输入需求描述"
  ✅ 显示验证错误："请选择需求来源"
  ✅ 不会进入下一步
```

#### TC-RC-003: 基本信息填写成功
```
描述: 正确填写基本信息后可进入下一步
类型: 功能测试
输入数据:
  - title: "测试需求"
  - description: "这是一个测试需求"
  - source_channel: "customer"
  - source_contact: "张三"
  - estimated_duration_months: 3
  - complexity_level: "medium"

测试步骤:
  1. 填写所有基本信息字段
  2. 点击"下一步"按钮

预期结果:
  ✅ 表单验证通过
  ✅ 进入第2步（需求十问）
  ✅ 步骤条更新为第2步
```

---

### 测试套件：需求十问

#### TC-RC-004: 十问信息填写
```
描述: 在十问步骤中填写信息
类型: 交互测试
测试数据:
  - q1_who_cares: "产品经理"
  - q2_why_care: "提升效率"
  - q3_how_often: "每天"
  - q4_current_solution: "手工记录"
  - q5_pain_points: "容易出错"
  - q6_expected_outcome: "提高准确性"
  - q7_value_impact: "节省时间"
  - q8_urgency_level: "高"
  - q9_budget_willingness: "5万"
  - q10_alternative_solutions: "Excel"

测试步骤:
  1. 在第2步填写所有十问字段
  2. 点击"下一步"

预期结果:
  ✅ 所有输入正确保存
  ✅ 可以进入第3步
```

#### TC-RC-005: 跳过十问
```
描述: 可以跳过十问直接进入下一步
类型: 功能测试
测试步骤:
  1. 在第2步不填写任何内容
  2. 点击"下一步"

预期结果:
  ✅ 可以跳过十问（十问为可选）
  ✅ 进入第3步（附加信息）
```

---

### 测试套件：表单提交

#### TC-RC-006: 完整提交流程
```
描述: 完整填写并提交需求
类型: 端到端测试
输入数据: 完整的需求数据（基本信息+十问+附加信息）

测试步骤:
  1. 填写基本信息
  2. 填写十问（或跳过）
  3. 填写附加信息（或跳过）
  4. 在确认页检查信息
  5. 点击"提交需求"按钮

预期结果:
  ✅ 显示确认信息
  ✅ 十问信息正确显示为卡片
  ✅ 调用 requirementService.createRequirement
  ✅ 显示成功消息
  ✅ 跳转到需求列表页
```

#### TC-RC-007: 表单验证失败处理
```
描述: 提交时验证失败显示错误
类型: 错误处理测试
Mock 行为: API 返回验证错误

测试步骤:
  1. 填写表单但不填必填项
  2. 点击提交
  3. 验证失败

预期结果:
  ✅ 显示错误 Modal
  ✅ 显示详细错误信息
  ✅ 不会提交到API
  ✅ 可以返回修改
```

#### TC-RC-008: 重复提交保护
```
描述: 防止重复提交
类型: 功能测试
测试步骤:
  1. 填写完整表单
  2. 快速点击"提交需求"按钮两次

预期结果:
  ✅ 第一次点击触发提交
  ✅ 第二次点击被禁用（loading状态）
  ✅ 不会重复提交
```

---

### 测试套件：表单导航

#### TC-RC-009: 上一步/下一步导航
```
描述: 使用"上一步"和"下一步"按钮导航
类型: 导航测试

测试步骤:
  1. 在第2步
  2. 点击"上一步"
  3. 验证返回第1步
  4. 点击"下一步"
  5. 验证前进到第2步

预期结果:
  ✅ 上一步正确返回
  ✅ 下一步正确前进
  ✅ 表单数据保持
  ✅ 步骤条正确更新
```

#### TC-RC-010: 重新填写按钮
```
描述: 在确认页点击"重新填写"
类型: 功能测试
测试步骤:
 1. 完成前3步到确认页
 2. 点击"重新填写"按钮

预期结果:
  ✅ 返回第1步（基本信息）
  ✅ 表单数据可能保留
  ✅ 步骤条重置为第1步
```

#### TC-RC-011: 返回按钮导航
```
描述: 点击返回按钮离开新建页
类型: 导航测试
测试步骤:
  1. 点击页面左上角"返回"按钮
  2. 验证导航

预期结果:
  ✅ 调用 navigate(-1)
  ✅ 返回上一页
```

---

### 测试套件：数据持久化

#### TC-RC-012: 步骤间数据保持
```
描述: 在不同步骤间切换时数据保持一致
类型: 数据一致性测试
测试步骤:
  1. 在第1步填写基本信息
 2. 前进到第2步
 3. 返回第1步
  4. 验证基本信息数据仍在

预期结果:
  ✅ 标题保持不变
  ✅ 描述保持不变
  ✅ 来源保持不变
  ✅ 其他字段保持不变
```

---

## 3️⃣ RequirementDetailPage 测试用例

### 测试套件：数据加载

#### TC-RD-001: 加载需求详情
```
描述: 页面加载时正确获取需求详情
类型: 数据加载测试
前置条件: 需求ID存在于URL中
Mock 数据: 完整的需求详情对象

测试步骤:
  1. Mock requirementService.getRequirement()
  2. 访问 /requirements/1
  3. 等待数据加载

预期结果:
  ✅ loading 状态显示
  ✅ API 被调用，参数正确
  ✅ 需求详情正确显示
  ✅ 所有信息卡片正确渲染
  ✅ 状态标签颜色正确
```

#### TC-RD-002: 加载失败处理
```
描述: 需求不存在时显示错误
类型: 错误处理测试
Mock 行为: API 返回 404

测试步骤:
  1. Mock getRequirement 返回失败
  2. 访问不存在的需求ID

预期结果:
  ✅ 显示错误消息
  ✅ 页面不崩溃
```

---

### 测试套件：信息展示

#### TC-RD-003: 基本信息显示
```
描述: 正确显示需求的基本信息
类型: 渲染测试
测试数据: 包含所有基本字段的完整需求

测试步骤:
  1. 页面加载完成
  2. 检查信息展示区域

预期结果:
  ✅ 标题显示
  ✅ 描述显示
  ✅ 来源显示（中文映射）
  ✅ 状态标签显示（颜色正确）
  ✅ 创建时间显示
  ✅ 需求编号显示
```

#### TC-RD-004: 客户需求十问显示
```
描述: 十问信息以卡片形式展示
类型: 渲染测试
测试数据: 包含部分十问答案的需求

测试步骤:
  1. 页面加载完成
  2. 滚动到十问区域

预期结果:
  ✅ 十问信息区域显示
  ✅ 填写了的问题显示为卡片
  ✅ 卡片标题正确（"谁在意？"、"为什么在意？"等）
  ✅ 卡片内容正确
```

---

### 测试套件：操作功能

#### TC-RD-005: 编辑功能
```
描述: 点击编辑按钮跳转到编辑页
类型: 导航测试
测试步骤:
  1. 点击"编辑"按钮
  2. 验证导航

预期结果:
  ✅ 调用 navigate(`/requirements/{id}/edit`)
  ✅ 跳转到编辑页
```

#### TC-RD-006: 删除功能
```
描述: 删除需求并进行确认
类型: 功能测试
Mock 行为: API 返回成功

测试步骤:
  1. 点击"删除"按钮
  2. Modal 确认对话框弹出
  3. 点击"确定"
  4. 等待删除完成

预期结果:
  ✅ 显示确认对话框
  ✅ 对话框标题为"确认删除"
  ✅ API 调用 deleteRequirement(id)
  ✅ 删除成功消息显示
  ✅ 跳转到需求列表页
```

#### TC-RD-007: 取消删除
```
描述: 在删除确认对话框中取消操作
类型: 交互测试
测试步骤:
  1. 点击"删除"按钮
  2. 在确认对话框点击"取消"
  3. 验证结果

预期结果:
  ✅ Modal 对话框关闭
  ✅ 不调用删除 API
  ✅ 页面保持不变
  ✅ 需求仍然存在
```

---

### 测试套件：路由和导航

#### TC-RD-008: URL 参数解析
```
描述: 从URL正确解析需求ID
类型: 路由测试
测试步骤:
  1. 访问 /requirements/123
  2. 验证ID解析

预期结果:
  ✅ useParams() 正确获取 id="123"
  ✅ 使用该ID获取数据
```

#### TC-RD-009: 无效ID处理
```
描述: URL中需求ID无效
类型: 边界测试
测试数据: 非数字ID、不存在的ID

测试步骤:
  1. 访问 /requirements/invalid
  2. 观察处理

预期结果:
  ✅ 显示错误或重定向
  ✅ 页面不崩溃
```

---

### 测试套件：响应式设计

#### TC-RD-010: 移动端适配
```
描述: 不同屏幕尺寸下的布局
类型: 响应式测试
测试步骤:
  1. 使用不同视口大小测试
  2. 检查布局

预期结果:
  ✅ 小屏幕(<576px): 单列布局
  ✅ 中屏幕(576-768px): 两列布局
  ✅ 大屏幕(>768px): 多列布局
  ✅ 信息不溢出
```

---

## 测试用例统计

### 按页面分类

| 页面 | 测试套件 | 测试用例数 | 估计时间 |
|------|---------|-----------|---------|
| RequirementListPage | 8 | 17 | 15分钟 |
| RequirementCreatePage | 7 | 11 | 15分钟 |
| RequirementDetailPage | 7 | 10 | 12分钟 |
| **总计** | **22** | **38** | **42分钟** |

### 按测试类型分类

| 测试类型 | 数量 | 占比 |
|---------|------|------|
| 渲染测试 | 3 | 7.9% |
| 功能测试 | 20 | 52.6% |
| 导航测试 | 6 | 15.8% |
| 表单验证 | 4 | 10.5% |
| 错误处理 | 3 | 7.9% |
| 数据一致性 | 2 | 5.3% |

### 按优先级分类

| 优先级 | 用例数 | 说明 |
|--------|--------|------|
| P0 (高) | 20 | 核心功能和用户流程 |
| P1 (中) | 15 | 重要功能和边界情况 |
| P2 (低) | 3 | 错误处理和边界 |

---

## 测试执行顺序

建议执行顺序：
1. 先测试 RequirementListPage（最基础）
2. 再测试 RequirementCreatePage（依赖列表页）
3. 最后测试 RequirementDetailPage（依赖前两个）

---

## Mock 数据需求

### 需求列表数据
```typescript
const mockRequirements = [
  {
    id: 1,
    requirement_no: "REQ-2026-0001",
    title: "用户登录功能",
    description: "实现用户名密码登录",
    source_channel: "customer",
    status: "collected",
    priority_score: 8,
    created_at: "2026-01-15T10:00:00Z",
  },
  {
    id: 2,
    requirement_no: "REQ-2026-0002",
    title: "数据导出功能",
    description: "支持导出为Excel格式",
    source_channel: "market",
    status: "analyzing",
    priority_score: 6,
    created_at: "2026-01-16T14:30:00Z",
  },
  // ... 更多数据
]
```

### 创建需求表单数据
```typescript
const mockRequirementFormData = {
  title: "API接口文档管理",
  description: "统一的API接口文档管理系统",
  source_channel: "rd",
  source_contact: "技术团队",
  estimated_duration_months: 4,
  complexity_level: "medium",
  customer_need_10q: {
    q1_who_cares: "开发人员",
    q2_why_care: "提高协作效率",
    // ... 其他问题
  },
}
```

---

## 技术实现要点

### Mock 策略
```typescript
// Mock requirementService
vi.mock('@/services/requirement.service', () => ({
  requirementService: {
    getRequirements: vi.fn(),
    getRequirement: vi.fn(),
    createRequirement: vi.fn(),
    updateRequirement: vi.fn(),
    deleteRequirement: vi.fn(),
  },
}))
```

### 路由 Mock
```typescript
// Mock react-router-dom
const mockNavigate = vi.fn()
vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
  useParams: () => ({ id: '1' }),
}))
```

### 测试工具函数
```typescript
// 渲染带 Provider 的组件
const renderWithProviders = (component: React.ReactElement) => {
  const queryClient = createTestQueryClient()
  return render(
    <QueryClientProvider client={queryClient}>
      {component}
    </QueryClientProvider>
  )
}
```

---

## 下一步

1. ✅ 测试用例设计完成
2. ⏳ 编写测试代码
3. ⏳ 运行测试验证
4. ⏳ 修复问题并完善
5. ⏳ 生成最终报告

**设计完成度: 100%**
