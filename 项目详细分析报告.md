# IPD éœ€æ±‚ç®¡ç†ç³»ç»Ÿ - å®Œæ•´é¡¹ç›®åˆ†ææŠ¥å‘Š

> **åˆ†ææ—¶é—´**: 2026-01-18
> **é¡¹ç›®è·¯å¾„**: /Users/kingsun/claude_study
> **æŠ¥å‘Šç±»å‹**: æ–°æ‰‹å‹å¥½å‹å…¨é¢åˆ†æ

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
3. [åç«¯è¯¦ç»†åˆ†æ](#3-åç«¯è¯¦ç»†åˆ†æ)
4. [å‰ç«¯è¯¦ç»†åˆ†æ](#4-å‰ç«¯è¯¦ç»†åˆ†æ)
5. [æ•°æ®åº“è®¾è®¡](#5-æ•°æ®åº“è®¾è®¡)
6. [æµ‹è¯•ä¸éƒ¨ç½²](#6-æµ‹è¯•ä¸éƒ¨ç½²)
7. [é¡¹ç›®ç°çŠ¶è¯„ä¼°](#7-é¡¹ç›®ç°çŠ¶è¯„ä¼°)
8. [æ”¹è¿›å»ºè®®](#8-æ”¹è¿›å»ºè®®)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº **IPDï¼ˆé›†æˆäº§å“å¼€å‘ï¼‰æ¡†æ¶** çš„**ä¼ä¸šçº§éœ€æ±‚ç®¡ç†ç³»ç»Ÿ**ï¼Œå®ç°éœ€æ±‚å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬éœ€æ±‚æ”¶é›†ã€åˆ†æã€åˆ†å‘ã€å¼€å‘ã€éªŒè¯ç­‰å®Œæ•´æµç¨‹ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

```
éœ€æ±‚æ”¶é›† â†’ éœ€æ±‚åˆ†æ â†’ éœ€æ±‚åˆ†å‘ â†’ å¼€å‘å®æ–½ â†’ éœ€æ±‚éªŒè¯ â†’ éœ€æ±‚è¿½æº¯
    â†“         â†“         â†“         â†“         â†“         â†“
  åé—®è¡¨å•   INVEST     SP/BP     é¡¹ç›®      FAT       RTM
  APPEALS   MoSCoW     Charter   å¼€å‘      SAT
            KANO       PCR       UAT
            RICE
```

**ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼š**

| æ¨¡å— | åŠŸèƒ½æè¿° | çŠ¶æ€ |
|------|---------|------|
| ğŸ” ç”¨æˆ·è®¤è¯ | ç™»å½•ã€æ³¨å†Œã€æƒé™ç®¡ç† | âœ… å®Œæˆ |
| ğŸ“ éœ€æ±‚ç®¡ç† | CRUDã€çŠ¶æ€è·Ÿè¸ªã€ç‰ˆæœ¬æ§åˆ¶ | âœ… å®Œæˆ |
| ğŸ” éœ€æ±‚åˆ†æ | INVESTã€MoSCoWã€KANOã€RICEã€APPEALS | âœ… å®Œæˆ |
| ğŸ“¤ éœ€æ±‚åˆ†å‘ | SPã€BPã€Charterã€PCR | âœ… å®Œæˆ |
| ğŸ”— éœ€æ±‚è¿½æº¯ | RTM çŸ©é˜µã€CDP é˜¶æ®µè·Ÿè¸ª | âœ… å®Œæˆ |
| âœ… éœ€æ±‚éªŒè¯ | FATã€SATã€UAT éªŒè¯æ¸…å• | âœ… å®Œæˆ |
| ğŸ”” é€šçŸ¥ç³»ç»Ÿ | å®æ—¶é€šçŸ¥ã€æ¶ˆæ¯æ¨é€ | âœ… å®Œæˆ |
| ğŸ“¥ å¯¼å…¥å¯¼å‡º | Excel æ‰¹é‡å¯¼å…¥å¯¼å‡º | âœ… å®Œæˆ |
| ğŸ¢ å¤šç§Ÿæˆ· | æ•°æ®éš”ç¦»ã€ç§Ÿæˆ·ç®¡ç† | âœ… å®Œæˆ |

### 1.3 æŠ€æœ¯æ ˆæ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯æŠ€æœ¯æ ˆ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¡†æ¶: React 18 + TypeScript + Vite                      â”‚
â”‚ UIåº“: Ant Design 5.x                                     â”‚
â”‚ çŠ¶æ€: Zustand                                            â”‚
â”‚ è·¯ç”±: React Router v6                                    â”‚
â”‚ HTTP: Axios                                              â”‚
â”‚ å›¾è¡¨: Recharts                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯æŠ€æœ¯æ ˆ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¡†æ¶: FastAPI 0.104+                                     â”‚
â”‚ ORM: SQLAlchemy 2.0                                      â”‚
â”‚ æ•°æ®åº“: PostgreSQL 15                                    â”‚
â”‚ ç¼“å­˜: Redis 7                                            â”‚
â”‚ è¿ç§»: Alembic                                            â”‚
â”‚ è®¤è¯: JWT (python-jose)                                  â”‚
â”‚ éªŒè¯: Pydantic 2.5+                                      â”‚
â”‚ æœåŠ¡å™¨: Uvicorn                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¼€å‘è¿ç»´å·¥å…·                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¹å™¨: Docker + Docker Compose                           â”‚
â”‚ ç‰ˆæœ¬æ§åˆ¶: Git                                            â”‚
â”‚ APIæ–‡æ¡£: Swagger UI / ReDoc                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯       â”‚     â”‚   åç«¯       â”‚     â”‚  æ•°æ®åº“      â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  React 18    â”‚â”€â”€â”€â”€â–¶â”‚  FastAPI     â”‚â”€â”€â”€â”€â–¶â”‚ PostgreSQL  â”‚
â”‚  TypeScript  â”‚ API â”‚  Python 3.11 â”‚ SQL â”‚  Redis      â”‚
â”‚  Vite        â”‚     â”‚  SQLAlchemy  â”‚     â”‚              â”‚
â”‚  Ant Design  â”‚     â”‚  Pydantic    â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â”‚                   â”‚
       â–¼                   â–¼
   æµè§ˆå™¨            Swagger UI
                    http://localhost:8000/docs
```

### 2.2 å‰ç«¯æ¶æ„

```
frontend/src/
â”œâ”€â”€ pages/           # é¡µé¢ç»„ä»¶ï¼ˆè·¯ç”±é¡µé¢ï¼‰
â”‚   â”œâ”€â”€ auth/       #   - ç™»å½•/æ³¨å†Œ
â”‚   â”œâ”€â”€ dashboard/  #   - ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ requirements/ #  - éœ€æ±‚ç®¡ç†
â”‚   â”œâ”€â”€ analysis/   #   - éœ€æ±‚åˆ†æ
â”‚   â”œâ”€â”€ distribution/ #  - éœ€æ±‚åˆ†å‘
â”‚   â”œâ”€â”€ rtm/        #   - éœ€æ±‚è¿½æº¯
â”‚   â””â”€â”€ verifications/ # - éœ€æ±‚éªŒè¯
â”‚
â”œâ”€â”€ components/     # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ analysis/   #   - INVESTã€MoSCoWã€RICE è¯„åˆ†ç»„ä»¶
â”‚   â”œâ”€â”€ verifications/ # - æ£€æŸ¥æ¸…å•ç»„ä»¶
â”‚   â”œâ”€â”€ layout/     #   - å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ common/     #   - é€šç”¨ç»„ä»¶
â”‚
â”œâ”€â”€ stores/         # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useAuthStore.ts      # è®¤è¯çŠ¶æ€
â”‚   â”œâ”€â”€ useRequirementStore.ts # éœ€æ±‚çŠ¶æ€
â”‚   â”œâ”€â”€ useAnalysisStore.ts  # åˆ†æçŠ¶æ€
â”‚   â””â”€â”€ useNotificationStore.ts # é€šçŸ¥çŠ¶æ€
â”‚
â”œâ”€â”€ services/       # API æœåŠ¡å±‚
â”‚   â”œâ”€â”€ api.ts      #   - Axios é…ç½®
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”œâ”€â”€ requirement.service.ts
â”‚   â”œâ”€â”€ analysis.service.ts
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ App.tsx         # æ ¹ç»„ä»¶ï¼ˆè·¯ç”±é…ç½®ï¼‰
```

**æ•°æ®æµå‘ï¼š**
```
ç”¨æˆ·æ“ä½œ â†’ ç»„ä»¶äº‹ä»¶ â†’ Store Action â†’ Service API â†’ åç«¯
                â†“
         çŠ¶æ€æ›´æ–° â†’ ç»„ä»¶é‡æ¸²æŸ“
```

### 2.3 åç«¯æ¶æ„

```
backend/app/
â”œâ”€â”€ api/            # API è·¯ç”±å±‚ï¼ˆç«¯ç‚¹ï¼‰
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ auth.py      # /api/v1/auth/*
â”‚       â”œâ”€â”€ requirements.py # /api/v1/requirements/*
â”‚       â”œâ”€â”€ analysis.py  # /api/v1/requirements/{id}/analysis
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ core/           # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ auth.py        # è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ security.py    # JWTã€å¯†ç 
â”‚   â”œâ”€â”€ tenant.py      # å¤šç§Ÿæˆ·ä¸­é—´ä»¶
â”‚   â””â”€â”€ permissions.py # æƒé™ç®¡ç†
â”‚
â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹ï¼ˆ21ä¸ªè¡¨ï¼‰
â”‚   â”œâ”€â”€ user.py        # ç”¨æˆ·è¡¨
â”‚   â”œâ”€â”€ tenant.py      # ç§Ÿæˆ·è¡¨
â”‚   â”œâ”€â”€ requirement.py # éœ€æ±‚è¡¨
â”‚   â”œâ”€â”€ appeals.py     # APPEALS åˆ†æ
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ schemas/        # Pydantic éªŒè¯æ¨¡å¼
â”‚   â””â”€â”€ ï¼ˆå¯¹åº”å„æ¨¡å‹çš„è¯·æ±‚/å“åº”Schemaï¼‰
â”‚
â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ requirement.py # éœ€æ±‚æœåŠ¡
â”‚   â”œâ”€â”€ user.py        # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ analysis.py    # åˆ†ææœåŠ¡
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ repositories/   # æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰
â”‚   â”œâ”€â”€ base.py        # åŸºç¡€ä»“å‚¨
â”‚   â”œâ”€â”€ requirement.py # éœ€æ±‚æ•°æ®è®¿é—®
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ db/             # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ base.py        # å¼•æ“é…ç½®
â”‚   â””â”€â”€ session.py     # ä¼šè¯ç®¡ç†
â”‚
â””â”€â”€ utils/          # å·¥å…·ç±»
    â”œâ”€â”€ calculator.py  # è¯„åˆ†è®¡ç®—
    â”œâ”€â”€ excel.py       # Excel å¤„ç†
    â””â”€â”€ pdf.py         # PDF ç”Ÿæˆ
```

**è¯·æ±‚å¤„ç†æµç¨‹ï¼š**
```
HTTPè¯·æ±‚ â†’ ä¸­é—´ä»¶ï¼ˆç§Ÿæˆ·/è®¤è¯ï¼‰ â†’ è·¯ç”±å¤„ç†
                                  â†“
                            ä¾èµ–æ³¨å…¥ï¼ˆç”¨æˆ·/DBï¼‰
                                  â†“
                            Service ä¸šåŠ¡é€»è¾‘
                                  â†“
                            Repository æ•°æ®è®¿é—®
                                  â†“
                            æ•°æ®åº“æ“ä½œ
                                  â†“
                            å“åº”åºåˆ—åŒ–ï¼ˆPydanticï¼‰
                                  â†“
                            JSON å“åº”
```

### 2.4 æ•°æ®åº“æ¶æ„

**å…± 13 å¼ æ ¸å¿ƒè¡¨ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç”¨æˆ·ç§Ÿæˆ·     â”‚  â† å¤šç§Ÿæˆ·åŸºç¡€
â”‚  (users, tenants)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   éœ€æ±‚ä¸»è¡¨      â”‚  â† æ ¸å¿ƒä¸šåŠ¡è¡¨
â”‚ (requirements)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åé—®è¡¨ â”‚ â”‚APPEALSâ”‚ â”‚ KANOâ”‚ â”‚åˆ†æç»“æœâ”‚
â”‚(10q)  â”‚ â”‚      â”‚ â”‚     â”‚ â”‚(INVEST â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â”‚ MoSCoW â”‚
                           â”‚  RICE) â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼         â–¼         â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SP   â”‚ â”‚  BP  â”‚ â”‚Charterâ”‚â”‚  PCR  â”‚  â† åˆ†å‘ç›®æ ‡
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RTM    â”‚  â† éœ€æ±‚è¿½æº¯
â”‚ (è¿½æº¯çŸ©é˜µ)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚éªŒè¯è®°å½•è¡¨â”‚  â† éªŒè¯ç®¡ç†
â”‚(verifications)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å·¥ä½œæµå†å²â”‚  â† å®¡è®¡æ—¥å¿—
â”‚(workflow) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. åç«¯è¯¦ç»†åˆ†æ

### 3.1 é¡¹ç›®ç»“æ„

```
/Users/kingsun/claude_study/backend/
â”œâ”€â”€ app/                          # ä¸»åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ main.py                   # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ deps.py              # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ v1/                  # API v1 ç‰ˆæœ¬
â”‚   â”‚       â”œâ”€â”€ auth.py          # è®¤è¯ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ requirements.py  # éœ€æ±‚ç®¡ç†ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ appeals.py       # APPEALS åˆ†æç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ analysis.py      # éœ€æ±‚åˆ†æç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ verification.py  # éªŒè¯ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ distribution.py  # åˆ†å‘ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ import_export.py # å¯¼å…¥å¯¼å‡ºç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ notifications.py # é€šçŸ¥ç«¯ç‚¹
â”‚   â”‚       â””â”€â”€ tenant.py        # ç§Ÿæˆ·ç®¡ç†ç«¯ç‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ auth.py              # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ security.py          # å®‰å…¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ exceptions.py        # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ permissions.py       # æƒé™ç®¡ç†
â”‚   â”‚   â””â”€â”€ tenant.py            # å¤šç§Ÿæˆ·ä¸­é—´ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹å±‚ (21ä¸ªæ¨¡å‹)
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ tenant.py            # ç§Ÿæˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ requirement.py       # éœ€æ±‚æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ appeals.py           # APPEALS åˆ†ææ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ kano.py              # KANO åˆ†ç±»æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ sp.py                # æˆ˜ç•¥è§„åˆ’æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ bp.py                # å•†ä¸šè®¡åˆ’æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ charter.py           # é¡¹ç›®ç« ç¨‹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ pcr.py               # äº§å“å˜æ›´è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ verification.py      # éªŒè¯è®°å½•æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ rtm.py               # éœ€æ±‚è¿½æº¯çŸ©é˜µæ¨¡å‹
â”‚   â”‚   â””â”€â”€ workflow.py          # å·¥ä½œæµå†å²æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # Pydantic æ•°æ®éªŒè¯æ¨¡å¼
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ requirement.py       # éœ€æ±‚æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ appeals.py           # APPEALS æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ analysis.py          # åˆ†ææœåŠ¡
â”‚   â”‚   â””â”€â”€ notification.py      # é€šçŸ¥æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ repositories/             # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ base.py              # åŸºç¡€ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ requirement.py       # éœ€æ±‚æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ tenant.py            # ç§Ÿæˆ·æ•°æ®è®¿é—®
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                       # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ base.py              # æ•°æ®åº“åŸºç¡€é…ç½®
â”‚   â”‚   â”œâ”€â”€ session.py           # ä¼šè¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ mixins.py            # æ¨¡å‹æ··å…¥ç±»
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # å·¥å…·ç±»
â”‚       â”œâ”€â”€ calculator.py        # è¯„åˆ†è®¡ç®—å™¨
â”‚       â”œâ”€â”€ excel.py             # Excel å¤„ç†
â”‚       â””â”€â”€ pdf.py               # PDF å¤„ç†
â”‚
â”œâ”€â”€ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ versions/                # è¿ç§»ç‰ˆæœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ç›®å½•ï¼ˆâš ï¸ ç©ºçš„ï¼‰
â”œâ”€â”€ scripts/                      # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ create_user.py           # åˆ›å»ºç”¨æˆ·è„šæœ¬
â”‚   â””â”€â”€ init_users.py            # æ‰¹é‡åˆå§‹åŒ–
â”‚
â”œâ”€â”€ requirements.txt              # Python ä¾èµ–
â”œâ”€â”€ Dockerfile                    # Docker é…ç½®
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
```

**ä»£ç ç»Ÿè®¡ï¼š**
- Python æ–‡ä»¶æ€»æ•°ï¼š67 ä¸ª
- ä»£ç è¡Œæ•°ï¼šçº¦ 7000+ è¡Œ

### 3.2 æ ¸å¿ƒæŠ€æœ¯æ ˆè¯¦è§£

#### 3.2.1 Web æ¡†æ¶ - FastAPI 0.104+

**ä¸ºä»€ä¹ˆé€‰æ‹© FastAPIï¼Ÿ**
- âœ… ç°ä»£åŒ–ï¼šåŸºäº Python 3.7+ ç±»å‹æ³¨è§£
- âœ… é«˜æ€§èƒ½ï¼šä¸ NodeJS å’Œ Go ç›¸å½“
- âœ… è‡ªåŠ¨æ–‡æ¡£ï¼šè‡ªåŠ¨ç”Ÿæˆ Swagger UI å’Œ ReDoc
- âœ… å¼‚æ­¥æ”¯æŒï¼šåŸç”Ÿ async/await
- âœ… ç±»å‹å®‰å…¨ï¼šPydantic æ•°æ®éªŒè¯
- âœ… æ˜“äºæµ‹è¯•ï¼šå®Œå–„çš„æµ‹è¯•æ”¯æŒ

**åº”ç”¨å…¥å£ï¼š** `/Users/kingsun/claude_study/backend/app/main.py`

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(
    title="IPD Requirements Management System",
    version="1.0.0",
    description="åŸºäºIPDæ¡†æ¶çš„éœ€æ±‚ç®¡ç†ç³»ç»ŸAPI"
)

# CORS ä¸­é—´ä»¶
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ç§Ÿæˆ·ä¸­é—´ä»¶
app.middleware("http")
async def tenant_middleware(request, call_next):
    # ä»è¯·æ±‚å¤´æå–ç§Ÿæˆ·ID
    # ...

# è·¯ç”±æ³¨å†Œ
app.include_router(auth_router, prefix="/api/v1/auth", tags=["è®¤è¯"])
app.include_router(requirements_router, prefix="/api/v1/requirements", tags=["éœ€æ±‚ç®¡ç†"])
# ...
```

**è®¿é—® API æ–‡æ¡£ï¼š**
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

#### 3.2.2 ORM - SQLAlchemy 2.0

**ç‰¹ç‚¹ï¼š**
- Python SQL å·¥å…·åŒ…å’Œ ORM
- 2.0 ç‰ˆæœ¬æ”¯æŒå¼‚æ­¥
- å£°æ˜å¼æ¨¡å‹å®šä¹‰
- è‡ªåŠ¨è¿ç§»ç”Ÿæˆ

**ç¤ºä¾‹æ¨¡å‹ï¼š**

```python
from sqlalchemy import Column, Integer, String, DateTime
from app.db.base import Base

class Requirement(Base):
    __tablename__ = "requirements"

    id = Column(Integer, primary_key=True, index=True)
    requirement_no = Column(String(50), unique=True, index=True)
    title = Column(String(200), nullable=False)
    description = Column(Text)
    status = Column(String(50), default="collected")
    # ...
```

#### 3.2.3 æ•°æ®éªŒè¯ - Pydantic 2.5+

**ä½œç”¨ï¼š**
- æ•°æ®éªŒè¯
- åºåˆ—åŒ–/ååºåˆ—åŒ–
- è‡ªåŠ¨ç”Ÿæˆ JSON Schema

**ç¤ºä¾‹ Schemaï¼š**

```python
from pydantic import BaseModel, Field

class RequirementCreate(BaseModel):
    title: str = Field(..., min_length=1, max_length=200)
    description: str | None = None
    source_channel: str = Field(..., pattern="^(customer|market|competition)$")
    priority: int = Field(default=60, ge=0, le=100)

    class Config:
        json_schema_extra = {
            "example": {
                "title": "å¢åŠ ç”¨æˆ·æƒé™ç®¡ç†åŠŸèƒ½",
                "description": "æ”¯æŒè§’è‰²å’Œæƒé™é…ç½®",
                "source_channel": "customer"
            }
        }
```

#### 3.2.4 è®¤è¯ - JWT (python-jose)

**JWT Token ç”Ÿæˆï¼š**

```python
from datetime import datetime, timedelta
from jose import jwt

def create_access_token(data: dict):
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=10080)  # 7å¤©
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt
```

**Token ç¤ºä¾‹ï¼š**
```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "exp": 1737886800
}
```

#### 3.2.5 æ•°æ®åº“ - PostgreSQL 15

**ç‰¹æ€§ï¼š**
- å…³ç³»å‹æ•°æ®åº“
- æ”¯æŒ JSONB å­—æ®µ
- å…¨æ–‡æœç´¢
- äº‹åŠ¡æ”¯æŒ
- å¤–é”®çº¦æŸ

**è¿æ¥å­—ç¬¦ä¸²ï¼š**
```
postgresql://ipd_user:ipd_pass@localhost:5432/ipd_req_db
```

#### 3.2.6 ç¼“å­˜ - Redis 7

**ç”¨é€”ï¼š**
- ä¼šè¯å­˜å‚¨
- ç¼“å­˜çƒ­ç‚¹æ•°æ®
- åˆ†å¸ƒå¼é”

**è¿æ¥å­—ç¬¦ä¸²ï¼š**
```
redis://localhost:6379
```

### 3.3 æ•°æ®æ¨¡å‹è¯¦è§£

#### 3.3.1 ç”¨æˆ·è¡¨ (users)

```python
å­—æ®µè¯´æ˜ï¼š
â”œâ”€â”€ id                # ä¸»é”®
â”œâ”€â”€ username          # ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
â”œâ”€â”€ email             # é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰
â”œâ”€â”€ hashed_password   # å¯†ç å“ˆå¸Œ
â”œâ”€â”€ full_name         # å…¨å
â”œâ”€â”€ role              # è§’è‰²
â”‚   â”œâ”€â”€ admin        #   - ç®¡ç†å‘˜
â”‚   â”œâ”€â”€ product_manager # - äº§å“ç»ç†
â”‚   â”œâ”€â”€ marketing_manager # - è¥é”€ç»ç†
â”‚   â””â”€â”€ sales_manager #   - é”€å”®ç»ç†
â”œâ”€â”€ department        # éƒ¨é—¨
â”œâ”€â”€ is_active         # æ˜¯å¦æ¿€æ´»
â”œâ”€â”€ tenant_id         # ç§Ÿæˆ·IDï¼ˆå¤–é”®ï¼‰
â””â”€â”€ created_at, updated_at # æ—¶é—´æˆ³
```

#### 3.3.2 éœ€æ±‚è¡¨ (requirements)

**æ ¸å¿ƒä¸šåŠ¡è¡¨ï¼Œå­—æ®µæœ€å¤šï¼š**

```python
åŸºç¡€ä¿¡æ¯ï¼š
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ requirement_no          # éœ€æ±‚ç¼–å·ï¼ˆå”¯ä¸€ï¼Œæ ¼å¼ï¼šREQ-2026-0001ï¼‰
â”œâ”€â”€ title                   # éœ€æ±‚æ ‡é¢˜
â”œâ”€â”€ description             # éœ€æ±‚æè¿°

ç”¨æˆ·æ•…äº‹ï¼š
â”œâ”€â”€ user_story_role         # ä½œä¸º"è§’è‰²"
â”œâ”€â”€ user_story_action       # æˆ‘æƒ³è¦"è¡Œä¸º"
â””â”€â”€ user_story_benefit      # ä»¥ä¾¿äº"æ”¶ç›Š"

æ”¶é›†ä¿¡æ¯ï¼š
â”œâ”€â”€ source_channel          # æ¥æºæ¸ é“
â”‚   â”œâ”€â”€ customer           #   - å®¢æˆ·
â”‚   â”œâ”€â”€ market             #   - å¸‚åœº
â”‚   â”œâ”€â”€ competition        #   - ç«äº‰å¯¹æ‰‹
â”‚   â”œâ”€â”€ sales              #   - é”€å”®
â”‚   â”œâ”€â”€ after_sales        #   - å”®å
â”‚   â””â”€â”€ rd                 #   - ç ”å‘
â”œâ”€â”€ source_contact          # è”ç³»äºº
â””â”€â”€ collector_id           # æ”¶é›†äººID

ä¼˜å…ˆçº§ï¼š
â”œâ”€â”€ priority_score          # ä¼˜å…ˆçº§åˆ†æ•°ï¼ˆ0-100ï¼‰
â”œâ”€â”€ priority_rank           # ä¼˜å…ˆçº§æ’å
â””â”€â”€ moscow_priority         # MoSCoWä¼˜å…ˆçº§
    â”œâ”€â”€ must               #   - å¿…é¡»æœ‰
    â”œâ”€â”€ should             #   - åº”è¯¥æœ‰
    â”œâ”€â”€ could              #   - å¯ä»¥æœ‰
    â””â”€â”€ wont               #   - ä¸ä¼šæœ‰

çŠ¶æ€ï¼š
â”œâ”€â”€ status                  # éœ€æ±‚çŠ¶æ€
    â”œâ”€â”€ collected          #   - å·²æ”¶é›†
    â”œâ”€â”€ analyzing          #   - åˆ†æä¸­
    â”œâ”€â”€ analyzed           #   - å·²åˆ†æ
    â”œâ”€â”€ distributing       #   - åˆ†é…ä¸­
    â”œâ”€â”€ distributed        #   - å·²åˆ†é…
    â”œâ”€â”€ implementing       #   - å®æ–½ä¸­
    â”œâ”€â”€ verifying          #   - éªŒè¯ä¸­
    â”œâ”€â”€ completed          #   - å·²å®Œæˆ
    â””â”€â”€ rejected           #   - å·²æ‹’ç»

åˆ†æç»“æœï¼ˆJSONBï¼‰ï¼š
â”œâ”€â”€ kano_category          # KANOåˆ†ç±»
â”œâ”€â”€ appeals_scores         # APPEALSåˆ†æ•°
â”œâ”€â”€ invest_analysis        # INVESTåˆ†æ
â””â”€â”€ rice_score             # RICEåˆ†æ•°

åˆ†å‘ä¿¡æ¯ï¼š
â”œâ”€â”€ target_type            # ç›®æ ‡ç±»å‹
â”‚   â”œâ”€â”€ sp                #   - æˆ˜ç•¥è§„åˆ’
â”‚   â”œâ”€â”€ bp                #   - å•†ä¸šè®¡åˆ’
â”‚   â”œâ”€â”€ charter           #   - é¡¹ç›®ç« ç¨‹
â”‚   â””â”€â”€ pcr               #   - äº§å“å˜æ›´è¯·æ±‚
â””â”€â”€ target_id              # ç›®æ ‡ID

ä¼°ç®—ï¼š
â”œâ”€â”€ estimated_duration_months  # é¢„ä¼°å·¥æœŸï¼ˆæœˆï¼‰
â””â”€â”€ complexity_level           # å¤æ‚åº¦çº§åˆ«

å…ƒæ•°æ®ï¼š
â”œâ”€â”€ version                 # ç‰ˆæœ¬å·
â”œâ”€â”€ created_by              # åˆ›å»ºäºº
â”œâ”€â”€ updated_by              # æ›´æ–°äºº
â”œâ”€â”€ tenant_id               # ç§Ÿæˆ·ID
â””â”€â”€ created_at, updated_at  # æ—¶é—´æˆ³
```

**éœ€æ±‚çŠ¶æ€æµè½¬ï¼š**
```
å·²æ”¶é›† â†’ åˆ†æä¸­ â†’ å·²åˆ†æ â†’ åˆ†é…ä¸­ â†’ å·²åˆ†é… â†’ å®æ–½ä¸­ â†’ éªŒè¯ä¸­ â†’ å·²å®Œæˆ
                         â†“
                      å·²æ‹’ç»
```

#### 3.3.3 å®¢æˆ·éœ€æ±‚åé—®è¡¨ (requirement_10_questions)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ requirement_id          # éœ€æ±‚IDï¼ˆå¤–é”®ï¼‰
â”œâ”€â”€ q1_who_cares           # è°å…³æ³¨è¿™ä¸ªéœ€æ±‚
â”œâ”€â”€ q2_why_care            # ä¸ºä»€ä¹ˆå…³æ³¨
â”œâ”€â”€ q3_how_often           # ä½¿ç”¨é¢‘ç‡
â”œâ”€â”€ q4_current_solution    # ç°æœ‰è§£å†³æ–¹æ¡ˆ
â”œâ”€â”€ q5_pain_points         # ç—›ç‚¹é—®é¢˜
â”œâ”€â”€ q6_expected_outcome    # æœŸæœ›ç»“æœ
â”œâ”€â”€ q7_value_impact        # ä»·å€¼å’Œå½±å“
â”œâ”€â”€ q8_urgency_level       # ç´§æ€¥ç¨‹åº¦
â”œâ”€â”€ q9_budget_willingness   # é¢„ç®—æ„æ„¿
â”œâ”€â”€ q10_alternative_solutions # æ›¿ä»£æ–¹æ¡ˆ
â”œâ”€â”€ additional_notes       # è¡¥å……è¯´æ˜
â”œâ”€â”€ answered_by            # å›ç­”äºº
â””â”€â”€ tenant_id              # ç§Ÿæˆ·ID
```

#### 3.3.4 APPEALS åˆ†æè¡¨ (appeals_analysis)

```python
# 8ä¸ªç»´åº¦ï¼Œæ¯ä¸ªç»´åº¦åŒ…å«ï¼šè¯„åˆ†ã€æƒé‡ã€è¯„è®º

ä»·æ ¼ç»´åº¦ (price_)ï¼š
â”œâ”€â”€ score        # è¯„åˆ†ï¼ˆ1-10ï¼‰
â”œâ”€â”€ weight       # æƒé‡ï¼ˆ0-1ï¼Œæ€»å’Œä¸º1ï¼‰
â””â”€â”€ comment      # è¯„è®º

å¯è·å¾—æ€§ (availability_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

åŒ…è£… (packaging_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

æ€§èƒ½ (performance_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

æ˜“ç”¨æ€§ (ease_of_use_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

ä¿è¯ (assurance_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

ç”Ÿå‘½å‘¨æœŸæˆæœ¬ (lifecycle_cost_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

ç¤¾ä¼šæ¥å—åº¦ (social_acceptance_)ï¼š
â”œâ”€â”€ score
â”œâ”€â”€ weight
â””â”€â”€ comment

æ€»è®¡ï¼š
â”œâ”€â”€ total_weighted_score  # æ€»åŠ æƒåˆ†ï¼ˆ0-100ï¼‰
â”œâ”€â”€ analyzed_at           # åˆ†ææ—¶é—´
â””â”€â”€ analyzed_by           # åˆ†æäºº
```

**APPEALS è¯„åˆ†è®¡ç®—ï¼š**
```
æ€»åˆ† = Î£(ç»´åº¦è¯„åˆ† Ã— ç»´åº¦æƒé‡)
```

#### 3.3.5 KANO åˆ†ç±»è¡¨ (kano_classification)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ requirement_id          # éœ€æ±‚ID
â”œâ”€â”€ category               # åˆ†ç±»
â”‚   â”œâ”€â”€ basic              # - åŸºæœ¬å‹éœ€æ±‚
â”‚   â”œâ”€â”€ performance        # - æœŸæœ›å‹éœ€æ±‚
â”‚   â”œâ”€â”€ excitement         # - å…´å¥‹å‹éœ€æ±‚
â”‚   â”œâ”€â”€ indifferent        # - æ— å·®å¼‚å‹
â”‚   â””â”€â”€ reverse            # - åå‘å‹
â”œâ”€â”€ confidence_level       # ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰

# è°ƒæŸ¥ç»“æœ
â”œâ”€â”€ functional_present     # åŠŸèƒ½å­˜åœ¨æ—¶è¯„åˆ†ï¼ˆ1-5ï¼‰
â”œâ”€â”€ functional_absent      # åŠŸèƒ½ç¼ºå¤±æ—¶è¯„åˆ†ï¼ˆ1-5ï¼‰
â”œâ”€â”€ dysfunctional_present  # åŠŸèƒ½å­˜åœ¨æ—¶è¯„åˆ†ï¼ˆ1-5ï¼‰
â”œâ”€â”€ dysfunctional_absent   # åŠŸèƒ½ç¼ºå¤±æ—¶è¯„åˆ†ï¼ˆ1-5ï¼‰

â”œâ”€â”€ classification_reason  # åˆ†ç±»åŸå› 
â”œâ”€â”€ better_answer          # æ›´å¥½ç­”æ¡ˆ
â”œâ”€â”€ worse_answer           # æ›´å·®ç­”æ¡ˆ
â”œâ”€â”€ classified_at          # åˆ†ç±»æ—¶é—´
â””â”€â”€ classified_by          # åˆ†ç±»äºº
```

**KANO åˆ†ç±»é€»è¾‘ï¼š**
```
æ ¹æ®åŠŸèƒ½/åŠŸèƒ½ç¼ºå¤±çš„è¯„åˆ†ç»„åˆï¼ŒæŸ¥è¡¨ç¡®å®šåˆ†ç±»ï¼š
- basic: ç¼ºå¤±æ—¶ä¸æ»¡ï¼Œå­˜åœ¨æ—¶ä¸€èˆ¬
- performance: ç¼ºå¤±æ—¶ä¸æ»¡ï¼Œå­˜åœ¨æ—¶æ»¡æ„
- excitement: ç¼ºå¤±æ—¶ä¸€èˆ¬ï¼Œå­˜åœ¨æ—¶æƒŠå–œ
```

#### 3.3.6 æˆ˜ç•¥è§„åˆ’è¡¨ (strategic_plans)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ sp_code                # SPä»£ç ï¼ˆå”¯ä¸€ï¼‰
â”œâ”€â”€ title                  # æ ‡é¢˜
â”œâ”€â”€ description            # æè¿°
â”œâ”€â”€ year                   # å¹´åº¦
â”œâ”€â”€ status                 # çŠ¶æ€
â”œâ”€â”€ strategic_importance   # æˆ˜ç•¥é‡è¦æ€§ï¼ˆ1-5ï¼‰
â”œâ”€â”€ investment_budget      # æŠ•èµ„é¢„ç®—
â”œâ”€â”€ start_date             # å¼€å§‹æ—¥æœŸ
â”œâ”€â”€ end_date               # ç»“æŸæ—¥æœŸ
â”œâ”€â”€ created_by, updated_by # åˆ›å»ºäºº/æ›´æ–°äºº
â””â”€â”€ created_at, updated_at # æ—¶é—´æˆ³
```

#### 3.3.7 å•†ä¸šè®¡åˆ’è¡¨ (business_plans)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ bp_code                # BPä»£ç ï¼ˆå”¯ä¸€ï¼‰
â”œâ”€â”€ title                  # æ ‡é¢˜
â”œâ”€â”€ sp_id                  # å…³è”SP IDï¼ˆå¤–é”®ï¼‰
â”œâ”€â”€ quarter                # å­£åº¦ï¼ˆæ ¼å¼ï¼š2026-Q1ï¼‰
â”œâ”€â”€ year                   # å¹´åº¦
â”œâ”€â”€ status                 # çŠ¶æ€
â”œâ”€â”€ budget                 # é¢„ç®—
â”œâ”€â”€ expected_revenue       # é¢„æœŸæ”¶å…¥
â”œâ”€â”€ start_date, end_date   # èµ·æ­¢æ—¥æœŸ
â”œâ”€â”€ created_by, updated_by # åˆ›å»ºäºº/æ›´æ–°äºº
â””â”€â”€ created_at, updated_at # æ—¶é—´æˆ³
```

#### 3.3.8 é¡¹ç›®ç« ç¨‹è¡¨ (project_charters)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ charter_code           # ç« ç¨‹ä»£ç 
â”œâ”€â”€ title                  # æ ‡é¢˜
â”œâ”€â”€ bp_id                  # å…³è”BP ID
â”œâ”€â”€ project_type           # é¡¹ç›®ç±»å‹
â”œâ”€â”€ objectives             # ç›®æ ‡
â”œâ”€â”€ scope                  # èŒƒå›´
â”œâ”€â”€ assumptions            # å‡è®¾
â”œâ”€â”€ constraints            # çº¦æŸ
â”œâ”€â”€ project_manager_id     # é¡¹ç›®ç»ç†ID
â”œâ”€â”€ team_lead_id           # å›¢é˜Ÿè´Ÿè´£äººID
â”œâ”€â”€ team_size              # å›¢é˜Ÿè§„æ¨¡
â”œâ”€â”€ estimated_duration_months # é¢„ä¼°å·¥æœŸ
â”œâ”€â”€ budget                 # é¢„ç®—
â”œâ”€â”€ status                 # çŠ¶æ€
â”œâ”€â”€ start_date, end_date   # èµ·æ­¢æ—¥æœŸ
â””â”€â”€ ...
```

#### 3.3.9 äº§å“å˜æ›´è¯·æ±‚è¡¨ (product_change_requests)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ pcr_code               # PCRä»£ç 
â”œâ”€â”€ title                  # æ ‡é¢˜
â”œâ”€â”€ requirement_id         # å…³è”éœ€æ±‚ID
â”œâ”€â”€ charter_id             # å…³è”ç« ç¨‹ID
â”œâ”€â”€ change_type            # å˜æ›´ç±»å‹
â”œâ”€â”€ urgency_level          # ç´§æ€¥ç¨‹åº¦
â”œâ”€â”€ impact_assessment      # å½±å“è¯„ä¼°
â”œâ”€â”€ risk_assessment        # é£é™©è¯„ä¼°
â”œâ”€â”€ estimated_effort_hours # é¢„ä¼°å·¥æ—¶
â”œâ”€â”€ status                 # çŠ¶æ€
â”œâ”€â”€ submitted_by           # æäº¤äºº
â”œâ”€â”€ reviewed_by            # å®¡æ ¸äºº
â”œâ”€â”€ approved_by            # æ‰¹å‡†äºº
â”œâ”€â”€ submitted_at           # æäº¤æ—¶é—´
â”œâ”€â”€ reviewed_at            # å®¡æ ¸æ—¶é—´
â”œâ”€â”€ approved_at            # æ‰¹å‡†æ—¶é—´
â””â”€â”€ implemented_at         # å®æ–½æ—¶é—´
```

#### 3.3.10 éœ€æ±‚è¿½æº¯çŸ©é˜µè¡¨ (requirement_traceability)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ requirement_id         # éœ€æ±‚ID
â”œâ”€â”€ trace_type             # è¿½æº¯ç±»å‹
â”‚   â”œâ”€â”€ forward            # - å‰å‘è¿½æº¯
â”‚   â”œâ”€â”€ backward           # - åå‘è¿½æº¯
â”‚   â””â”€â”€ derived            # - æ´¾ç”Ÿè¿½æº¯
â”œâ”€â”€ linked_type            # å…³è”ç±»å‹
â”‚   â”œâ”€â”€ requirement        # - éœ€æ±‚
â”‚   â”œâ”€â”€ test_case          # - æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ design_doc         # - è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ code_module        # - ä»£ç æ¨¡å—
â”œâ”€â”€ linked_id              # å…³è”ID
â”œâ”€â”€ coverage_status        # è¦†ç›–çŠ¶æ€
â”‚   â”œâ”€â”€ covered            # - å·²è¦†ç›–
â”‚   â”œâ”€â”€ partial            # - éƒ¨åˆ†è¦†ç›–
â”‚   â””â”€â”€ not_covered        # - æœªè¦†ç›–
â”œâ”€â”€ verification_status    # éªŒè¯çŠ¶æ€
â”‚   â”œâ”€â”€ verified           # - å·²éªŒè¯
â”‚   â”œâ”€â”€ failed             # - å¤±è´¥
â”‚   â””â”€â”€ pending            # - å¾…éªŒè¯
â”œâ”€â”€ stage                  # CDPé˜¶æ®µ
â”‚   â”œâ”€â”€ concept            # - æ¦‚å¿µ
â”‚   â”œâ”€â”€ planning           # - è§„åˆ’
â”‚   â”œâ”€â”€ development        # - å¼€å‘
â”‚   â”œâ”€â”€ testing            # - æµ‹è¯•
â”‚   â”œâ”€â”€ launch             # - å‘å¸ƒ
â”‚   â””â”€â”€ maintenance        # - ç»´æŠ¤
â”œâ”€â”€ stage_status           # é˜¶æ®µçŠ¶æ€
â”‚   â”œâ”€â”€ not_started        # - æœªå¼€å§‹
â”‚   â”œâ”€â”€ in_progress        # - è¿›è¡Œä¸­
â”‚   â”œâ”€â”€ completed          # - å·²å®Œæˆ
â”‚   â””â”€â”€ blocked            # - é˜»å¡
â””â”€â”€ trace_notes            # è¿½æº¯å¤‡æ³¨
```

#### 3.3.11 éªŒè¯è®°å½•è¡¨ (verifications)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ requirement_id         # éœ€æ±‚ID
â”œâ”€â”€ verification_type      # éªŒè¯ç±»å‹
â”‚   â”œâ”€â”€ prototype          # - åŸå‹
â”‚   â”œâ”€â”€ test               # - æµ‹è¯•
â”‚   â”œâ”€â”€ user_trial         # - ç”¨æˆ·è¯•ç”¨
â”‚   â””â”€â”€ customer_confirmation # - å®¢æˆ·ç¡®è®¤
â”œâ”€â”€ verification_method    # éªŒè¯æ–¹æ³•
â”œâ”€â”€ result                 # éªŒè¯ç»“æœ
â”‚   â”œâ”€â”€ passed             # - é€šè¿‡
â”‚   â”œâ”€â”€ failed             # - å¤±è´¥
â”‚   â”œâ”€â”€ partial_passed     # - éƒ¨åˆ†é€šè¿‡
â”‚   â””â”€â”€ pending            # - å¾…éªŒè¯
â”œâ”€â”€ evidence_attachments   # è¯æ®é™„ä»¶ï¼ˆJSONï¼‰
â”œâ”€â”€ customer_feedback      # å®¢æˆ·åé¦ˆ
â”œâ”€â”€ satisfaction_score     # æ»¡æ„åº¦è¯„åˆ†ï¼ˆ1-5ï¼‰
â”œâ”€â”€ issues_found           # å‘ç°é—®é¢˜
â”œâ”€â”€ improvement_suggestions # æ”¹è¿›å»ºè®®
â”œâ”€â”€ verified_at            # éªŒè¯æ—¶é—´
â”œâ”€â”€ verified_by            # éªŒè¯äºº
â”œâ”€â”€ reviewed_by            # å®¡æ ¸äºº
â””â”€â”€ reviewed_at            # å®¡æ ¸æ—¶é—´
```

#### 3.3.12 å·¥ä½œæµå†å²è¡¨ (workflow_history)

**å®¡è®¡æ—¥å¿—è¡¨ï¼Œè®°å½•æ‰€æœ‰çŠ¶æ€å˜æ›´ï¼š**

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ entity_type            # å®ä½“ç±»å‹
â”œâ”€â”€ entity_id              # å®ä½“ID
â”œâ”€â”€ action                 # æ“ä½œåŠ¨ä½œ
â”‚   â”œâ”€â”€ created            # - åˆ›å»º
â”‚   â”œâ”€â”€ updated            # - æ›´æ–°
â”‚   â”œâ”€â”€ submitted          # - æäº¤
â”‚   â”œâ”€â”€ approved           # - æ‰¹å‡†
â”‚   â”œâ”€â”€ rejected           # - æ‹’ç»
â”‚   â””â”€â”€ ...
â”œâ”€â”€ from_status            # åŸçŠ¶æ€
â”œâ”€â”€ to_status              # æ–°çŠ¶æ€
â”œâ”€â”€ action_reason          # æ“ä½œåŸå› 
â”œâ”€â”€ comments               # å¤‡æ³¨
â”œâ”€â”€ performed_by           # æ“ä½œäºº
â”œâ”€â”€ performed_at           # æ“ä½œæ—¶é—´
â””â”€â”€ changes_snapshot       # å˜æ›´å¿«ç…§ï¼ˆJSONï¼‰
```

#### 3.3.13 é€šçŸ¥è¡¨ (notifications)

```python
â”œâ”€â”€ id                      # ä¸»é”®
â”œâ”€â”€ user_id                # ç”¨æˆ·ID
â”œâ”€â”€ notification_type      # é€šçŸ¥ç±»å‹
â”‚   â”œâ”€â”€ requirement_created
â”‚   â”œâ”€â”€ requirement_updated
â”‚   â”œâ”€â”€ requirement_assigned
â”‚   â”œâ”€â”€ analysis_completed
â”‚   â””â”€â”€ ...
â”œâ”€â”€ title                  # æ ‡é¢˜
â”œâ”€â”€ message                # æ¶ˆæ¯å†…å®¹
â”œâ”€â”€ entity_type            # å…³è”å®ä½“ç±»å‹
â”œâ”€â”€ entity_id              # å…³è”å®ä½“ID
â”œâ”€â”€ is_read                # æ˜¯å¦å·²è¯»
â”œâ”€â”€ read_at                # é˜…è¯»æ—¶é—´
â”œâ”€â”€ tenant_id              # ç§Ÿæˆ·ID
â””â”€â”€ created_at, updated_at # æ—¶é—´æˆ³
```

### 3.4 API ç«¯ç‚¹è¯¦è§£

#### 3.4.1 è®¤è¯ API

**ç™»å½•æ¥å£ï¼š**
```http
POST /api/v1/auth/login
Content-Type: application/x-www-form-urlencoded

username=admin&password=admin123
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "token_type": "bearer",
    "user": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin",
      "full_name": "Administrator"
    }
  }
}
```

**è·å–å½“å‰ç”¨æˆ·ï¼š**
```http
GET /api/v1/auth/me
Authorization: Bearer <token>
```

#### 3.4.2 éœ€æ±‚ç®¡ç† API

**è·å–éœ€æ±‚åˆ—è¡¨ï¼š**
```http
GET /api/v1/requirements/?page=1&page_size=20&status=analyzed&search=å…³é”®è¯
Authorization: Bearer <token>
X-Tenant-ID: 1
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "requirement_no": "REQ-2026-0001",
        "title": "å¢åŠ ç”¨æˆ·æƒé™ç®¡ç†",
        "description": "æ”¯æŒè§’è‰²å’Œæƒé™é…ç½®",
        "status": "analyzed",
        "priority_score": 85,
        "moscow_priority": "must",
        "created_at": "2026-01-01T00:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20,
    "total_pages": 5
  }
}
```

**åˆ›å»ºéœ€æ±‚ï¼š**
```http
POST /api/v1/requirements/
Authorization: Bearer <token>
X-Tenant-ID: 1
Content-Type: application/json

{
  "title": "å¢åŠ ç”¨æˆ·æƒé™ç®¡ç†",
  "description": "æ”¯æŒè§’è‰²å’Œæƒé™é…ç½®",
  "source_channel": "customer",
  "moscow_priority": "must",
  "customer_need_10q": {
    "q1_who_cares": "äº§å“ç»ç†",
    "q2_why_care": "éœ€è¦ç»†åŒ–æƒé™æ§åˆ¶",
    ...
  }
}
```

**æ›´æ–°éœ€æ±‚çŠ¶æ€ï¼š**
```http
POST /api/v1/requirements/1/status
Authorization: Bearer <token>

{
  "status": "analyzing"
}
```

**è·å–ç»Ÿè®¡ä¿¡æ¯ï¼š**
```http
GET /api/v1/requirements/stats/summary
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "total": 100,
    "by_status": {
      "collected": 10,
      "analyzing": 20,
      "analyzed": 30,
      "distributed": 25,
      "implementing": 10,
      "completed": 5
    },
    "by_channel": {
      "customer": 40,
      "market": 20,
      "sales": 15,
      "rd": 25
    }
  }
}
```

#### 3.4.3 APPEALS åˆ†æ API

**ä¿å­˜APPEALSåˆ†æï¼š**
```http
POST /api/v1/requirements/1/appeals
Content-Type: application/json

{
  "price_score": 8,
  "price_weight": 0.15,
  "price_comment": "ä»·æ ¼åˆç†",
  "availability_score": 9,
  "availability_weight": 0.10,
  ...
}
```

**è·å–APPEALSæ±‡æ€»ï¼š**
```http
GET /api/v1/requirements/1/appeals/summary
```

#### 3.4.4 éœ€æ±‚åˆ†æ API

**ä¿å­˜ç»¼åˆåˆ†æï¼š**
```http
POST /api/v1/requirements/1/analysis
Content-Type: application/json

{
  "invest": {
    "independent": true,
    "negotiable": true,
    "valuable": true,
    "estimable": true,
    "small": true,
    "testable": true
  },
  "moscow": {
    "priority": "must_have",
    "comment": "å¿…é¡»æœ‰"
  },
  "kano_category": "performance",
  "rice": {
    "reach": 8,
    "impact": 9,
    "confidence": 7,
    "effort": 5
  }
}
```

#### 3.4.5 éªŒè¯ API

**åˆ›å»ºéªŒè¯æ¸…å•ï¼š**
```http
POST /api/v1/requirements/1/verification
Content-Type: application/json

{
  "verification_type": "prototype",
  "checklist_name": "åŸå‹éªŒè¯æ¸…å•",
  "checklist_items": [
    {
      "item": "åŠŸèƒ½å®Œæ•´æ€§",
      "expected": "æ»¡è¶³æ‰€æœ‰éœ€æ±‚",
      "status": "pending"
    }
  ]
}
```

**æäº¤éªŒè¯ç»“æœï¼š**
```http
POST /api/v1/requirements/1/verification/1/submit
Content-Type: application/json

{
  "result": "passed",
  "evidence_attachments": ["file1.pdf", "file2.jpg"],
  "customer_feedback": "æ»¡è¶³éœ€æ±‚",
  "issues_found": "",
  "improvement_suggestions": ""
}
```

#### 3.4.6 åˆ†å‘ API

**ç”Ÿæˆç›®æ ‡IDï¼š**
```http
GET /api/v1/distribution/next-target-id?target_type=sp
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "target_type": "sp",
    "next_numeric_id": 1,
    "formatted_id": "SP-001",
    "prefix": "SP"
  }
}
```

### 3.5 ä¸šåŠ¡é€»è¾‘å±‚

#### 3.5.1 éœ€æ±‚æœåŠ¡ (RequirementService)

**è·¯å¾„ï¼š** `app/services/requirement.py`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

1. **åˆ›å»ºéœ€æ±‚ï¼ˆå«è‡ªåŠ¨ç¼–å·ï¼‰**
```python
def create_requirement(data, created_by):
    # 1. ç”Ÿæˆéœ€æ±‚ç¼–å·ï¼šREQ-2026-0001
    requirement_no = _generate_requirement_no()

    # 2. åˆ›å»ºéœ€æ±‚è®°å½•
    requirement = Requirement(
        requirement_no=requirement_no,
        title=data.title,
        ...
    )

    # 3. å¦‚æœæœ‰åé—®ï¼Œåˆ›å»ºåé—®è®°å½•
    if data.customer_need_10q:
        create_10_questions(requirement.id, data.customer_need_10q)

    return requirement
```

**ç¼–å·ç”Ÿæˆé€»è¾‘ï¼š**
```
æ ¼å¼ï¼šREQ-YYYY-NNNN
ç¤ºä¾‹ï¼šREQ-2026-0001

é€»è¾‘ï¼š
1. è·å–å½“å¹´æœ€å¤§ç¼–å·
2. åºå· +1
3. æ ¼å¼åŒ–ä¸º 4 ä½æ•°å­—
```

2. **çŠ¶æ€æ›´æ–°ï¼ˆå«å·¥ä½œæµè®°å½•ï¼‰**
```python
def update_status(requirement_id, new_status, user_id):
    # 1. è·å–åŸçŠ¶æ€
    old_status = requirement.status

    # 2. æ›´æ–°çŠ¶æ€
    requirement.status = new_status

    # 3. è®°å½•å·¥ä½œæµå†å²
    create_workflow_history(
        entity_type="requirement",
        entity_id=requirement_id,
        from_status=old_status,
        to_status=new_status,
        performed_by=user_id
    )

    # 4. å‘é€é€šçŸ¥
    send_notification(
        user_id=requirement.created_by,
        notification_type="requirement_status_changed",
        message=f"éœ€æ±‚çŠ¶æ€å·²ä» {old_status} æ›´æ”¹ä¸º {new_status}"
    )
```

3. **ç»Ÿè®¡åˆ†æ**
```python
def get_statistics():
    return {
        "total": count_all(),
        "by_status": group_by_status(),
        "by_channel": group_by_channel(),
        "by_moscow": group_by_moscow(),
        "by_kano": group_by_kano()
    }
```

#### 3.5.2 åˆ†ææœåŠ¡ (AnalysisService)

**ç»¼åˆè¯„åˆ†è®¡ç®—ï¼š**

```python
def calculate_overall_score(analysis_data):
    """
    ç»¼åˆè¯„åˆ† = åŠ æƒå¹³å‡
    - INVEST: 30%
    - MoSCoW: 20%
    - Kano: 20%
    - RICE: 30%
    """

    # INVEST è¯„åˆ†ï¼ˆ0-100ï¼‰
    invest_score = (
        sum([ç‹¬ç«‹, å¯åå•†, æœ‰ä»·å€¼, å¯ä¼°ç®—, å°å‹, å¯æµ‹è¯•]) / 6 * 100
    )

    # MoSCoW è¯„åˆ†
    moscow_scores = {
        "must_have": 100,
        "should_have": 75,
        "could_have": 50,
        "wont_have": 25
    }
    moscow_score = moscow_scores[moscow_priority]

    # Kano è¯„åˆ†
    kano_scores = {
        "excitement": 100,
        "performance": 75,
        "basic": 50,
        "indifferent": 25,
        "reverse": 0
    }
    kano_score = kano_scores[kano_category]

    # RICE è¯„åˆ†ï¼ˆæ ‡å‡†åŒ–ï¼‰
    rice_score = min((reach * impact * confidence / effort) * 10, 100)

    # åŠ æƒå¹³å‡
    overall_score = (
        invest_score * 0.30 +
        moscow_score * 0.20 +
        kano_score * 0.20 +
        rice_score * 0.30
    )

    return round(overall_score, 2)
```

#### 3.5.3 è¯„åˆ†è®¡ç®—å™¨ (Calculator)

**è·¯å¾„ï¼š** `app/utils/calculator.py`

**RICE è¯„åˆ†ï¼š**
```python
RICE = (Reach Ã— Impact Ã— Confidence) / Effort

ç¤ºä¾‹ï¼š
Reach = 1000ï¼ˆå½±å“1000ä¸ªç”¨æˆ·ï¼‰
Impact = 3ï¼ˆå·¨å¤§å½±å“ï¼‰
Confidence = 80%ï¼ˆ0.8ï¼‰
Effort = 5ï¼ˆ5ä¸ªæœˆï¼‰

RICE = (1000 Ã— 3 Ã— 0.8) / 5 = 480
```

**é£é™©è¯„åˆ†ï¼š**
```python
def calculate_risk_score(requirement):
    risk_score = 0

    # 1. æŠ€æœ¯å¤æ‚åº¦é£é™©ï¼ˆ0-15ï¼‰
    risk_score += complexity * 3

    # 2. å·¥æœŸé£é™©ï¼ˆ0-20ï¼‰
    if estimated_hours > 100:
        risk_score += 20

    # 3. æè¿°ä¸æ¸…é£é™©ï¼ˆ0-20ï¼‰
    if len(description) < 50:
        risk_score += 20

    # 4. ç”¨æˆ·æ•…äº‹ä¸å®Œæ•´ï¼ˆ0-15ï¼‰
    if not all([role, action, benefit]):
        risk_score += 15

    return risk_score  # 0-100
```

### 3.6 å¤šç§Ÿæˆ·æ¶æ„

#### 3.6.1 ç§Ÿæˆ·éš”ç¦»å®ç°

**1. ä¸Šä¸‹æ–‡ç®¡ç†ï¼š**
```python
# app/core/tenant.py
from contextvars import ContextVar

tenant_context = ContextVar("tenant_context", default=None)

def set_tenant_context(tenant_id: int):
    """è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡"""
    tenant_context.set(tenant_id)

def get_current_tenant() -> int | None:
    """è·å–å½“å‰ç§Ÿæˆ·"""
    return tenant_context.get()
```

**2. ä¸­é—´ä»¶æ‹¦æˆªï¼š**
```python
@app.middleware("http")
async def tenant_middleware(request, call_next):
    """ä»è¯·æ±‚å¤´æå–ç§Ÿæˆ·ID"""
    tenant_id = None

    # ä» X-Tenant-ID å¤´æå–
    if "x-tenant-id" in request.headers:
        tenant_id = int(request.headers["x-tenant-id"])
        set_tenant_context(tenant_id)

    response = await call_next(request)
    return response
```

**3. æ•°æ®æ¨¡å‹æ··å…¥ï¼š**
```python
# app/db/mixins.py
class TenantMixin:
    """ç§Ÿæˆ·æ··å…¥ï¼šä¸ºæ¨¡å‹æ·»åŠ ç§Ÿæˆ·IDå­—æ®µ"""
    tenant_id: Mapped[int] = mapped_column(
        Integer, nullable=False, index=True
    )

# ä½¿ç”¨ç¤ºä¾‹
class Requirement(Base, TenantMixin):
    __tablename__ = "requirements"
    # è‡ªåŠ¨åŒ…å« tenant_id å­—æ®µ
```

**4. ä»“å‚¨è‡ªåŠ¨è¿‡æ»¤ï¼š**
```python
# app/repositories/base.py
class BaseRepository:
    def _get_query(self):
        """è·å–æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç§Ÿæˆ·è¿‡æ»¤ï¼‰"""
        query = select(self.model)

        # å¦‚æœæ¨¡å‹æœ‰ tenant_id å­—æ®µï¼Œè‡ªåŠ¨è¿‡æ»¤
        if hasattr(self.model, "tenant_id"):
            tenant_id = get_current_tenant()
            if tenant_id:
                query = query.where(self.model.tenant_id == tenant_id)

        return query

    async def get_all(self):
        """è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·æ•°æ®"""
        query = self._get_query()  # å·²åŒ…å«ç§Ÿæˆ·è¿‡æ»¤
        result = await self.db.execute(query)
        return result.scalars().all()
```

**æ•°æ®éš”ç¦»æ•ˆæœï¼š**
```python
# ç§Ÿæˆ·1çš„ç”¨æˆ·åªèƒ½çœ‹åˆ°ç§Ÿæˆ·1çš„æ•°æ®
tenant_id = 1
set_tenant_context(tenant_id)
requirements = await repo.get_all()
# SQL: SELECT * FROM requirements WHERE tenant_id = 1

# ç§Ÿæˆ·2çš„ç”¨æˆ·åªèƒ½çœ‹åˆ°ç§Ÿæˆ·2çš„æ•°æ®
tenant_id = 2
set_tenant_context(tenant_id)
requirements = await repo.get_all()
# SQL: SELECT * FROM requirements WHERE tenant_id = 2
```

### 3.7 å®‰å…¨æœºåˆ¶

#### 3.7.1 è®¤è¯æµç¨‹

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. éªŒè¯ç”¨æˆ·åå¯†ç 
   â†“
3. ç”Ÿæˆ JWT Token
   {
     "sub": user_id,
     "exp": expire_time,
     "role": user_role
   }
   â†“
4. è¿”å› Token ç»™å®¢æˆ·ç«¯
   â†“
5. å®¢æˆ·ç«¯åç»­è¯·æ±‚æºå¸¦ Token
   Authorization: Bearer <token>
   â†“
6. åç«¯éªŒè¯ Token
   - è§£æ Token
   - æ£€æŸ¥è¿‡æœŸæ—¶é—´
   - è·å–ç”¨æˆ·ä¿¡æ¯
   â†“
7. å…è®¸/æ‹’ç»è®¿é—®
```

**Token ç¤ºä¾‹ï¼š**
```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "role": "product_manager",
  "exp": 1737886800,
  "iat": 1737282000
}
```

#### 3.7.2 å¯†ç å“ˆå¸Œ

**å½“å‰å®ç°ï¼ˆSHA256ï¼‰ï¼š**
```python
import hashlib

def get_password_hash(password: str) -> str:
    return hashlib.sha256(password.encode()).hexdigest()

def verify_password(plain_password: str, hashed_password: str) -> bool:
    hashed_plain = hashlib.sha256(plain_password.encode()).hexdigest()
    return hashed_plain == hashed_password
```

**âš ï¸ å»ºè®®ï¼šæ”¹ç”¨ BCrypt**
```python
from passlib.context import CryptContext

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)
```

#### 3.7.3 æƒé™æ§åˆ¶

**åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ï¼š**

```python
# è§’è‰²å®šä¹‰
ROLES = {
    "admin": ["*"],  # æ‰€æœ‰æƒé™
    "product_manager": [
        "requirement:create",
        "requirement:read",
        "requirement:update",
        "requirement:delete",
        "analysis:*"
    ],
    "marketing_manager": [
        "requirement:read",
        "analysis:read"
    ],
    "sales_manager": [
        "requirement:create",
        "requirement:read"
    ]
}

# æƒé™æ£€æŸ¥è£…é¥°å™¨
def require_permission(permission: str):
    def decorator(func):
        async def wrapper(*args, current_user, **kwargs):
            if not has_permission(current_user, permission):
                raise ForbiddenException("æƒé™ä¸è¶³")
            return await func(*args, current_user=current_user, **kwargs)
        return wrapper
    return decorator
```

### 3.8 æ•°æ®åº“è¿ç§»

**ä½¿ç”¨ Alembic è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼š**

```bash
# åˆ›å»ºæ–°è¿ç§»
alembic revision --autogenerate -m "æ·»åŠ æ–°å­—æ®µ"

# åº”ç”¨è¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1

# æŸ¥çœ‹è¿ç§»å†å²
alembic history

# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
alembic current
```

**è¿ç§»æ–‡ä»¶ç¤ºä¾‹ï¼š**
```python
# alembic/versions/001_initial_migration.py
from alembic import op
import sqlalchemy as sa

def upgrade():
    op.create_table(
        'requirements',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('requirement_no', sa.String(length=50), nullable=False),
        sa.Column('title', sa.String(length=200), nullable=False),
        sa.Column('status', sa.String(length=50), nullable=True),
        sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_requirements_id', 'requirements', ['id'])
    op.create_index('ix_requirements_requirement_no', 'requirements', ['requirement_no'])

def downgrade():
    op.drop_index('ix_requirements_requirement_no', table_name='requirements')
    op.drop_index('ix_requirements_id', table_name='requirements')
    op.drop_table('requirements')
```

---

## 4. å‰ç«¯è¯¦ç»†åˆ†æ

### 4.1 é¡¹ç›®ç»“æ„

```
/Users/kingsun/claude_study/frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                # React åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.tsx                 # æ ¹ç»„ä»¶ï¼ˆè·¯ç”±é…ç½®ï¼Œ1720è¡Œâš ï¸ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ auth/              #   - ç™»å½•/æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ dashboard/         #   - ä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ requirements/      #   - éœ€æ±‚ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ RequirementListPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RequirementDetailPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RequirementCreatePage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RequirementEditPage.tsx
â”‚   â”‚   â”œâ”€â”€ analysis/          #   - éœ€æ±‚åˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ AppealsAnalysisPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalyticsDashboard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ KanoClassificationPage.tsx
â”‚   â”‚   â”œâ”€â”€ distribution/      #   - éœ€æ±‚åˆ†å‘
â”‚   â”‚   â”œâ”€â”€ rtm/               #   - éœ€æ±‚è¿½æº¯
â”‚   â”‚   â””â”€â”€ verifications/     #   - éœ€æ±‚éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ analysis/         #   - åˆ†æç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ INVESTScore.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MoSCoWPrioritizer.tsx
â”‚   â”‚   â”‚   â””â”€â”€ RICEScore.tsx
â”‚   â”‚   â”œâ”€â”€ verifications/    #   - éªŒè¯ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ChecklistForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ChecklistItem.tsx
â”‚   â”‚   â”œâ”€â”€ layout/           #   - å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”‚   â””â”€â”€ common/           #   - é€šç”¨ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/               # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useAuthStore.ts
â”‚   â”‚   â”œâ”€â”€ useRequirementStore.ts
â”‚   â”‚   â”œâ”€â”€ useAnalysisStore.ts
â”‚   â”‚   â”œâ”€â”€ useNotificationStore.ts
â”‚   â”‚   â””â”€â”€ useVerificationStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/             # API æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api.ts           #   - Axios é…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ requirement.service.ts
â”‚   â”‚   â”œâ”€â”€ analysis.service.ts
â”‚   â”‚   â”œâ”€â”€ verification.service.ts
â”‚   â”‚   â”œâ”€â”€ rtm.service.ts
â”‚   â”‚   â””â”€â”€ importExport.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/               # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ global.css
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰ Hooksï¼ˆâš ï¸ ç©ºç›®å½•ï¼‰
â”‚   â”œâ”€â”€ types/               # TypeScript ç±»å‹ï¼ˆâš ï¸ ç©ºç›®å½•ï¼‰
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°ï¼ˆâš ï¸ ç©ºç›®å½•ï¼‰
â”‚
â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”œâ”€â”€ index.html               # HTML å…¥å£
â”œâ”€â”€ package.json             # é¡¹ç›®é…ç½®
â”œâ”€â”€ vite.config.ts           # Vite é…ç½®
â”œâ”€â”€ tsconfig.json            # TypeScript é…ç½®
â”œâ”€â”€ Dockerfile               # Docker é…ç½®
â””â”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

**ä»£ç ç»Ÿè®¡ï¼š**
- TypeScript/TSX æ–‡ä»¶ï¼š87 ä¸ª
- ä¸»è¦ä»£ç é›†ä¸­åœ¨å‰ç«¯ `pages/` å’Œ `services/`
- **âš ï¸ App.tsx è¿‡å¤§ï¼ˆ1720è¡Œï¼‰ï¼Œéœ€è¦æ‹†åˆ†**

### 4.2 æ ¸å¿ƒæŠ€æœ¯æ ˆ

#### 4.2.1 æ¡†æ¶å’Œæ„å»ºå·¥å…·

**React 18.2.0ï¼š**
- æœ€æµè¡Œçš„å‰ç«¯æ¡†æ¶
- Hooks API
- å¹¶å‘æ¸²æŸ“
- è‡ªåŠ¨æ‰¹å¤„ç†

**TypeScript 5.3.3ï¼š**
- ç±»å‹å®‰å…¨
- æ›´å¥½çš„ IDE æ”¯æŒ
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

**Vite 5.0.8ï¼š**
- å¿«é€Ÿçš„å¼€å‘æœåŠ¡å™¨
- å³æ—¶çƒ­æ›´æ–°
- ä¼˜åŒ–çš„ç”Ÿäº§æ„å»º

**å¯¹æ¯”ä¼ ç»Ÿå·¥å…·ï¼š**
```
Vite vs Webpack
- å¯åŠ¨é€Ÿåº¦ï¼šVite æ¯«ç§’çº§ vs Webpack ç§’çº§
- çƒ­æ›´æ–°ï¼šVite å³æ—¶ vs Webpack å‡ ç§’
- æ„å»ºé€Ÿåº¦ï¼šVite å¿« 10-100 å€
```

#### 4.2.2 UI ç»„ä»¶åº“ - Ant Design 5.x

**ä¸ºä»€ä¹ˆé€‰æ‹© Ant Designï¼Ÿ**
- âœ… ä¼ä¸šçº§ UI è®¾è®¡è¯­è¨€
- âœ… ä¸°å¯Œçš„ç»„ä»¶åº“ï¼ˆ60+ ç»„ä»¶ï¼‰
- âœ… TypeScript æ”¯æŒ
- âœ… ä¸»é¢˜å®šåˆ¶
- âœ… å›½é™…åŒ–æ”¯æŒ
- âœ… è¡¨æ ¼ã€è¡¨å•ã€å›¾è¡¨ç­‰ä¸šåŠ¡ç»„ä»¶å®Œå–„

**å¸¸ç”¨ç»„ä»¶ï¼š**
```typescript
import {
  Button,      // æŒ‰é’®
  Table,       // è¡¨æ ¼
  Form,        // è¡¨å•
  Input,       // è¾“å…¥æ¡†
  Modal,       // æ¨¡æ€æ¡†
  Card,        // å¡ç‰‡
  Select,      // ä¸‹æ‹‰é€‰æ‹©
  DatePicker,  // æ—¥æœŸé€‰æ‹©
  Upload,      // ä¸Šä¼ 
  message,     // æ¶ˆæ¯æç¤º
  notification // é€šçŸ¥
} from 'antd'
```

#### 4.2.3 çŠ¶æ€ç®¡ç† - Zustand 4.4.7

**ä¸ºä»€ä¹ˆé€‰æ‹© Zustandï¼Ÿ**
- âœ… è½»é‡çº§ï¼ˆ1KBï¼‰
- âœ… ç®€å•æ˜“ç”¨
- âœ… æ— éœ€ Provider åŒ…è£¹
- âœ… æ”¯æŒ TypeScript
- âœ… æ”¯æŒæŒä¹…åŒ–
- âœ… æ”¯æŒ DevTools

**å¯¹æ¯” Reduxï¼š**
```
Zustand vs Redux
- ä»£ç é‡ï¼šZustand å°‘ 90%
- Boilerplateï¼šZustand å‡ ä¹æ²¡æœ‰
- å­¦ä¹ æ›²çº¿ï¼šZustand å¹³ç¼“
- æ€§èƒ½ï¼šZustand æ›´å¥½ï¼ˆè‡ªåŠ¨ä¼˜åŒ–ï¼‰
```

**Store ç¤ºä¾‹ï¼š**
```typescript
// stores/useRequirementStore.ts
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface RequirementStore {
  requirements: Requirement[]
  isLoading: boolean

  fetchRequirements: () => Promise<void>
  createRequirement: (data: CreateRequirementRequest) => Promise<void>
}

export const useRequirementStore = create<RequirementStore>()(
  persist(
    (set, get) => ({
      requirements: [],
      isLoading: false,

      fetchRequirements: async () => {
        set({ isLoading: true })
        const data = await requirementService.getRequirements()
        set({ requirements: data, isLoading: false })
      },

      createRequirement: async (data) => {
        await requirementService.createRequirement(data)
        get().fetchRequirements()  // åˆ·æ–°åˆ—è¡¨
      }
    }),
    {
      name: 'requirement-storage',
      partialize: (state) => ({ requirements: state.requirements })
    }
  )
)
```

**ä½¿ç”¨æ–¹å¼ï¼š**
```typescript
function RequirementList() {
  const { requirements, isLoading, fetchRequirements } = useRequirementStore()

  useEffect(() => {
    fetchRequirements()
  }, [])

  if (isLoading) return <Spin />

  return (
    <Table dataSource={requirements} />
  )
}
```

#### 4.2.4 è·¯ç”± - React Router v6.20.1

**è·¯ç”±é…ç½®ï¼š**
```typescript
// App.tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom'

<BrowserRouter>
  <Routes>
    {/* å…¬å¼€è·¯ç”± */}
    <Route path="/login" element={<LoginPage />} />

    {/* å—ä¿æŠ¤è·¯ç”± */}
    <Route path="/" element={
      <ProtectedRoute>
        <MainLayout />
      </ProtectedRoute>
    }>
      <Route index element={<Navigate to="/dashboard" />} />
      <Route path="dashboard" element={<DashboardPage />} />
      <Route path="requirements" element={<RequirementsPage />} />
      <Route path="analytics" element={<AnalyticsPage />} />
    </Route>
  </Routes>
</BrowserRouter>
```

**è·¯ç”±å®ˆå«ï¼š**
```typescript
function ProtectedRoute({ children }) {
  const token = localStorage.getItem('access_token')
  const location = useLocation()

  if (!token) {
    return <Navigate to="/login" state={{ from: location }} replace />
  }

  return children
}
```

#### 4.2.5 HTTP å®¢æˆ·ç«¯ - Axios 1.6.2

**Axios å®ä¾‹é…ç½®ï¼š**
```typescript
// services/api.ts
import axios from 'axios'

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || '/api/v1',
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨ï¼šæ·»åŠ  Token
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token')
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    // æ·»åŠ ç§Ÿæˆ· ID
    config.headers['X-Tenant-ID'] = '1'
    return config
  }
)

// å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†
api.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      // Token è¿‡æœŸï¼Œè·³è½¬ç™»å½•
      localStorage.removeItem('access_token')
      window.location.href = '/login'
    }
    return Promise.reject(error.response?.data || error.message)
  }
)

export default api
```

**æœåŠ¡å±‚å°è£…ï¼š**
```typescript
// services/requirement.service.ts
import api from './api'

export const requirementService = {
  // è·å–éœ€æ±‚åˆ—è¡¨
  getRequirements: (params?) => {
    return api.get('/requirements', { params })
  },

  // è·å–éœ€æ±‚è¯¦æƒ…
  getRequirement: (id: number) => {
    return api.get(`/requirements/${id}`)
  },

  // åˆ›å»ºéœ€æ±‚
  createRequirement: (data: CreateRequirementRequest) => {
    return api.post('/requirements', data)
  },

  // æ›´æ–°éœ€æ±‚
  updateRequirement: (id: number, data: Partial<Requirement>) => {
    return api.put(`/requirements/${id}`, data)
  },

  // åˆ é™¤éœ€æ±‚
  deleteRequirement: (id: number) => {
    return api.delete(`/requirements/${id}`)
  }
}
```

#### 4.2.6 å›¾è¡¨åº“ - Recharts 2.10.3

**é›·è¾¾å›¾ç¤ºä¾‹ï¼ˆAPPEALS åˆ†æï¼‰ï¼š**
```typescript
import { RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar } from 'recharts'

<ResponsiveContainer width="100%" height={300}>
  <RadarChart data={appealsData}>
    <PolarGrid />
    <PolarAngleAxis dataKey="dimension" />
    <PolarRadiusAxis angle={90} domain={[0, 10]} />
    <Radar
      name="è¯„åˆ†"
      dataKey="score"
      stroke="#1890ff"
      fill="#1890ff"
      fillOpacity={0.6}
    />
  </RadarChart>
</ResponsiveContainer>
```

### 4.3 æ ¸å¿ƒé¡µé¢è¯¦è§£

#### 4.3.1 ç™»å½•é¡µé¢

**è·¯å¾„ï¼š** `App.tsx` å†…åµŒ

**åŠŸèƒ½ï¼š**
- ç”¨æˆ·å/å¯†ç ç™»å½•
- æ¸å˜èƒŒæ™¯
- è®°ä½ Token åˆ° localStorage
- ç™»å½•æˆåŠŸè·³è½¬ä»ªè¡¨ç›˜

**å…³é”®ä»£ç ï¼š**
```typescript
function LoginPage() {
  const [form] = Form.useForm()
  const { login } = useAuthStore()

  const onFinish = async (values) => {
    try {
      await login(values.username, values.password)
      message.success('ç™»å½•æˆåŠŸ')
      navigate('/dashboard')
    } catch (error) {
      message.error(error.message || 'ç™»å½•å¤±è´¥')
    }
  }

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
    }}>
      <Card title="IPD éœ€æ±‚ç®¡ç†ç³»ç»Ÿ" style={{ width: 400 }}>
        <Form form={form} onFinish={onFinish}>
          <Form.Item name="username" rules={[{ required: true }]}>
            <Input prefix={<UserOutlined />} placeholder="ç”¨æˆ·å" />
          </Form.Item>
          <Form.Item name="password" rules={[{ required: true }]}>
            <Input.Password prefix={<LockOutlined />} placeholder="å¯†ç " />
          </Form.Item>
          <Button type="primary" htmlType="submit" block>
            ç™»å½•
          </Button>
        </Form>
      </Card>
    </div>
  )
}
```

#### 4.3.2 ä»ªè¡¨ç›˜é¡µé¢

**è·¯å¾„ï¼š** `pages/dashboard/DashboardPage.tsx`

**åŠŸèƒ½ï¼š**
- ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»æ•°ã€å·²å®Œæˆã€è¿›è¡Œä¸­ã€å¾…å¤„ç†ï¼‰
- æœ€æ–°éœ€æ±‚åˆ—è¡¨
- ä½¿ç”¨ Ant Design Statistic ç»„ä»¶

**ä»£ç ç¤ºä¾‹ï¼š**
```typescript
function DashboardPage() {
  const { stats, recentRequirements } = useDashboardStore()

  return (
    <div>
      <Row gutter={16}>
        <Col span={6}>
          <Card>
            <Statistic
              title="æ€»éœ€æ±‚æ•°"
              value={stats.total}
              prefix={<FileTextOutlined />}
              valueStyle={{ color: '#1890ff' }}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="å·²å®Œæˆ"
              value={stats.completed}
              prefix={<CheckCircleOutlined />}
              valueStyle={{ color: '#52c41a' }}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="è¿›è¡Œä¸­"
              value={stats.inProgress}
              prefix={<ClockCircleOutlined />}
              valueStyle={{ color: '#faad14' }}
            />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic
              title="å¾…å¤„ç†"
              value={stats.pending}
              prefix={<ExclamationCircleOutlined />}
              valueStyle={{ color: '#f5222d' }}
            />
          </Card>
        </Col>
      </Row>

      <Card title="æœ€æ–°éœ€æ±‚" style={{ marginTop: 16 }}>
        <Table dataSource={recentRequirements} />
      </Card>
    </div>
  )
}
```

#### 4.3.3 éœ€æ±‚åˆ—è¡¨é¡µé¢

**è·¯å¾„ï¼š** `pages/requirements/RequirementListPage.tsx`

**åŠŸèƒ½ï¼š**
- éœ€æ±‚åˆ—è¡¨å±•ç¤º
- æœç´¢ï¼ˆæ ‡é¢˜ã€ç¼–å·ï¼‰
- ç­›é€‰ï¼ˆçŠ¶æ€ã€æ¥æºã€ä¼˜å…ˆçº§ï¼‰
- æ’åº
- åˆ†é¡µ
- æ“ä½œï¼ˆæŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ã€åˆ†å‘ï¼‰

**è¡¨æ ¼åˆ—ï¼š**
```typescript
const columns = [
  { title: 'ç¼–å·', dataIndex: 'requirement_no', key: 'no' },
  { title: 'æ ‡é¢˜', dataIndex: 'title', key: 'title' },
  { title: 'æ¥æº', dataIndex: 'source_channel', key: 'source' },
  { title: 'ä¼˜å…ˆçº§', dataIndex: 'priority_score', key: 'priority' },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    key: 'status',
    render: (status) => <Tag color={getStatusColor(status)}>{status}</Tag>
  },
  { title: 'MoSCoW', dataIndex: 'moscow_priority', key: 'moscow' },
  { title: 'åˆ›å»ºæ—¶é—´', dataIndex: 'created_at', key: 'created_at' },
  {
    title: 'æ“ä½œ',
    key: 'actions',
    render: (_, record) => (
      <Space>
        <Button size="small" onClick={() => viewDetail(record.id)}>æŸ¥çœ‹</Button>
        <Button size="small" onClick={() => editRequirement(record.id)}>ç¼–è¾‘</Button>
        <Button size="small" danger onClick={() => deleteRequirement(record.id)}>åˆ é™¤</Button>
      </Space>
    )
  }
]
```

#### 4.3.4 éœ€æ±‚ç¼–è¾‘é¡µé¢

**è·¯å¾„ï¼š** `App.tsx` å†…åµŒ

**è¡¨å•å­—æ®µï¼š**
```typescript
// åŸºç¡€ä¿¡æ¯
- title: æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰
- description: æè¿°
- source_channel: æ¥æºï¼ˆcustomer/market/competition/sales/after_sales/rdï¼‰
- source_contact: è”ç³»äºº
- priority: ä¼˜å…ˆçº§ï¼ˆé«˜/ä¸­/ä½ï¼š90/60/30ï¼‰
- status: çŠ¶æ€

// MoSCoW ä¼˜å…ˆçº§
- moscow_priority: Must/Should/Could/Won't

// éœ€æ±‚æè¿°
- description: è¯¦ç»†æè¿°ï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰

// å®¢æˆ·éœ€æ±‚åé—®ï¼ˆå¯å±•å¼€ï¼‰
âœ¨ è°å…³æ³¨è¿™ä¸ªéœ€æ±‚
âœ¨ ä¸ºä»€ä¹ˆå…³æ³¨
âœ¨ ä½¿ç”¨é¢‘ç‡
âœ¨ ç°æœ‰è§£å†³æ–¹æ¡ˆ
âœ¨ ç—›ç‚¹é—®é¢˜
âœ¨ æœŸæœ›ç»“æœ
âœ¨ ä»·å€¼å’Œå½±å“
âœ¨ ç´§æ€¥ç¨‹åº¦
âœ¨ é¢„ç®—æ„æ„¿
âœ¨ æ›¿ä»£æ–¹æ¡ˆ
âœ¨ è¡¥å……è¯´æ˜

// ä¼°ç®—
- estimated_duration_months: é¢„ä¼°å·¥æœŸï¼ˆæœˆï¼‰
- complexity_level: å¤æ‚åº¦ï¼ˆlow/medium/high/very_highï¼‰
```

**åé—®è¡¨å•ç¤ºä¾‹ï¼š**
```typescript
<Form.Item label="è°å…³æ³¨è¿™ä¸ªéœ€æ±‚">
  <Input.TextArea
    placeholder="å“ªäº›ç”¨æˆ·æˆ–è§’è‰²å…³æ³¨è¿™ä¸ªéœ€æ±‚ï¼Ÿ"
    value={tenQ.q1_who_cares}
    onChange={(e) => setTenQ({ ...tenQ, q1_who_cares: e.target.value })}
    rows={2}
  />
</Form.Item>

<Form.Item label="ä¸ºä»€ä¹ˆå…³æ³¨">
  <Input.TextArea
    placeholder="ä¸ºä»€ä¹ˆä»–ä»¬å…³æ³¨è¿™ä¸ªéœ€æ±‚ï¼Ÿ"
    value={tenQ.q2_why_care}
    onChange={(e) => setTenQ({ ...tenQ, q2_why_care: e.target.value })}
    rows={2}
  />
</Form.Item>

// ... å…¶ä»–8ä¸ªé—®é¢˜
```

#### 4.3.5 APPEALS åˆ†æé¡µé¢

**è·¯å¾„ï¼š** `App.tsx` å†…åµŒ `AnalyticsPage`

**APPEALS 8 ç»´åº¦ï¼š**
```
1. Priceï¼ˆä»·æ ¼ï¼‰
2. Availabilityï¼ˆå¯è·å¾—æ€§ï¼‰
3. Packagingï¼ˆåŒ…è£…/å¤–è§‚ï¼‰
4. Performanceï¼ˆæ€§èƒ½ï¼‰
5. Ease of Useï¼ˆæ˜“ç”¨æ€§ï¼‰
6. Assuranceï¼ˆä¿è¯/å¯é æ€§ï¼‰
7. Lifecycle Costï¼ˆç”Ÿå‘½å‘¨æœŸæˆæœ¬ï¼‰
8. Social Acceptanceï¼ˆç¤¾ä¼šæ¥å—åº¦ï¼‰
```

**æ¯ä¸ªç»´åº¦åŒ…å«ï¼š**
- è¯„åˆ†æ»‘å—ï¼ˆ1-10ï¼‰
- æƒé‡è®¾ç½®ï¼ˆè‡ªåŠ¨å½’ä¸€åŒ–ï¼Œæ€»å’Œä¸º1ï¼‰
- è¯„åˆ†è¯´æ˜

**é›·è¾¾å›¾å¯è§†åŒ–ï¼š**
```typescript
<ResponsiveContainer width="100%" height={400}>
  <RadarChart data={getRadarChartData()}>
    <PolarGrid />
    <PolarAngleAxis dataKey="dimension" />
    <PolarRadiusAxis angle={90} domain={[0, 10]} />
    <Radar
      name="è¯„åˆ†"
      dataKey="score"
      stroke="#1890ff"
      fill="#1890ff"
      fillOpacity={0.6}
    />
  </RadarChart>
</ResponsiveContainer>

<Card title={`æ€»åŠ æƒåˆ†: ${totalWeightedScore.toFixed(2)}`}>
  <Progress
    type="circle"
    percent={totalWeightedScore}
    format={(percent) => `${percent?.toFixed(1)}`}
  />
</Card>
```

**è¯„åˆ†è®¡ç®—ï¼š**
```typescript
// 1. å½’ä¸€åŒ–æƒé‡
const totalWeight = appealsData.reduce((sum, item) => sum + item.weight, 0)
const normalizedData = appealsData.map(item => ({
  ...item,
  normalizedWeight: item.weight / totalWeight
}))

// 2. è®¡ç®—åŠ æƒåˆ†
const totalWeightedScore = normalizedData.reduce(
  (sum, item) => sum + (item.score * item.normalizedWeight * 10),
  0
)
```

#### 4.3.6 éœ€æ±‚åˆ†å‘é¡µé¢

**è·¯å¾„ï¼š** `App.tsx` å†…åµŒ `DistributionPage`

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºå¾…åˆ†å‘éœ€æ±‚ï¼ˆçŠ¶æ€ä¸º"å·²åˆ†æ"ï¼‰
- é€‰æ‹©åˆ†å‘ç›®æ ‡ç±»å‹
- è‡ªåŠ¨ç”Ÿæˆç›®æ ‡ID
- æ”¯æŒæ‰¹é‡åˆ†å‘
- æ˜¾ç¤ºå·²åˆ†å‘éœ€æ±‚

**åˆ†å‘ç›®æ ‡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›®æ ‡ç±»å‹     â”‚ ä»£ç æ ¼å¼          â”‚ å…³è”å…³ç³»      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SPï¼ˆæˆ˜ç•¥è§„åˆ’ï¼‰â”‚ SP-001           â”‚ æ—             â”‚
â”‚ BPï¼ˆå•†ä¸šè®¡åˆ’ï¼‰â”‚ BP-2026-Q1-001   â”‚ â†’ SP          â”‚
â”‚ Charter     â”‚ CH-001           â”‚ â†’ BP          â”‚
â”‚ PCRï¼ˆå˜æ›´è¯·æ±‚ï¼‰â”‚ PCR-001         â”‚ â†’ Charter + Reqâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰¹é‡åˆ†å‘ç¤ºä¾‹ï¼š**
```typescript
function handleBatchDistribute() {
  const selectedRequirements = getSelectedRequirements()
  const targetType = getTargetType()

  selectedRequirements.forEach(req => {
    // 1. ç”Ÿæˆç›®æ ‡ID
    const targetId = generateTargetId(targetType)

    // 2. åˆ›å»ºç›®æ ‡å¯¹è±¡
    if (targetType === 'sp') {
      createStrategicPlan({
        sp_code: targetId,
        title: req.title,
        requirements: [req.id]
      })
    } else if (targetType === 'bp') {
      createBusinessPlan({
        bp_code: targetId,
        sp_id: selectedSP,
        requirements: [req.id]
      })
    }
    // ...
  })

  message.success(`æˆåŠŸåˆ†å‘ ${selectedRequirements.length} ä¸ªéœ€æ±‚`)
}
```

#### 4.3.7 éœ€æ±‚éªŒè¯é¡µé¢

**è·¯å¾„ï¼š** `pages/verifications/VerificationPage.tsx`

**åŠŸèƒ½ï¼š**
- åˆ›å»ºéªŒè¯æ¸…å•
- é€‰æ‹©éªŒè¯ç±»å‹ï¼ˆFAT/SAT/UAT/åŸå‹/æµ‹è¯•ï¼‰
- æ·»åŠ æ£€æŸ¥é¡¹
- æ‰§è¡ŒéªŒè¯
- æäº¤éªŒè¯ç»“æœ
- ä¸Šä¼ è¯æ®é™„ä»¶

**éªŒè¯æ¸…å•è¡¨å•ï¼š**
```typescript
<Form>
  <Form.Item label="éªŒè¯ç±»å‹">
    <Select>
      <Option value="prototype">åŸå‹éªŒè¯</Option>
      <Option value="fat">å·¥å‚éªŒæ”¶æµ‹è¯•(FAT)</Option>
      <Option value="sat">ç°åœºéªŒæ”¶æµ‹è¯•(SAT)</Option>
      <Option value="uat">ç”¨æˆ·éªŒæ”¶æµ‹è¯•(UAT)</Option>
      <Option value="test">æµ‹è¯•éªŒè¯</Option>
    </Select>
  </Form.Item>

  <Form.Item label="æ£€æŸ¥é¡¹">
    <ChecklistForm
      items={checklistItems}
      onChange={setChecklistItems}
    />
  </Form.Item>

  <Form.Item label="è¯æ®é™„ä»¶">
    <Upload>
      <Button icon={<UploadOutlined />}>ä¸Šä¼ æ–‡ä»¶</Button>
    </Upload>
  </Form.Item>

  <Form.Item label="å®¢æˆ·åé¦ˆ">
    <Input.TextArea rows={4} />
  </Form.Item>

  <Form.Item label="éªŒè¯ç»“æœ">
    <Radio.Group>
      <Radio value="passed">é€šè¿‡</Radio>
      <Radio value="failed">å¤±è´¥</Radio>
      <Radio value="partial_passed">éƒ¨åˆ†é€šè¿‡</Radio>
    </Radio.Group>
  </Form.Item>
</Form>
```

### 4.4 çŠ¶æ€ç®¡ç†è¯¦è§£

#### 4.4.1 è®¤è¯çŠ¶æ€

**è·¯å¾„ï¼š** `stores/useAuthStore.ts`

```typescript
interface AuthState {
  user: User | null
  token: string | null
  isAuthenticated: boolean
  isLoading: boolean

  // Actions
  login: (username: string, password: string) => Promise<void>
  logout: () => void
  fetchCurrentUser: () => Promise<void>
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      isLoading: false,

      login: async (username, password) => {
        set({ isLoading: true })
        const response = await authService.login({ username, password })
        set({
          user: response.user,
          token: response.access_token,
          isAuthenticated: true,
          isLoading: false
        })
      },

      logout: () => {
        set({
          user: null,
          token: null,
          isAuthenticated: false
        })
        localStorage.removeItem('access_token')
      }
    }),
    {
      name: 'auth-storage',
      partialize: (state) => ({
        token: state.token,
        user: state.user
      })
    }
  )
)
```

#### 4.4.2 éœ€æ±‚çŠ¶æ€

**è·¯å¾„ï¼š** `stores/useRequirementStore.ts`

```typescript
interface RequirementState {
  requirements: Requirement[]
  selectedRequirement: Requirement | null
  filters: RequirementFilters
  pagination: PaginationState
  isLoading: boolean
  error: string | null

  fetchRequirements: (filters?: RequirementFilters) => Promise<void>
  createRequirement: (data: CreateRequirementRequest) => Promise<void>
  updateRequirement: (id: number, data: Partial<Requirement>) => Promise<void>
  deleteRequirement: (id: number) => Promise<void>
  setFilters: (filters: Partial<RequirementFilters>) => void
}
```

#### 4.4.3 åˆ†æçŠ¶æ€

**è·¯å¾„ï¼š** `stores/useAnalysisStore.ts`

```typescript
interface AnalysisState {
  analysisData: Map<number, AnalysisData>
  analysisResults: Map<number, AnalysisResult>
  currentRequirementAnalysis: AnalysisResult | null
  isLoading: boolean

  fetchAnalysis: (requirementId: number) => Promise<void>
  saveAnalysis: (requirementId: number, data: AnalysisData) => Promise<void>
  setCurrentAnalysis: (analysis: AnalysisResult | null) => void
}
```

### 4.5 æ„å»ºå’Œéƒ¨ç½²

#### 4.5.1 Vite é…ç½®

**è·¯å¾„ï¼š** `vite.config.ts`

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],

  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },

  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      }
    }
  }
})
```

**å¼€å‘æœåŠ¡å™¨ï¼š**
```bash
npm run dev
# å¯åŠ¨åœ¨ http://localhost:5173
# API ä»£ç†åˆ° http://localhost:8000
```

#### 4.5.2 ç”Ÿäº§æ„å»º

**æ„å»ºå‘½ä»¤ï¼š**
```bash
# 1. ç±»å‹æ£€æŸ¥
npm run build  # tsc && vite build

# 2. è¾“å‡ºåˆ° dist/
# dist/
# â”œâ”€â”€ index.html
# â”œâ”€â”€ assets/
# â”‚   â”œâ”€â”€ index-[hash].js
# â”‚   â””â”€â”€ index-[hash].css
# â””â”€â”€ ...

# 3. é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

**ç¯å¢ƒå˜é‡ï¼š**
```bash
# .env.production
VITE_API_URL=https://api.example.com/api/v1
```

#### 4.5.3 Docker é…ç½®

**è·¯å¾„ï¼š** `Dockerfile`

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package.json package-lock.json* ./
RUN npm ci

COPY . .

EXPOSE 5173

CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
```

**æ„å»ºå’Œè¿è¡Œï¼š**
```bash
# æ„å»ºé•œåƒ
docker build -t ipd-frontend .

# è¿è¡Œå®¹å™¨
docker run -p 5173:5173 ipd-frontend
```

### 4.6 æ ·å¼æ–¹æ¡ˆ

#### 4.6.1 å…¨å±€æ ·å¼

**è·¯å¾„ï¼š** `styles/global.css`

```css
:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
  background-color: #f0f2f5;
  color: rgba(0, 0, 0, 0.88);
}

#root {
  width: 100%;
}
```

#### 4.6.2 Ant Design ä¸»é¢˜å®šåˆ¶

```typescript
// main.tsx
import { ConfigProvider } from 'antd'
import zhCN from 'antd/locale/zh_CN'

<ConfigProvider
  locale={zhCN}
  theme={{
    token: {
      colorPrimary: '#1890ff',
      borderRadius: 6,
    }
  }}
>
  <App />
</ConfigProvider>
```

#### 4.6.3 å†…è”æ ·å¼ï¼ˆé¡¹ç›®ç°çŠ¶ï¼‰

**âš ï¸ é—®é¢˜ï¼šå¤§é‡ä½¿ç”¨å†…è”æ ·å¼**

```typescript
// ä¸æ¨è
<div style={{
  display: 'flex',
  justifyContent: 'center',
  alignItems: 'center',
  minHeight: '100vh',
  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
}}>
  ...
</div>
```

**âœ… å»ºè®®ï¼šä½¿ç”¨ CSS Modules**

```css
/* LoginPage.module.css */
.container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
```

```typescript
// LoginPage.tsx
import styles from './LoginPage.module.css'

<div className={styles.container}>
  ...
</div>
```

---

## 5. æ•°æ®åº“è®¾è®¡

### 5.1 ER å›¾ï¼ˆå®ä½“å…³ç³»å›¾ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   tenants   â”‚1       *â”‚    users    â”‚
â”‚  (ç§Ÿæˆ·è¡¨)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (ç”¨æˆ·è¡¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚
       â”‚                      â”‚
       â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚requirements â”‚*       *â”‚  workflow   â”‚
â”‚  (éœ€æ±‚è¡¨)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (å·¥ä½œæµ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                              â”‚
       â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚requirement_10qâ”‚              â”‚  appeals_   â”‚
â”‚   (åé—®è¡¨)    â”‚              â”‚  analysis   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åˆ†æç»“æœ (JSONB)              â”‚
â”‚  - kano_category                      â”‚
â”‚  - invest_analysis                    â”‚
â”‚  - rice_score                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     sp      â”‚1       *â”‚     bp      â”‚
â”‚ (æˆ˜ç•¥è§„åˆ’)  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ (å•†ä¸šè®¡åˆ’)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚1
                                â”‚*
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  charters   â”‚
                         â”‚ (é¡¹ç›®ç« ç¨‹)  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚1
                                â”‚*
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    pcr      â”‚
                         â”‚ (å˜æ›´è¯·æ±‚)  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     rtm     â”‚  â† éœ€æ±‚è¿½æº¯
â”‚ (è¿½æº¯çŸ©é˜µ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚verification â”‚  â† éªŒè¯ç®¡ç†
â”‚ (éªŒè¯è®°å½•)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒè¡¨ç»“æ„

#### 5.2.1 éœ€æ±‚è¡¨ï¼ˆrequirementsï¼‰

**SQL å®šä¹‰ï¼š**
```sql
CREATE TABLE requirements (
    id SERIAL PRIMARY KEY,
    requirement_no VARCHAR(50) UNIQUE NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,

    -- ç”¨æˆ·æ•…äº‹
    user_story_role VARCHAR(200),
    user_story_action TEXT,
    user_story_benefit TEXT,

    -- æ”¶é›†ä¿¡æ¯
    source_channel VARCHAR(50) NOT NULL,
    source_contact VARCHAR(200),
    collector_id INTEGER REFERENCES users(id),

    -- ä¼˜å…ˆçº§
    priority_score DECIMAL(5,2) DEFAULT 0,
    priority_rank INTEGER,
    moscow_priority VARCHAR(20),
    moscow_comment TEXT,

    -- çŠ¶æ€
    status VARCHAR(50) DEFAULT 'collected',

    -- åˆ†æç»“æœï¼ˆJSONBï¼‰
    kano_category VARCHAR(20),
    appeals_scores JSONB,
    invest_analysis JSONB,
    rice_score JSONB,

    -- åˆ†å‘
    target_type VARCHAR(20),
    target_id INTEGER,

    -- ä¼°ç®—
    estimated_duration_months INTEGER,
    complexity_level VARCHAR(20),

    -- å…ƒæ•°æ®
    version INTEGER DEFAULT 1,
    created_by INTEGER REFERENCES users(id),
    updated_by INTEGER REFERENCES users(id),
    tenant_id INTEGER NOT NULL REFERENCES tenants(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_requirements_no ON requirements(requirement_no);
CREATE INDEX idx_requirements_status ON requirements(status);
CREATE INDEX idx_requirements_tenant ON requirements(tenant_id);
CREATE INDEX idx_requirements_moscow ON requirements(moscow_priority);
```

**JSONB å­—æ®µç¤ºä¾‹ï¼š**
```json
// appeals_scores
{
  "price": { "score": 8, "weight": 0.15, "comment": "ä»·æ ¼åˆç†" },
  "availability": { "score": 9, "weight": 0.10, "comment": "" },
  "performance": { "score": 7, "weight": 0.25, "comment": "æ€§èƒ½è‰¯å¥½" },
  ...
}

// invest_analysis
{
  "independent": true,
  "negotiable": true,
  "valuable": true,
  "estimable": true,
  "small": false,
  "testable": true
}
```

#### 5.2.2 å®¢æˆ·éœ€æ±‚åé—®è¡¨ï¼ˆrequirement_10_questionsï¼‰

```sql
CREATE TABLE requirement_10_questions (
    id SERIAL PRIMARY KEY,
    requirement_id INTEGER NOT NULL REFERENCES requirements(id) ON DELETE CASCADE,

    q1_who_cares TEXT,
    q2_why_care TEXT,
    q3_how_often TEXT,
    q4_current_solution TEXT,
    q5_pain_points TEXT,
    q6_expected_outcome TEXT,
    q7_value_impact TEXT,
    q8_urgency_level TEXT,
    q9_budget_willingness TEXT,
    q10_alternative_solutions TEXT,
    additional_notes TEXT,

    answered_by INTEGER REFERENCES users(id),
    tenant_id INTEGER NOT NULL REFERENCES tenants(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(requirement_id)
);
```

#### 5.2.3 APPEALS åˆ†æè¡¨ï¼ˆappeals_analysisï¼‰

```sql
CREATE TABLE appeals_analysis (
    id SERIAL PRIMARY KEY,
    requirement_id INTEGER NOT NULL REFERENCES requirements(id) ON DELETE CASCADE,

    -- 8ä¸ªç»´åº¦
    price_score INTEGER,
    price_weight DECIMAL(3,2),
    price_comment TEXT,

    availability_score INTEGER,
    availability_weight DECIMAL(3,2),
    availability_comment TEXT,

    packaging_score INTEGER,
    packaging_weight DECIMAL(3,2),
    packaging_comment TEXT,

    performance_score INTEGER,
    performance_weight DECIMAL(3,2),
    performance_comment TEXT,

    ease_of_use_score INTEGER,
    ease_of_use_weight DECIMAL(3,2),
    ease_of_use_comment TEXT,

    assurance_score INTEGER,
    assurance_weight DECIMAL(3,2),
    assurance_comment TEXT,

    lifecycle_cost_score INTEGER,
    lifecycle_cost_weight DECIMAL(3,2),
    lifecycle_cost_comment TEXT,

    social_acceptance_score INTEGER,
    social_acceptance_weight DECIMAL(3,2),
    social_acceptance_comment TEXT,

    -- æ€»åˆ†
    total_weighted_score DECIMAL(5,2),

    analyzed_at TIMESTAMP,
    analyzed_by INTEGER REFERENCES users(id),
    tenant_id INTEGER NOT NULL REFERENCES tenants(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(requirement_id)
);
```

### 5.3 æ•°æ®åº“æ“ä½œ

#### 5.3.1 åˆå§‹åŒ–æ•°æ®åº“

```bash
# 1. åˆ›å»ºæ•°æ®åº“
createdb ipd_req_db

# 2. è¿è¡Œè¿ç§»
cd backend
alembic upgrade head

# 3. åˆ›å»ºé»˜è®¤ç§Ÿæˆ·
python create_default_tenant.py

# 4. åˆå§‹åŒ–ç”¨æˆ·
python scripts/init_users.py
```

#### 5.3.2 å¤‡ä»½å’Œæ¢å¤

**å¤‡ä»½ï¼š**
```bash
# å¤‡ä»½æ•´ä¸ªæ•°æ®åº“
pg_dump ipd_req_db > backup_$(date +%Y%m%d).sql

# å¤‡ä»½ç‰¹å®šè¡¨
pg_dump -t requirements -t appeals_analysis ipd_req_db > backup_tables.sql
```

**æ¢å¤ï¼š**
```bash
# æ¢å¤æ•°æ®åº“
psql ipd_req_db < backup_20260118.sql

# æ¢å¤ç‰¹å®šè¡¨
psql ipd_req_db < backup_tables.sql
```

---

## 6. æµ‹è¯•ä¸éƒ¨ç½²

### 6.1 æµ‹è¯•ç°çŠ¶

#### 6.1.1 åç«¯æµ‹è¯•

**âš ï¸ é—®é¢˜ï¼šæµ‹è¯•ç›®å½•ä¸ºç©º**

```bash
backend/tests/
â””â”€â”€ (ç©ºç›®å½•)
```

**å·²å®‰è£…çš„æµ‹è¯•å·¥å…·ï¼š**
```txt
# requirements.txt
pytest>=7.4.0
pytest-asyncio>=0.21.0
```

**âš ï¸ ç¼ºå¤±ï¼š**
- `pytest-cov` - è¦†ç›–ç‡å·¥å…·
- `httpx` - API æµ‹è¯•å®¢æˆ·ç«¯
- `faker` - æµ‹è¯•æ•°æ®ç”Ÿæˆ

**å»ºè®®æ·»åŠ ï¼š**
```txt
# requirements.txt
pytest-cov>=4.1.0
httpx>=0.25.0
faker>=20.0.0
```

#### 6.1.2 å‰ç«¯æµ‹è¯•

**âŒ å®Œå…¨æœªé…ç½®æµ‹è¯•**

**âš ï¸ ç¼ºå¤±çš„æµ‹è¯•ä¾èµ–ï¼š**
```json
// package.json
{
  "devDependencies": {
    "vitest": "^1.0.0",
    "@testing-library/react": "^14.0.0",
    "@testing-library/jest-dom": "^6.0.0",
    "@testing-library/user-event": "^14.5.0",
    "@vitest/ui": "^1.0.0",
    "jsdom": "^23.0.0"
  },
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  }
}
```

### 6.2 Docker éƒ¨ç½²

#### 6.2.1 Docker Compose é…ç½®

**è·¯å¾„ï¼š** `docker-compose.yml`

**å®Œæ•´é…ç½®ï¼š**
```yaml
version: '3.8'

services:
  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: ipd_postgres
    environment:
      POSTGRES_DB: ipd_req_db
      POSTGRES_USER: ipd_user
      POSTGRES_PASSWORD: ipd_pass
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ipd_user -d ipd_req_db"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: ipd_redis
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # åç«¯æœåŠ¡
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: ipd_backend
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./backend:/app
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    environment:
      - DATABASE_URL=postgresql://ipd_user:ipd_pass@postgres/ipd_req_db
      - REDIS_URL=redis://redis:6379
      - SECRET_KEY=your-secret-key-change-in-production
      - DEBUG=true

  # å‰ç«¯æœåŠ¡
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: ipd_frontend
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - "5173:5173"
    depends_on:
      - backend
    environment:
      - VITE_API_URL=http://localhost:8000

volumes:
  postgres_data:
```

#### 6.2.2 å¯åŠ¨æœåŠ¡

**å¼€å‘ç¯å¢ƒï¼š**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up

# åå°è¿è¡Œ
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker-compose down -v
```

**ç”Ÿäº§ç¯å¢ƒï¼š**
```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®
docker-compose -f docker-compose.prod.yml up -d
```

### 6.3 CI/CD é…ç½®

**âŒ å½“å‰çŠ¶æ€ï¼šæœªé…ç½®**

**å»ºè®®çš„ GitHub Actions é…ç½®ï¼š**

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # åç«¯æµ‹è¯•
  backend-test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_DB: test_db
          POSTGRES_USER: test_user
          POSTGRES_PASSWORD: test_pass
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        cd backend
        pip install -r requirements.txt
        pip install pytest pytest-cov

    - name: Run tests
      run: |
        cd backend
        pytest tests/ -v --cov=app --cov-report=xml

    - name: Upload coverage
      uses: codecov/codecov-action@v3

  # å‰ç«¯æµ‹è¯•
  frontend-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Install dependencies
      run: cd frontend && npm ci

    - name: Run tests
      run: cd frontend && npm test

    - name: Build
      run: cd frontend && npm run build

  # ä»£ç è´¨é‡æ£€æŸ¥
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Backend lint
      run: |
        pip install flake8 black
        cd backend && flake8 app && black --check app

    - name: Frontend lint
      run: cd frontend && npm run lint
```

### 6.4 éƒ¨ç½²æµç¨‹

#### 6.4.1 æœ¬åœ°å¼€å‘

```bash
# 1. å¯åŠ¨æ•°æ®åº“å’Œç¼“å­˜
docker-compose up postgres redis -d

# 2. å¯åŠ¨åç«¯
cd backend
python -m uvicorn app.main:app --reload --port 8000

# 3. å¯åŠ¨å‰ç«¯
cd frontend
npm run dev
```

#### 6.4.2 ç”Ÿäº§éƒ¨ç½²

**æ–¹æ¡ˆ1ï¼šDocker Compose**
```bash
# 1. æ„å»ºç”Ÿäº§é•œåƒ
docker-compose -f docker-compose.prod.yml build

# 2. å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# 3. å¥åº·æ£€æŸ¥
curl http://localhost:8000/docs
curl http://localhost:5173
```

**æ–¹æ¡ˆ2ï¼šKubernetes**
```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ipd-backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ipd-backend
  template:
    metadata:
      labels:
        app: ipd-backend
    spec:
      containers:
      - name: backend
        image: ipd-backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
---
apiVersion: v1
kind: Service
metadata:
  name: ipd-backend-service
spec:
  selector:
    app: ipd-backend
  ports:
  - port: 8000
    targetPort: 8000
  type: LoadBalancer
```

---

## 7. é¡¹ç›®ç°çŠ¶è¯„ä¼°

### 7.1 ä¼˜åŠ¿ âœ…

#### 7.1.1 æŠ€æœ¯æ¶æ„

1. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**
   - å‰ç«¯ï¼šReact 18 + TypeScript + Vite
   - åç«¯ï¼šFastAPI + SQLAlchemy 2.0
   - æ•°æ®åº“ï¼šPostgreSQL + Redis
   - å®¹å™¨ï¼šDocker + Docker Compose

2. **æ¸…æ™°çš„åˆ†å±‚æ¶æ„**
   - å‰ç«¯ï¼šé¡µé¢ â†’ ç»„ä»¶ â†’ Store â†’ Service â†’ API
   - åç«¯ï¼šè·¯ç”± â†’ æœåŠ¡ â†’ ä»“å‚¨ â†’ æ¨¡å‹

3. **å®Œæ•´çš„åŠŸèƒ½å®ç°**
   - éœ€æ±‚å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - å¤šç»´åº¦åˆ†æä½“ç³»ï¼ˆINVESTã€MoSCoWã€KANOã€RICEã€APPEALSï¼‰
   - éœ€æ±‚è¿½æº¯çŸ©é˜µï¼ˆRTMï¼‰
   - éªŒè¯ç®¡ç†ï¼ˆFATã€SATã€UATï¼‰

4. **å¤šç§Ÿæˆ·æ”¯æŒ**
   - æ•°æ®éš”ç¦»
   - ç§Ÿæˆ·ä¸Šä¸‹æ–‡
   - è‡ªåŠ¨è¿‡æ»¤

#### 7.1.2 ä»£ç è´¨é‡

1. **ç±»å‹å®‰å…¨**
   - å‰ç«¯ï¼šTypeScript å…¨é¢è¦†ç›–
   - åç«¯ï¼šPydantic æ•°æ®éªŒè¯

2. **ä»£ç ç»„ç»‡**
   - æ¨¡å—åŒ–è®¾è®¡
   - åŠŸèƒ½æ¸…æ™°åˆ’åˆ†
   - ä»£ç å¤ç”¨è‰¯å¥½

3. **æ–‡æ¡£å®Œæ•´**
   - README è¯¦å°½
   - API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
   - æ³¨é‡Šæ¸…æ™°

#### 7.1.3 å¼€å‘ä½“éªŒ

1. **å¿«é€Ÿå¼€å‘**
   - Vite çƒ­æ›´æ–°å¿«
   - FastAPI è‡ªåŠ¨æ–‡æ¡£
   - Docker ä¸€é”®å¯åŠ¨

2. **è°ƒè¯•å‹å¥½**
   - Swagger UI æµ‹è¯• API
   - æ¸…æ™°çš„é”™è¯¯æç¤º
   - è¯¦ç»†çš„æ—¥å¿—

### 7.2 ä¸è¶³å’Œé—®é¢˜ âš ï¸

#### 7.2.1 å‰ç«¯é—®é¢˜

1. **å¤§æ–‡ä»¶é—®é¢˜**
   - `App.tsx` 1720 è¡Œï¼ŒåŒ…å«æ‰€æœ‰è·¯ç”±
   - éš¾ä»¥ç»´æŠ¤
   - å»ºè®®æ‹†åˆ†ä¸ºç‹¬ç«‹è·¯ç”±æ–‡ä»¶

2. **ä»£ç é‡å¤**
   - éƒ¨åˆ†é¡µé¢é€»è¾‘é‡å¤
   - å»ºè®®æå–å…¬å…±é€»è¾‘

3. **æœªä½¿ç”¨çš„ä¾èµ–**
   - React Hook Formã€Zod å·²å¼•å…¥ä½†æœªä½¿ç”¨
   - React Query å·²å¼•å…¥ä½†æœªä½¿ç”¨
   - Dayjsã€Lodash å·²å¼•å…¥ä½†æœªä½¿ç”¨

4. **æ ·å¼ç®¡ç†æ··ä¹±**
   - å¤§é‡å†…è”æ ·å¼
   - å»ºè®®ç»Ÿä¸€ä½¿ç”¨ CSS Modules æˆ– styled-components

5. **ç©ºç›®å½•**
   - `hooks/`ã€`types/`ã€`utils/` ä¸ºç©º
   - å»ºè®®åˆ é™¤æˆ–å¡«å……å†…å®¹

#### 7.2.2 åç«¯é—®é¢˜

1. **æµ‹è¯•ç¼ºå¤±**
   - `tests/` ç›®å½•ä¸ºç©º
   - æ²¡æœ‰å•å…ƒæµ‹è¯•
   - æ²¡æœ‰é›†æˆæµ‹è¯•
   - æ²¡æœ‰æµ‹è¯•è¦†ç›–ç‡

2. **å¯†ç å“ˆå¸Œå¼±**
   - ä½¿ç”¨ SHA256
   - å»ºè®®æ”¹ç”¨ BCrypt

3. **é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€**
   - éƒ¨åˆ†åœ°æ–¹ç”¨ try-except
   - éƒ¨åˆ†åœ°æ–¹æ²¡æœ‰å¤„ç†
   - å»ºè®®ç»Ÿä¸€ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸

#### 7.2.3 æµ‹è¯•å’Œéƒ¨ç½²

1. **æµ‹è¯•ä¸¥é‡ç¼ºå¤±**
   - å‰ç«¯å®Œå…¨æ²¡æµ‹è¯•
   - åç«¯æµ‹è¯•ç›®å½•ä¸ºç©º
   - æ²¡æœ‰æµ‹è¯•è¦†ç›–ç‡

2. **æ—  CI/CD**
   - æ²¡æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•
   - æ²¡æœ‰è‡ªåŠ¨åŒ–æ„å»º
   - æ²¡æœ‰è‡ªåŠ¨åŒ–éƒ¨ç½²

3. **Docker é…ç½®ä¸å®Œå–„**
   - ç¼ºå°‘ `.dockerignore`
   - å‰ç«¯ Dockerfile ä»…é€‚åˆå¼€å‘
   - æ²¡æœ‰ç”Ÿäº§ç¯å¢ƒé…ç½®

#### 7.2.4 æ–‡æ¡£ç¼ºå¤±

1. **ç¼ºå°‘å¼€å‘æ–‡æ¡£**
   - æ²¡æœ‰å¼€å‘è§„èŒƒ
   - æ²¡æœ‰æµ‹è¯•æŒ‡å—
   - æ²¡æœ‰éƒ¨ç½²æ‰‹å†Œ

2. **ç¼ºå°‘ API æ–‡æ¡£**
   - åªæœ‰è‡ªåŠ¨ç”Ÿæˆçš„ Swagger
   - æ²¡æœ‰è¯¦ç»†çš„ API è¯´æ˜

3. **ç¼ºå°‘æ¶æ„æ–‡æ¡£**
   - æ²¡æœ‰æ¶æ„è®¾è®¡æ–‡æ¡£
   - æ²¡æœ‰æ•°æ®åº“è®¾è®¡æ–‡æ¡£

### 7.3 æŠ€æœ¯å€ºåŠ¡

#### 7.3.1 é«˜ä¼˜å…ˆçº§ ğŸ”´

1. **æ·»åŠ æµ‹è¯•**
   - åç«¯ï¼šè‡³å°‘æ·»åŠ å…³é”® API çš„é›†æˆæµ‹è¯•
   - å‰ç«¯ï¼šæ·»åŠ  Vitest + Testing Library
   - æ·»åŠ æµ‹è¯•è¦†ç›–ç‡å·¥å…·

2. **é…ç½® CI/CD**
   - åˆ›å»º GitHub Actions å·¥ä½œæµ
   - è‡ªåŠ¨è¿è¡Œæµ‹è¯•
   - è‡ªåŠ¨æ„å»ºéªŒè¯

3. **å®Œå–„ Docker é…ç½®**
   - æ·»åŠ  `.dockerignore`
   - åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®
   - ä¼˜åŒ–é•œåƒå¤§å°

#### 7.3.2 ä¸­ä¼˜å…ˆçº§ ğŸŸ¡

4. **å‰ç«¯é‡æ„**
   - æ‹†åˆ† `App.tsx`
   - æå–å…¬å…±é€»è¾‘åˆ°è‡ªå®šä¹‰ Hooks
   - ç»Ÿä¸€æ ·å¼æ–¹æ¡ˆ

5. **å¢å¼ºæ–‡æ¡£**
   - API è¯¦ç»†æ–‡æ¡£
   - æµ‹è¯•æŒ‡å—
   - éƒ¨ç½²æ‰‹å†Œ

6. **ä»£ç è´¨é‡å·¥å…·**
   - æ·»åŠ  linting é…ç½®
   - æ ¼å¼åŒ–å·¥å…·ï¼ˆblackã€prettierï¼‰
   - pre-commit hooks

#### 7.3.3 ä½ä¼˜å…ˆçº§ ğŸŸ¢

7. **ç›‘æ§å’Œæ—¥å¿—**
   - æ·»åŠ æ—¥å¿—èšåˆ
   - æ€§èƒ½ç›‘æ§
   - é”™è¯¯è¿½è¸ª

8. **å®‰å…¨åŠ å›º**
   - å¯†é’¥ç®¡ç†
   - å®‰å…¨æ‰«æ
   - ä¾èµ–æ›´æ–°

---

## 8. æ”¹è¿›å»ºè®®

### 8.1 å‰ç«¯æ”¹è¿›å»ºè®®

#### 8.1.1 ä»£ç æ‹†åˆ†

**é—®é¢˜ï¼š** `App.tsx` 1720 è¡Œè¿‡å¤§

**å»ºè®®ï¼š**
```typescript
// routes/index.ts
import { Route } from 'react-router-dom'
import { ProtectedRoute } from '@/components/auth/ProtectedRoute'
import { MainLayout } from '@/components/layout/MainLayout'

export const routes = [
  {
    path: '/login',
    element: <LoginPage />,
    protected: false
  },
  {
    path: '/dashboard',
    element: <DashboardPage />,
    protected: true
  },
  // ...
]

// App.tsx
function App() {
  return (
    <BrowserRouter>
      <Routes>
        {routes.map((route) => (
          route.protected ? (
            <Route
              key={route.path}
              path={route.path}
              element={
                <ProtectedRoute>
                  <MainLayout>{route.element}</MainLayout>
                </ProtectedRoute>
              }
            />
          ) : (
            <Route key={route.path} path={route.path} element={route.element} />
          )
        ))}
      </Routes>
    </BrowserRouter>
  )
}
```

#### 8.1.2 æå–è‡ªå®šä¹‰ Hooks

**é—®é¢˜ï¼š** ç»„ä»¶ä¸­é‡å¤é€»è¾‘

**å»ºè®®ï¼š**
```typescript
// hooks/useRequirements.ts
export function useRequirements() {
  const [requirements, setRequirements] = useState([])
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)

  const fetchRequirements = async (filters) => {
    setLoading(true)
    try {
      const data = await requirementService.getRequirements(filters)
      setRequirements(data)
    } catch (err) {
      setError(err.message)
    } finally {
      setLoading(false)
    }
  }

  const createRequirement = async (data) => {
    await requirementService.createRequirement(data)
    fetchRequirements()
  }

  return {
    requirements,
    loading,
    error,
    fetchRequirements,
    createRequirement
  }
}
```

#### 8.1.3 ç»Ÿä¸€æ ·å¼æ–¹æ¡ˆ

**å»ºè®®ï¼šä½¿ç”¨ CSS Modules**

```typescript
// styles/RequirementList.module.css
.table {
  margin-top: 16px;
}

.toolbar {
  display: flex;
  justify-content: space-between;
  margin-bottom: 16px;
}

// RequirementListPage.tsx
import styles from './RequirementList.module.css'

<div className={styles.toolbar}>
  {/* ... */}
</div>

<Table className={styles.table} />
```

#### 8.1.4 å¯ç”¨ React Query

**å½“å‰ï¼š** Zustand ç”¨äºæ‰€æœ‰çŠ¶æ€ç®¡ç†

**å»ºè®®ï¼š**
- **Zustand**ï¼šå®¢æˆ·ç«¯çŠ¶æ€ï¼ˆUIã€è¡¨å•ã€ç”¨æˆ·é€‰æ‹©ï¼‰
- **React Query**ï¼šæœåŠ¡ç«¯çŠ¶æ€ï¼ˆAPI æ•°æ®ã€ç¼“å­˜ã€åŒæ­¥ï¼‰

```typescript
// hooks/useRequirementsQuery.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'

export function useRequirements(filters) {
  return useQuery({
    queryKey: ['requirements', filters],
    queryFn: () => requirementService.getRequirements(filters)
  })
}

export function useCreateRequirement() {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: requirementService.createRequirement,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['requirements'] })
    }
  })
}

// RequirementListPage.tsx
function RequirementListPage() {
  const { data: requirements, isLoading } = useRequirements({ status: 'analyzed' })
  const createMutation = useCreateRequirement()

  // è‡ªåŠ¨ç¼“å­˜ã€è‡ªåŠ¨é‡æ–°è·å–
}
```

### 8.2 åç«¯æ”¹è¿›å»ºè®®

#### 8.2.1 æ·»åŠ æµ‹è¯•

**ç›®å½•ç»“æ„ï¼š**
```
tests/
â”œâ”€â”€ conftest.py              # Pytest é…ç½®
â”œâ”€â”€ test_api/                # API æµ‹è¯•
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_requirements.py
â”‚   â””â”€â”€ test_analysis.py
â”œâ”€â”€ test_services/            # æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ test_requirement_service.py
â”‚   â””â”€â”€ test_analysis_service.py
â””â”€â”€ test_repositories/        # ä»“å‚¨æµ‹è¯•
    â””â”€â”€ test_requirement_repo.py
```

**ç¤ºä¾‹æµ‹è¯•ï¼š**
```python
# tests/test_api/test_requirements.py
import pytest
from httpx import AsyncClient

@pytest.mark.asyncio
async def test_create_requirement(async_client: AsyncClient, auth_token):
    response = await async_client.post(
        "/api/v1/requirements/",
        json={
            "title": "æµ‹è¯•éœ€æ±‚",
            "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•éœ€æ±‚",
            "source_channel": "customer"
        },
        headers={"Authorization": f"Bearer {auth_token}"}
    )

    assert response.status_code == 200
    data = response.json()
    assert data["success"] is True
    assert data["data"]["title"] == "æµ‹è¯•éœ€æ±‚"

@pytest.mark.asyncio
async def test_get_requirements(async_client: AsyncClient, auth_token):
    response = await async_client.get(
        "/api/v1/requirements/",
        headers={"Authorization": f"Bearer {auth_token}"}
    )

    assert response.status_code == 200
    data = response.json()
    assert "items" in data["data"]
```

**pytest é…ç½®ï¼š**
```ini
# pytest.ini
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --strict-markers
    --cov=app
    --cov-report=html
    --cov-report=term-missing
```

#### 8.2.2 æ”¹è¿›å¯†ç å“ˆå¸Œ

**å½“å‰ï¼ˆSHA256ï¼‰ï¼š**
```python
import hashlib

def get_password_hash(password: str) -> str:
    return hashlib.sha256(password.encode()).hexdigest()
```

**æ”¹è¿›ï¼ˆBCryptï¼‰ï¼š**
```python
from passlib.context import CryptContext

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)
```

#### 8.2.3 ç»Ÿä¸€é”™è¯¯å¤„ç†

**å½“å‰ï¼š** éƒ¨åˆ†åœ°æ–¹æ²¡æœ‰é”™è¯¯å¤„ç†

**æ”¹è¿›ï¼š**
```python
# app/core/exceptions.py
class AppException(Exception):
    def __init__(self, message: str, status_code: int = 400):
        self.message = message
        self.status_code = status_code

class NotFoundException(AppException):
    def __init__(self, message: str = "èµ„æºæœªæ‰¾åˆ°"):
        super().__init__(message, 404)

class BadRequestException(AppException):
    def __init__(self, message: str = "è¯·æ±‚å‚æ•°é”™è¯¯"):
        super().__init__(message, 400)

# app/main.py
@app.exception_handler(AppException)
async def app_exception_handler(request, exc: AppException):
    return JSONResponse(
        status_code=exc.status_code,
        content={
            "success": False,
            "message": exc.message,
        },
    )

# ä½¿ç”¨
async def get_requirement(requirement_id: int):
    requirement = await repo.get_by_id(requirement_id)
    if not requirement:
        raise NotFoundException(f"éœ€æ±‚ {requirement_id} ä¸å­˜åœ¨")
    return requirement
```

### 8.3 æµ‹è¯•å’Œéƒ¨ç½²æ”¹è¿›

#### 8.3.1 é…ç½® CI/CD

**GitHub Actionsï¼š**
```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  backend-test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_DB: test_db
          POSTGRES_USER: test_user
          POSTGRES_PASSWORD: test_pass
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        cd backend
        pip install -r requirements.txt
        pip install pytest pytest-cov

    - name: Run tests
      run: |
        cd backend
        pytest tests/ -v --cov=app --cov-report=xml

    - name: Upload coverage
      uses: codecov/codecov-action@v3

  frontend-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Install dependencies
      run: cd frontend && npm ci

    - name: Run tests
      run: cd frontend && npm test

    - name: Build
      run: cd frontend && npm run build
```

#### 8.3.2 å®Œå–„Dockeré…ç½®

**æ·»åŠ  `.dockerignore`ï¼š**
```dockerignore
# åç«¯
__pycache__
*.pyc
.venv
venv/
.env
.pytest_cache
.coverage
htmlcov/
*.md

# å‰ç«¯
node_modules
dist
.env.local
```

**å‰ç«¯ç”Ÿäº§ Dockerfileï¼š**
```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18-alpine as builder
WORKDIR /app
COPY package.json package-lock.json* ./
RUN npm ci
COPY . .
RUN npm run build

# ç”Ÿäº§é˜¶æ®µ
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY package.json ./
RUN npm ci --only=production
EXPOSE 4173
CMD ["npm", "run", "preview"]
```

#### 8.3.3 æ·»åŠ éƒ¨ç½²è„šæœ¬

**scripts/deploy.shï¼š**
```bash
#!/bin/bash
set -e

echo "å¼€å§‹éƒ¨ç½²..."

# å¤‡ä»½æ•°æ®åº“
echo "å¤‡ä»½æ•°æ®åº“..."
pg_dump ipd_req_db > backup_$(date +%Y%m%d_%H%M%S).sql

# æ„å»ºé•œåƒ
echo "æ„å»ºé•œåƒ..."
docker-compose -f docker-compose.prod.yml build

# åœæ­¢æ—§å®¹å™¨
echo "åœæ­¢æ—§å®¹å™¨..."
docker-compose -f docker-compose.prod.yml down

# å¯åŠ¨æ–°å®¹å™¨
echo "å¯åŠ¨æ–°å®¹å™¨..."
docker-compose -f docker-compose.prod.yml up -d

# å¥åº·æ£€æŸ¥
echo "å¥åº·æ£€æŸ¥..."
sleep 10
curl -f http://localhost:8000/docs || exit 1
curl -f http://localhost:5173 || exit 1

echo "éƒ¨ç½²å®Œæˆï¼"
```

### 8.4 æ–‡æ¡£æ”¹è¿›

#### 8.4.1 API æ–‡æ¡£

**åˆ›å»º docs/api.mdï¼š**
```markdown
# API æ–‡æ¡£

## è®¤è¯ API

### ç™»å½•
\`\`\`http
POST /api/v1/auth/login
Content-Type: application/x-www-form-urlencoded

username=admin&password=admin123
\`\`\`

### å“åº”
\`\`\`json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "access_token": "eyJhbGci...",
    "token_type": "bearer",
    "user": {
      "id": 1,
      "username": "admin",
      "role": "admin"
    }
  }
}
\`\`\`
...
\`\`\`
```

#### 8.4.2 å¼€å‘è§„èŒƒ

**åˆ›å»º docs/development.mdï¼š**
```markdown
# å¼€å‘è§„èŒƒ

## ä»£ç é£æ ¼

### å‰ç«¯
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- ç»„ä»¶å‘½åï¼šPascalCase
- æ–‡ä»¶å‘½åï¼škebab-case
- ä½¿ç”¨å‡½æ•°ç»„ä»¶ + Hooks

### åç«¯
- éµå¾ª PEP 8 è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£
- å‡½æ•°å‘½åï¼šsnake_case
- ç±»å‘½åï¼šPascalCase

## Git å·¥ä½œæµ

### åˆ†æ”¯å‘½å
- \`main\` - ç”Ÿäº§ç¯å¢ƒ
- \`develop\` - å¼€å‘ç¯å¢ƒ
- \`feature/xxx\` - åŠŸèƒ½åˆ†æ”¯
- \`bugfix/xxx\` - ä¿®å¤åˆ†æ”¯

### æäº¤ä¿¡æ¯
\`\`\`
feat: æ·»åŠ éœ€æ±‚åˆ†æåŠŸèƒ½
fix: ä¿®å¤ç™»å½•é”™è¯¯
docs: æ›´æ–° README
test: æ·»åŠ éœ€æ±‚æµ‹è¯•
refactor: é‡æ„éœ€æ±‚æœåŠ¡
\`\`\`
\`\`\`
```

---

## 9. æ€»ç»“

### 9.1 é¡¹ç›®äº®ç‚¹

1. **åŠŸèƒ½å®Œæ•´** - å®ç°äº†éœ€æ±‚å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
2. **æŠ€æœ¯ç°ä»£** - ä½¿ç”¨æœ€æ–°çš„æŠ€æœ¯æ ˆ
3. **æ¶æ„æ¸…æ™°** - å‰åç«¯åˆ†ç¦»ï¼Œåˆ†å±‚æ˜ç¡®
4. **å¤šç§Ÿæˆ·æ”¯æŒ** - å®Œå–„çš„æ•°æ®éš”ç¦»
5. **åˆ†æä½“ç³»å®Œæ•´** - INVESTã€MoSCoWã€KANOã€RICEã€APPEALS
6. **æ–‡æ¡£è‰¯å¥½** - README è¯¦å°½

### 9.2 ä¸»è¦é—®é¢˜

1. **æµ‹è¯•ç¼ºå¤±** - å‰åç«¯éƒ½æ²¡æœ‰æµ‹è¯•
2. **æ—  CI/CD** - æ²¡æœ‰è‡ªåŠ¨åŒ–æµç¨‹
3. **ä»£ç ç»„ç»‡** - å‰ç«¯æœ‰è¶…å¤§æ–‡ä»¶
4. **ä¾èµ–æœªä½¿ç”¨** - éƒ¨åˆ†ä¾èµ–å¼•å…¥ä½†æœªä½¿ç”¨
5. **æ ·å¼æ··ä¹±** - å¤§é‡å†…è”æ ·å¼

### 9.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

#### ç«‹å³è¡ŒåŠ¨ï¼ˆæœ¬å‘¨ï¼‰

1. âœ… æ‹†åˆ† `App.tsx`
2. âœ… æ·»åŠ åç«¯æµ‹è¯•ï¼ˆè‡³å°‘å…³é”® APIï¼‰
3. âœ… æ·»åŠ å‰ç«¯æµ‹è¯•æ¡†æ¶
4. âœ… åˆ›å»º `.dockerignore`

#### çŸ­æœŸè®¡åˆ’ï¼ˆæœ¬æœˆï¼‰

1. ğŸ“‹ é…ç½® CI/CD
2. ğŸ“‹ å®Œå–„æµ‹è¯•è¦†ç›–ç‡ï¼ˆ>60%ï¼‰
3. ğŸ“‹ æ”¹è¿›å¯†ç å“ˆå¸Œï¼ˆBCryptï¼‰
4. ğŸ“‹ ç»Ÿä¸€æ ·å¼æ–¹æ¡ˆ
5. ğŸ“‹ å®Œå–„æ–‡æ¡£

#### ä¸­æœŸè®¡åˆ’ï¼ˆæœ¬å­£åº¦ï¼‰

1. ğŸ¯ æ€§èƒ½ä¼˜åŒ–
2. ğŸ¯ å®‰å…¨åŠ å›º
3. ğŸ¯ ç›‘æ§å’Œæ—¥å¿—
4. ğŸ¯ è‡ªåŠ¨åŒ–éƒ¨ç½²
5. ğŸ¯ ä»£ç é‡æ„

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶è·¯å¾„

**åç«¯ï¼š**
- åº”ç”¨å…¥å£: `backend/app/main.py`
- é…ç½®: `backend/app/config.py`
- æ¨¡å‹: `backend/app/models/`
- API: `backend/app/api/v1/`
- æœåŠ¡: `backend/app/services/`

**å‰ç«¯ï¼š**
- å…¥å£: `frontend/src/main.tsx`
- æ ¹ç»„ä»¶: `frontend/src/App.tsx`
- é¡µé¢: `frontend/src/pages/`
- ç»„ä»¶: `frontend/src/components/`
- çŠ¶æ€: `frontend/src/stores/`
- æœåŠ¡: `frontend/src/services/`

### B. å¿«é€Ÿå‘½ä»¤

**åç«¯ï¼š**
```bash
cd backend
python -m uvicorn app.main:app --reload --port 8000
```

**å‰ç«¯ï¼š**
```bash
cd frontend
npm run dev
```

**Dockerï¼š**
```bash
docker-compose up
```

### C. ç¯å¢ƒå˜é‡

**åç«¯ (.env)ï¼š**
```bash
DATABASE_URL=postgresql://ipd_user:ipd_pass@localhost:5432/ipd_req_db
REDIS_URL=redis://localhost:6379
SECRET_KEY=your-secret-key
```

**å‰ç«¯ (.env)ï¼š**
```bash
VITE_API_URL=http://localhost:8000/api/v1
```

---

**æŠ¥å‘Šç»“æŸ**

ç¥å­¦ä¹ å’Œå¼€å‘é¡ºåˆ©ï¼ ğŸ‰
